function  phy_cleanFoci()
%UNTITLED3 Summary of this function goes here
%   Detailed explanation goes here

global segmentation



frames=find(segmentation.budnecksSegmented==1);

displayImage=segmentation.realImage;

for l=551 %frames
    
    img=uint16(phy_loadTimeLapseImage(segmentation.position,l,segmentation.budneckChannel,'non retreat'));
    warning off all;
    img=imresize(img,segmentation.sizeImageMax);
    warning on all;
    
    
    for j=1:numel(segmentation.cells1(l,:))
        if segmentation.cells1(l,j).n~=0
            xc=segmentation.cells1(l,j).x;
            yc=segmentation.cells1(l,j).y;
            bw_cell = poly2mask(xc,yc,size(displayImage,1),size(displayImage,2));
            
            bw_bud=logical(zeros(size(displayImage,1),size(displayImage,2)));
            
            for i=1:numel(segmentation.budnecks(l,:))
                
                %  l,i,segmentation.budnecks(l,i).n
                
                if segmentation.budnecks(l,i).n~=0
                    
                    x=segmentation.budnecks(l,i).x;
                    y=segmentation.budnecks(l,i).y;
                    
                    if mean(inpolygon(x,y,xc,yc))>0 % bud neck is inside the cell
                        
                        
                        bw_temp = poly2mask(x,y,size(displayImage,1),size(displayImage,2));
                        
                        %size(bw_temp)
                        bw_bud(bw_temp)=1;
  
                        
                    end
                end
            end
            
            
            %pix=find(bw_bud);
            
            bw_cell(bw_bud)=0;
            figure, imshow(bw_cell,[]);
            meancell=mean(img(bw_cell));
            meanbud=mean(img(bw_bud))-meancell;
            
            
             segmentation.cells1(l,j).Mean=meanbud;
             segmentation.cells1(l,j).Nrpoints=length(find(bw_bud));
        end
        
    end
    
   
    
end


