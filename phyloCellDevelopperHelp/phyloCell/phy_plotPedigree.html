<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of phy_plotPedigree</title>
  <meta name="keywords" content="phy_plotPedigree">
  <meta name="description" content="this function plots the pedigree in a separate figure">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<!-- # phyloCell -->
<h1>phy_plotPedigree
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>this function plots the pedigree in a separate figure</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function [haxe himg]=phy_plotPedigree(tcells,option) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">this function plots the pedigree in a separate figure
input:temporal objects tcells
        option=1 plot with budnecks time or 2 plot some dependent data
        (aire) for each frame and cell (the color intensity will varie in function of the data)
output: handle of the axes, haxe
        handle of the dispalyed image, himage</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="phyloCell_mainGUI.html" class="code" title="function varargout = phyloCell_mainGUI(varargin)">phyloCell_mainGUI</a>	Main graphical user interface;</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function xpos=buildNode(tcells,xpos,i,posmin,posmax)</a></li></ul>
<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%this function plots the pedigree in a separate figure</span>
0002 <span class="comment">%input:temporal objects tcells</span>
0003 <span class="comment">%        option=1 plot with budnecks time or 2 plot some dependent data</span>
0004 <span class="comment">%        (aire) for each frame and cell (the color intensity will varie in function of the data)</span>
0005 <span class="comment">%output: handle of the axes, haxe</span>
0006 <span class="comment">%        handle of the dispalyed image, himage</span>
0007 
0008 <a name="_sub0" href="#_subfunctions" class="code">function [haxe himg]=phy_plotPedigree(tcells,option)</a>
0009 
0010 <span class="comment">%position of each cell</span>
0011 xpos=ones(size(tcells));
0012 
0013 endFrame=0;
0014 
0015 <span class="comment">%scale factor, how many pixels for one frame</span>
0016 scaleFactor=4;
0017 
0018 <span class="comment">%size of the image</span>
0019 sizex=1024;
0020 sizey=240;
0021 
0022 <span class="comment">%the RGB image(background white)</span>
0023 phy=(ones(sizey,sizex));
0024 phy = repmat( phy, [1, 1, 3] );
0025 
0026 <span class="comment">%the width in pixels of each line</span>
0027 linesize=2;
0028 linesize=round(linesize);
0029 
0030 <span class="comment">%colors of the lines (RGB 0to 1)(1 1 0=yellow)</span>
0031 buddedColor=[1 0.7 0];
0032 unbuddedColor=[1 0 0];
0033 joinColor=[0.5 0.5 0.5];
0034 
0035 <span class="comment">%if not using budnecks unbuded color=black</span>
0036 <span class="keyword">if</span> option==2
0037     unbuddedColor=[0 0 0];
0038 <span class="keyword">end</span>
0039 
0040 <span class="comment">%figure,imshow(phy);</span>
0041 <span class="comment">%find first mother cell</span>
0042 n=0;
0043 indm=[];
0044 <span class="keyword">for</span> i=1:numel(tcells)
0045     <span class="keyword">if</span> tcells(i).N~=0
0046         a= tcells(i).mother;
0047         <span class="keyword">if</span> a==0
0048             n=n+1;
0049             indm=[indm i];
0050             <span class="keyword">break</span>;
0051         <span class="keyword">end</span>
0052     <span class="keyword">end</span>
0053 <span class="keyword">end</span>
0054 
0055 <span class="comment">%set the position of the first cell</span>
0056 <span class="keyword">for</span> i=1:n
0057     xpos(indm(i))=10+(i-1)*(sizex-10)/n;
0058 <span class="keyword">end</span>
0059 
0060 <span class="comment">%set the positions of the daughter cells (recursivly function)</span>
0061 <span class="keyword">for</span> i=1:n
0062     <span class="keyword">if</span> i~=n
0063         xpos=<a href="#_sub1" class="code" title="subfunction xpos=buildNode(tcells,xpos,i,posmin,posmax)">buildNode</a>(tcells,xpos,indm(i),xpos(indm(i)),xpos(indm(i+1)));
0064     <span class="keyword">else</span>
0065         xpos=<a href="#_sub1" class="code" title="subfunction xpos=buildNode(tcells,xpos,i,posmin,posmax)">buildNode</a>(tcells,xpos,indm(i),xpos(indm(i)),sizex);
0066     <span class="keyword">end</span>
0067     
0068 <span class="keyword">end</span>
0069 xpos=round(xpos);
0070 
0071 <span class="comment">%calculate the max and the min of the plotting data</span>
0072 dataScale=[];
0073 <span class="keyword">for</span> i=1:numel(tcells)
0074     <span class="keyword">if</span> xpos(i)~=0
0075         <span class="keyword">for</span> j=1:length(tcells(i).Obj)
0076             <span class="keyword">if</span> ~isempty(tcells(i).Obj(j).x)
0077                 dataScale=[dataScale tcells(i).Obj(j).dependentData];
0078             <span class="keyword">end</span>
0079         <span class="keyword">end</span>
0080         endFrame=max(endFrame,tcells(i).lastFrame);
0081     <span class="keyword">end</span>
0082 <span class="keyword">end</span>
0083 m=min(dataScale);
0084 M=max(dataScale);
0085 
0086 <span class="comment">%if plotting the data instad of tha budneck time</span>
0087 <span class="keyword">if</span> option~=2
0088 
0089     <span class="comment">%---------------------</span>
0090     <span class="comment">%dialog box</span>
0091     prompt = {<span class="string">'Enter small value:'</span>,<span class="string">'Enter big value:'</span>};
0092     dlg_title = <span class="string">'Input for pedigree representation value'</span>;
0093     num_lines = 1;
0094     def = {num2str(m),num2str(M)};
0095     answer = inputdlg(prompt,dlg_title,num_lines,def);
0096     <span class="keyword">if</span> isempty(answer)
0097         <span class="keyword">return</span>
0098     <span class="keyword">end</span>
0099     m=str2double(answer(1));
0100     M=str2double(answer(2));
0101     <span class="comment">%-----------------------</span>
0102 <span class="keyword">end</span>
0103 
0104 <span class="comment">%plot the vertical lignes (scaled if data ploted , black if not)</span>
0105 <span class="keyword">for</span> i=1:numel(tcells)
0106     position=xpos(i);
0107     <span class="keyword">for</span> j=1:length(tcells(i).Obj)
0108         <span class="keyword">if</span> tcells(i).Obj(j).image~=0 &amp;&amp; tcells(i).Obj(j).image&gt;=tcells(i).birthFrame
0109             phy(tcells(i).Obj(j).image,position:position+linesize,1)=unbuddedColor(1)*((tcells(i).Obj(j).dependentData)-m)/(M-m);
0110             phy(tcells(i).Obj(j).image,position:position+linesize,2)=unbuddedColor(2)*((tcells(i).Obj(j).dependentData)-m)/(M-m);
0111             phy(tcells(i).Obj(j).image,position:position+linesize,3)=unbuddedColor(3)*((tcells(i).Obj(j).dependentData)-m)/(M-m);
0112         <span class="keyword">end</span>
0113         
0114     <span class="keyword">end</span>
0115     endFrame=max(endFrame,tcells(i).lastFrame);
0116     
0117 <span class="keyword">end</span>
0118 
0119 
0120 <span class="comment">%plot the orisontal lignes</span>
0121 <span class="keyword">for</span> i=1:numel(tcells)
0122     divisionTime=tcells(i).divisionTimes;
0123     divisionTime(divisionTime==0)=1;
0124     
0125     position=xpos(i);
0126     
0127     <span class="keyword">for</span> j=1:numel(divisionTime)
0128         
0129         daughter=tcells(i).daughterList(j);
0130         daughterpos=xpos(daughter);
0131         
0132         phy(divisionTime(j),position:daughterpos,1)=joinColor(1);
0133         phy(divisionTime(j),position:daughterpos,2)=joinColor(2);
0134         phy(divisionTime(j),position:daughterpos,3)=joinColor(3);
0135         
0136         
0137     <span class="keyword">end</span>
0138     
0139 <span class="keyword">end</span>
0140 
0141 <span class="comment">%plot the budnecks time (vertical lignes)</span>
0142 <span class="keyword">if</span> option==2
0143     <span class="keyword">for</span> i=1:numel(tcells)
0144         divisionTime=tcells(i).divisionTimes;
0145         divisionTime(divisionTime==0)=1;
0146         budTime=tcells(i).budTimes;
0147         budTime(budTime==0)=1;
0148         position=xpos(i);
0149         
0150         <span class="keyword">for</span> j=1:numel(divisionTime)
0151             
0152             phy(budTime(j):divisionTime(j),position:position+linesize,1)=buddedColor(1);
0153             phy(budTime(j):divisionTime(j),position:position+linesize,2)=buddedColor(2);
0154             phy(budTime(j):divisionTime(j),position:position+linesize,3)=buddedColor(3);
0155         <span class="keyword">end</span>
0156     <span class="keyword">end</span>
0157 <span class="keyword">end</span>
0158 <span class="comment">%resize the image to the scaling factor</span>
0159 phy=imresize(phy,[sizey*scaleFactor,sizex],<span class="string">'nearest'</span>);
0160 hfig=figure;
0161 haxe=axes(<span class="string">'parent'</span>,hfig);
0162 himg=imshow(phy,<span class="string">'parent'</span>,haxe);
0163 
0164 <span class="comment">%put some data in &quot;user data&quot; of the image</span>
0165 uData.image=phy;
0166 uData.scaleFactor=scaleFactor;
0167 uData.xpos=xpos;
0168 uData.tcells=tcells;
0169 uData.linesize=linesize;
0170 uData.haxe=haxe;
0171 set(himg,<span class="string">'UserData'</span>,uData);
0172 
0173 <span class="comment">%name of the cells</span>
0174 <span class="keyword">for</span> i=1:numel(tcells)
0175     text(xpos(i),endFrame*scaleFactor+3,num2str(i),<span class="string">'FontSize'</span>,6);
0176 <span class="keyword">end</span>
0177 
0178 <span class="comment">%legend</span>
0179 line( [sizex-120 sizex-80], [10 10],<span class="string">'Color'</span>,unbuddedColor,<span class="string">'lineWidth'</span>,linesize);
0180 line( [sizex-120 sizex-80], [40 40],<span class="string">'Color'</span>,buddedColor,<span class="string">'lineWidth'</span>,linesize);
0181 text(sizex-80,10,<span class="string">'unbudded'</span>,<span class="string">'FontSize'</span>,10);
0182 text(sizex-80,40,<span class="string">'budded'</span>,<span class="string">'FontSize'</span>,10);
0183 line( [sizex-100 sizex-100], [60 60+scaleFactor*20],<span class="string">'Color'</span>,[0.5 0.5 0.5],<span class="string">'lineWidth'</span>,linesize);
0184 text(sizex-80,80,<span class="string">'60 min'</span>,<span class="string">'FontSize'</span>,10);
0185 
0186 <span class="comment">%write the text of cells with no mother</span>
0187 cellnoMother=find(xpos==1);
0188 faux=[];
0189 <span class="keyword">for</span> i=1:length(cellnoMother)
0190     <span class="keyword">if</span> tcells(cellnoMother(i)).N==0
0191         faux=[faux i];
0192     <span class="keyword">end</span>
0193 <span class="keyword">end</span>
0194 cellnoMother(faux)=[];
0195 text(sizex-100,80+scaleFactor*20,{<span class="string">'cells with no mother'</span>,num2str(cellnoMother)},<span class="string">'FontSize'</span>,10);
0196 
0197 
0198 
0199 <a name="_sub1" href="#_subfunctions" class="code">function xpos=buildNode(tcells,xpos,i,posmin,posmax)</a>
0200 <span class="comment">%get the list of cells xpositinon in pedigree</span>
0201 daughterList=tcells(i).daughterList;
0202 <span class="keyword">if</span> ~issorted(tcells(i).divisionTimes)
0203     [B,IX]=sort(tcells(i).divisionTimes);
0204     daughterList(:)=daughterList(IX);
0205 <span class="keyword">end</span>;
0206 n=0;
0207 <span class="keyword">for</span> j=daughterList
0208     <span class="keyword">if</span> tcells(j).mother~=i
0209         <span class="keyword">continue</span>
0210     <span class="keyword">end</span>
0211     xpos(j)=(posmin+posmax)/2;
0212     
0213     xpos=<a href="#_sub1" class="code" title="subfunction xpos=buildNode(tcells,xpos,i,posmin,posmax)">buildNode</a>(tcells,xpos,j,xpos(j),posmax);
0214     
0215     posmax=xpos(j);
0216     n=n+1;
0217 <span class="keyword">end</span>
0218</pre></div>
<hr><address>Generated on Wed 27-Oct-2010 20:01:59 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2003</address>
</body>
</html>