<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of phy_mapObjects</title>
  <meta name="keywords" content="phy_mapObjects">
  <meta name="description" content="mapping objects">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<!-- # phyloCell -->
<h1>phy_mapObjects
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>mapping objects</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function objectOut=phy_mapObjects(distanceParameter,objecti,objecti_1,objecti_2) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">mapping objects
objecti=objects of actual image
objecti_1= objects of image i-1
objecti_2=objects of image i-2
output : objectOut=object i with the right numbers</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="phy_icp.html" class="code" title="function [TR, TT, iclosest,distance,ERROR] = phy_icp(model,data,max_iter,min_iter,fitting,thres,init_flag,tes_flag,refpnt)">phy_icp</a>	ICP Iterative Closest Point Algorithm. Takes use of</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="phyloCell_mainGUI.html" class="code" title="function varargout = phyloCell_mainGUI(varargin)">phyloCell_mainGUI</a>	Main graphical user interface;</li></ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%mapping objects</span>
0002 <span class="comment">%objecti=objects of actual image</span>
0003 <span class="comment">%objecti_1= objects of image i-1</span>
0004 <span class="comment">%objecti_2=objects of image i-2</span>
0005 <span class="comment">%output : objectOut=object i with the right numbers</span>
0006 <a name="_sub0" href="#_subfunctions" class="code">function objectOut=phy_mapObjects(distanceParameter,objecti,objecti_1,objecti_2)</a>
0007 
0008 <span class="keyword">persistent</span> lastObjNumber;
0009 
0010 objectOut=objecti;
0011 
0012 x=[];
0013 y=[];
0014 x1=[];
0015 y1=[];
0016 x2=[];
0017 y2=[];
0018 indexi=[];   <span class="comment">%the objects  non deleted in the image i</span>
0019 indexi_1=[];
0020 indexi_2=[];
0021 <span class="keyword">if</span> nargin==2 <span class="comment">% first image objects map</span>
0022     lastObjNumber=0; <span class="comment">% the total nmber of marquers</span>
0023     <span class="keyword">for</span> k = 1:length(objecti)
0024         <span class="keyword">if</span> objectOut(k).ox~=0
0025             <span class="keyword">if</span> objectOut(k).n~=0  <span class="comment">%check if already mapped</span>
0026                 lastObjNumber=max(objectOut(k).n,lastObjNumber); <span class="comment">% lastObjNumber is the maximum label of the marquers</span>
0027             <span class="keyword">else</span>
0028                 lastObjNumber=lastObjNumber+1;  <span class="comment">% if not mapped each new object will have a new label</span>
0029                 objectOut(k).n=lastObjNumber;
0030             <span class="keyword">end</span>
0031         <span class="keyword">end</span>
0032     <span class="keyword">end</span>
0033     
0034     
0035 <span class="keyword">elseif</span> nargin&gt;=3 <span class="comment">% if mapping bewtwen image i and image i-1</span>
0036     
0037     <span class="keyword">for</span> l=1:size(objecti,2)
0038         <span class="keyword">if</span> objecti(l).ox~=0
0039             x(end+1)=objecti(l).ox;   <span class="comment">%make mapping betwen 2 set of points (the object centres) (x,y)image i</span>
0040             y(end+1)=objecti(l).oy;
0041             indexi(end+1)=l;
0042         <span class="keyword">end</span>
0043     <span class="keyword">end</span>
0044     
0045     <span class="keyword">for</span> m=1:size(objecti_1,2)
0046         <span class="keyword">if</span> objecti_1(m).ox~=0
0047             x1(end+1)=objecti_1(m).ox; <span class="comment">%make mapping betwen 2 set of points (the object centres) (x1,y1)image i-1</span>
0048             y1(end+1)=objecti_1(m).oy;
0049             indexi_1(end+1)=m;
0050         <span class="keyword">end</span>
0051         <span class="keyword">if</span> (nargin&gt;=4) <span class="comment">% if 3 arguments (from 3 images)</span>
0052             <span class="keyword">if</span> objecti_2(m).ox~=0
0053                 x2(end+1)=objecti_2(m).ox;    <span class="comment">%make mapping betwen 2 set of points (the object centres) (x2,y2)image i-2</span>
0054                 y2(end+1)=objecti_2(m).oy;
0055                 indexi_2(end+1)=m;
0056             <span class="keyword">end</span>
0057         <span class="keyword">end</span>
0058     <span class="keyword">end</span>
0059     
0060     <span class="keyword">if</span> (nargin&gt;=2) &amp;&amp; isempty(x)
0061         <span class="keyword">return</span>
0062     <span class="keyword">end</span>
0063     <span class="keyword">if</span> (nargin&gt;=3) &amp;&amp; isempty(x1)
0064         <span class="keyword">return</span>
0065     <span class="keyword">end</span>
0066     <span class="keyword">if</span> (nargin&gt;=4) &amp;&amp; isempty(x2)
0067         <span class="keyword">return</span>
0068     <span class="keyword">end</span>
0069     
0070     
0071     
0072     <span class="keyword">if</span> min([size(x1,2),size(x,2)])&lt;3 <span class="comment">%when they are fewer than 3 points not using the initialisation</span>
0073         [R0,T0,iclosest_1,dist_1,Error0]=<a href="phy_icp.html" class="code" title="function [TR, TT, iclosest,distance,ERROR] = phy_icp(model,data,max_iter,min_iter,fitting,thres,init_flag,tes_flag,refpnt)">phy_icp</a>([x1; y1],[x; y],10,2,[3,min([size(x1,2),size(x,2)])],1,0);
0074         <span class="comment">%function [TR, TT, iclosest,distance,ERROR] = phy_icp(model,data,max_iter,min_iter,fitting,thres,init_flag,tes_flag,refpnt)</span>
0075     <span class="keyword">else</span>
0076         <span class="comment">% phy_icp(model,data,max_iter,min_iter,fitting,thres,init_flag,tes_flag)</span>
0077         <span class="comment">%[R0,T0,iclosest_1,dist_1,Error0]=phy_icp([x1; y1],[x; y],10,2,[3,min([size(x1,2),size(x,2)])],1,1);</span>
0078         
0079         <span class="comment">%the final 1/0 do or not an initialisation by translation (the same median)</span>
0080         <span class="comment">%iclosest_1 is the index of the closest point in image i-1</span>
0081         <span class="comment">%dist_1 is the distance after icp to the closest point in image i-1</span>
0082         
0083         [R0,T0,iclosest0,dist0,Error0]=<a href="phy_icp.html" class="code" title="function [TR, TT, iclosest,distance,ERROR] = phy_icp(model,data,max_iter,min_iter,fitting,thres,init_flag,tes_flag,refpnt)">phy_icp</a>([x1; y1],[x; y],10,2,[3,min([size(x1,2),size(x,2)])],0.01,0);
0084         [R1,T1,iclosest1,dist1,Error1]=<a href="phy_icp.html" class="code" title="function [TR, TT, iclosest,distance,ERROR] = phy_icp(model,data,max_iter,min_iter,fitting,thres,init_flag,tes_flag,refpnt)">phy_icp</a>([x1; y1],[x; y],10,2,[3,min([size(x1,2),size(x,2)])],0.01,1);
0085 
0086         
0087         <span class="keyword">if</span> Error0&lt;=Error1   <span class="comment">%compare the 2 errors (with/without initialisation) and chose the smalest one</span>
0088             iclosest_1=iclosest0;   <span class="comment">%iclosest_1 is the index of the closest point in image i-1</span>
0089             dist_1=dist0;    <span class="comment">%dist_1 is the distance after icp to the closest point in image i-1</span>
0090         <span class="keyword">else</span>
0091             iclosest_1=iclosest1;   <span class="comment">%iclosest_1 is the index of the closest point in image i-1</span>
0092             dist_1=dist1;   <span class="comment">%dist_1 is the distance after icp to the closest point in image i-1</span>
0093         <span class="keyword">end</span>
0094         
0095         
0096     <span class="keyword">end</span>
0097     
0098     dist_min=dist_1;    <span class="comment">% if tey are not 3 images in imput, the distance to the closest point is the final distance dist_min</span>
0099     <span class="keyword">for</span> i=1:length(x)
0100         n(i)=objecti_1(indexi_1(iclosest_1(i))).n;  <span class="comment">% n is an array of labels of best matchimg point in image i-1</span>
0101     <span class="keyword">end</span>;
0102     
0103     
0104     <span class="keyword">if</span> (nargin&gt;=4) <span class="comment">% if mapping with image i-1 and i-2</span>
0105         <span class="keyword">if</span> min([size(x2,2),size(x,2)])&lt;3 <span class="comment">%when they are fewer than 3 points not using the initialisation</span>
0106             [R0,T0,iclosest_2,dist_2,Error0]=<a href="phy_icp.html" class="code" title="function [TR, TT, iclosest,distance,ERROR] = phy_icp(model,data,max_iter,min_iter,fitting,thres,init_flag,tes_flag,refpnt)">phy_icp</a>([x2; y2],[x; y],10,2,[3,min([size(x2,2),size(x,2)])],1,0);
0107         <span class="keyword">else</span>
0108             <span class="comment">% [R,T,iclosest,distance,ERROR] =</span>
0109             <span class="comment">% phy_icp(model,data,max_iter,min_iter,fitting,thres,init_flag,tes_flag)</span>
0110             <span class="comment">%[R0,T0,iclosest_2,dist_2,Error0]=phy_icp([x2; y2],[x; y],10,2,[3,min([size(x2,2),size(x,2)])],1,1);</span>
0111             
0112             <span class="comment">%the final argument 1/0 do or not an initialisation by translation (the same median)</span>
0113             <span class="comment">%iclosest_2 is the index of the closest point in image i-2</span>
0114             <span class="comment">%dist_2 is the distance after icp to the closest point in image i-2</span>
0115             [R0,T0,iclosest0,dist0,Error0]=<a href="phy_icp.html" class="code" title="function [TR, TT, iclosest,distance,ERROR] = phy_icp(model,data,max_iter,min_iter,fitting,thres,init_flag,tes_flag,refpnt)">phy_icp</a>([x2; y2],[x; y],10,2,[3,min([size(x2,2),size(x,2)])],0.01,0);
0116             [R1,T1,iclosest1,dist1,Error1]=<a href="phy_icp.html" class="code" title="function [TR, TT, iclosest,distance,ERROR] = phy_icp(model,data,max_iter,min_iter,fitting,thres,init_flag,tes_flag,refpnt)">phy_icp</a>([x2; y2],[x; y],10,2,[3,min([size(x2,2),size(x,2)])],0.01,1);
0117             <span class="comment">%the final 1/0 do or not an initialisation by translation (the same median)</span>
0118             
0119             <span class="keyword">if</span> Error0&lt;=Error1
0120                 iclosest_2=iclosest0;   <span class="comment">%iclosest_2 is the index of the closest point in image i-2</span>
0121                 dist_2=dist0;   <span class="comment">%dist_2 is the distance after icp to the closest point in image i-2</span>
0122             <span class="keyword">else</span>
0123                 iclosest_2=iclosest1;   <span class="comment">%iclosest_2 is the index of the closest point in image i-2</span>
0124                 dist_2=dist1;    <span class="comment">%dist_2 is the distance after icp to the closest point in image i-2</span>
0125             <span class="keyword">end</span>
0126             
0127         <span class="keyword">end</span>
0128         
0129         <span class="keyword">for</span> i=1:length(x)        <span class="comment">%keep the index and the distance of the minimum distance betwen image i-1 and i-2</span>
0130             <span class="keyword">if</span> dist_1(i)&lt;dist_2(i)  <span class="comment">%distance to the closest point is the final distance dist_min (= dist from i-1 or i-2)</span>
0131                 dist_min(i)=dist_1(i);
0132                 n(i)=objecti_1(indexi_1(iclosest_1(i))).n;
0133             <span class="keyword">else</span>
0134                 dist_min(i)=dist_2(i);
0135                 n(i)=objecti_2(indexi_2(iclosest_2(i))).n;
0136             <span class="keyword">end</span>
0137         <span class="keyword">end</span>
0138     <span class="keyword">end</span>
0139     
0140     n_final=zeros(1,length(x)); <span class="comment">%final labeling</span>
0141     <span class="keyword">for</span> i=1:length(x)
0142         a=find(n==n(i));    <span class="comment">%if 2 or more point asociated with the same pevious point</span>
0143         <span class="comment">%keep only the one with minimum distance</span>
0144         [mini indi]=min(dist_min(a));
0145         <span class="keyword">if</span> dist_min(a(indi))&lt;distanceParameter; <span class="comment">%parameter; if the distance smalar than the parameter then the final label</span>
0146             n_final(a(indi))=n(a(indi));
0147         <span class="keyword">end</span>
0148     <span class="keyword">end</span>
0149     
0150     <span class="keyword">for</span> i=1:length(x)
0151         <span class="keyword">if</span> n_final(i)~=0
0152             objectOut(indexi(i)).n=n_final(i);
0153         <span class="keyword">else</span>
0154             lastObjNumber=lastObjNumber+1;  <span class="comment">%if no label (distance to big/ new point..) , a new label will be given</span>
0155             objectOut(indexi(i)).n=lastObjNumber;
0156         <span class="keyword">end</span>
0157     <span class="keyword">end</span>
0158     
0159 <span class="keyword">end</span>
0160 
0161 
0162 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Wed 27-Oct-2010 20:01:59 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2003</address>
</body>
</html>