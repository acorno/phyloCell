<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of phy_setMothersWithoutBudneck</title>
  <meta name="keywords" content="phy_setMothersWithoutBudneck">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<!-- # phyloCell -->
<h1>phy_setMothersWithoutBudneck
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function phy_setMothersWithoutBudneck(fch,firstMCell,firstCells) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="phy_progressbar.html" class="code" title="function [stopBar] =  phy_progressbar(fractiondone, position)">phy_progressbar</a>	this m-file modified by Quan Quach on 12/12/07</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="phyloCell_mainGUI.html" class="code" title="function varargout = phyloCell_mainGUI(varargin)">phyloCell_mainGUI</a>	Main graphical user interface;</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function setMoth(tcell)</a></li></ul>
<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function phy_setMothersWithoutBudneck(fch,firstMCell,firstCells)</a>
0002 
0003 <span class="keyword">global</span> displayImage;
0004 <span class="keyword">global</span> cells1;
0005 <span class="keyword">global</span> frameChanged;
0006 <span class="keyword">global</span> tcells1;
0007 <span class="keyword">global</span> budnecktime;
0008 <span class="keyword">global</span> divisionTime;
0009 <span class="keyword">global</span> segmentation;
0010 
0011 cells1=segmentation.cells1;
0012 frameChanged=segmentation.frameChanged;
0013 tcells1=segmentation.tcells1;
0014 displayImage=segmentation.displayImage;
0015 
0016 
0017 
0018 <span class="comment">%---------------------------------------</span>
0019 prompt = {<span class="string">'Enter the theoretical number of frames between budding and division :'</span>,<span class="string">'Enter expected division time cycle (frames) :'</span>};
0020 dlg_title = <span class="string">'Timing Parametres'</span>;
0021 num_lines = 1;
0022 def = {<span class="string">'15'</span>,<span class="string">'20'</span>};
0023 answer = inputdlg(prompt,dlg_title,num_lines,def);
0024 <span class="keyword">if</span> isempty(answer)
0025     <span class="keyword">return</span>
0026 <span class="keyword">end</span>
0027 <span class="comment">%-----------------------</span>
0028 
0029 budnecktime=str2double(answer(1));
0030 divisionTime=str2double(answer(2));
0031 
0032 
0033 tcells1(firstMCell).setMother(firstMCell);
0034 tcells1(firstMCell).detectionFrame=-10;
0035 <span class="comment">% tcells1(3).setMother(2)</span>
0036 <span class="keyword">for</span> i=firstCells
0037     tcells1(i).birthFrame=0;
0038     tcells1(i).setMother(firstMCell);
0039     tcells1(i).detectionFrame=-10;
0040     tcells1(firstMCell).removeDaughter(i);
0041     tcells1(firstMCell).addDaughter(i,0,0);
0042 <span class="keyword">end</span>
0043 
0044 <span class="comment">%create a progress bar</span>
0045 <a href="phy_progressbar.html" class="code" title="function [stopBar] =  phy_progressbar(fractiondone, position)">phy_progressbar</a>;
0046 <span class="keyword">for</span> i=fch
0047     <a href="phy_progressbar.html" class="code" title="function [stopBar] =  phy_progressbar(fractiondone, position)">phy_progressbar</a>(i/length(fch));
0048     cell2=cells1(i,:);
0049     
0050     <span class="comment">%create the masks and count the overlap</span>
0051     masks2=(zeros(size(displayImage(:,:,1))));
0052     
0053     <span class="keyword">for</span> j=1:length(cell2)
0054         <span class="keyword">if</span> cells1(i,j).n~=0
0055             bw_cell = poly2mask(cell2(j).x,cell2(j).y,size(displayImage,1),size(displayImage,2));
0056             masks2(bw_cell)=cell2(j).n;
0057         <span class="keyword">end</span>
0058     <span class="keyword">end</span>
0059     <span class="comment">%figure;imshow(masks2);</span>
0060     
0061     <span class="keyword">for</span> j=1:length(cell2)
0062         <span class="keyword">if</span> cells1(i,j).ox~=0 &amp;&amp; tcells1(cells1(i,j).n).detectionFrame+budnecktime&gt;=i
0063             cells1(i,j).cell2=[];
0064             bw_c = poly2mask(cell2(j).x,cell2(j).y,size(displayImage,1),size(displayImage,2));
0065             <span class="comment">%figure;imshow(bw_c);</span>
0066             se = strel(<span class="string">'disk'</span>,7);
0067             bw_cdilate=imdilate(bw_c,se);
0068             <span class="comment">%figure;imshow(bw_cdilate);</span>
0069             bw_test=logical(bw_cdilate-bw_c);
0070             <span class="comment">%figure;imshow(bw_test);</span>
0071             mothers=[];
0072             m=masks2(bw_test);
0073             ind=find(m,1,<span class="string">'first'</span>);
0074             <span class="keyword">while</span> ~isempty(ind)
0075                 mothers=[mothers,m(ind)];
0076                 m(m==m(ind))=0;
0077                 ind=find(m,1,<span class="string">'first'</span>);
0078             <span class="keyword">end</span>;
0079             cells1(i,j).cell2=mothers;
0080             cells1(i,j).cell1=mothers;
0081         <span class="keyword">end</span>
0082     <span class="keyword">end</span>
0083     frameChanged(i)=0;
0084 <span class="keyword">end</span>
0085 <a href="phy_progressbar.html" class="code" title="function [stopBar] =  phy_progressbar(fractiondone, position)">phy_progressbar</a>(1);
0086 pause(0.1);
0087 
0088 <span class="keyword">for</span> i=1:numel(cells1)
0089     cells1(i).cell2=cells1(i).cell1;
0090 <span class="keyword">end</span>
0091 <a href="phy_progressbar.html" class="code" title="function [stopBar] =  phy_progressbar(fractiondone, position)">phy_progressbar</a>;
0092 <span class="keyword">for</span> i=1:length(tcells1)
0093     <a href="phy_progressbar.html" class="code" title="function [stopBar] =  phy_progressbar(fractiondone, position)">phy_progressbar</a>(i/length(tcells1));
0094     <span class="keyword">if</span> tcells1(i).N~=firstMCell &amp;&amp; ~any(firstCells==tcells1(i).N)
0095         <a href="#_sub1" class="code" title="subfunction setMoth(tcell)">setMoth</a>(tcells1(i));
0096     <span class="keyword">end</span>
0097 <span class="keyword">end</span>
0098 
0099 <a href="phy_progressbar.html" class="code" title="function [stopBar] =  phy_progressbar(fractiondone, position)">phy_progressbar</a>(1);
0100 pause(0.1);
0101 disp(<span class="string">'cell with no mothers'</span>);
0102 <span class="keyword">for</span> i=1:length(tcells1)
0103     <span class="keyword">if</span> tcells1(i).mother==0 &amp;&amp; tcells1(i).N~=0
0104         disp(tcells1(i).N);
0105     <span class="keyword">end</span>
0106 <span class="keyword">end</span>
0107 
0108 tcells1(firstMCell).setMother(0,0);
0109 
0110 segmentation.cells1=cells1;
0111 segmentation.frameChanged=frameChanged;
0112 segmentation.tcells1=tcells1;
0113 
0114 
0115 <a name="_sub1" href="#_subfunctions" class="code">function setMoth(tcell)</a>
0116 <span class="keyword">global</span> cells1;
0117 <span class="keyword">global</span> budnecktime;
0118 <span class="keyword">global</span> divisionTime;
0119 <span class="keyword">global</span> tcells1;
0120 <span class="keyword">if</span> tcell.N==0
0121     <span class="keyword">return</span>
0122 <span class="keyword">end</span>
0123 motherSeted=false;
0124 disp(tcell.N)
0125 <span class="keyword">if</span> tcell.mother==0
0126     <span class="keyword">for</span> j=1:length(tcell.Obj)
0127         <span class="keyword">if</span> tcell.Obj(j).image&gt;=tcell.detectionFrame &amp;&amp; <span class="keyword">...</span>
0128                 tcell.Obj(j).image&lt;=tcell.detectionFrame+budnecktime
0129             <span class="keyword">if</span> length(tcell.Obj(j).cell2)==1 &amp;&amp; tcell.mother==0
0130                 motherSet=tcell.setMother(tcell.Obj(j).cell2);
0131                 tcell.birthFrame=tcell.detectionFrame;
0132                 <span class="keyword">if</span> motherSet
0133                     divisionStart=tcell.detectionFrame;
0134                     divisionEnd=tcell.detectionFrame;
0135                     tcells1(tcell.Obj(j).cell2).addDaughter(tcell.N,divisionStart,divisionEnd);
0136                 <span class="keyword">end</span>
0137                 
0138                 motherSeted=true;
0139             <span class="keyword">end</span>
0140             <span class="keyword">if</span> ~isempty(tcell.Obj(j).cell2)
0141                 <span class="keyword">if</span> isempty(tcell.mothers)
0142                     tcell.mothers=tcell.Obj(j).cell2;
0143                 <span class="keyword">else</span>
0144                     <span class="keyword">if</span> length(tcell.mothers)&gt;=length(tcell.Obj(j).cell2)
0145                         tcell.mothers=tcell.Obj(j).cell2;
0146                     <span class="keyword">end</span>
0147                 <span class="keyword">end</span>
0148             <span class="keyword">end</span>
0149             
0150         <span class="keyword">end</span>
0151     <span class="keyword">end</span>
0152 <span class="keyword">else</span>
0153     motherSeted=true;
0154 <span class="keyword">end</span>
0155 linkedCells=[];
0156 
0157 <span class="comment">%</span>
0158 <span class="keyword">for</span> i=max(1,tcell.detectionFrame):min(tcell.detectionFrame+divisionTime+5,size(cells1,1))
0159     <span class="keyword">for</span> j=1:size(cells1,2)
0160         ind=find(cells1(i,j).cell2==tcell.N);
0161         cells1(i,j).cell2(ind)=[];
0162         <span class="keyword">if</span> ~isempty(ind)
0163             <span class="keyword">if</span> cells1(i,j).n&lt;tcell.N &amp;&amp; ~any(linkedCells==cells1(i,j).n)
0164                 linkedCells=[linkedCells cells1(i,j).n];
0165             <span class="keyword">end</span>
0166         <span class="keyword">end</span>
0167     <span class="keyword">end</span>
0168 <span class="keyword">end</span>
0169 
0170 <span class="keyword">if</span> motherSeted
0171     <span class="keyword">for</span> i=max(1,tcell.detectionFrame-divisionTime):min(tcell.detectionFrame+divisionTime,size(cells1,1))
0172         <span class="keyword">for</span> j=1:size(cells1,2)
0173             ind=find(cells1(i,j).cell2==tcell.mother);
0174             cells1(i,j).cell2(ind)=[];
0175             <span class="keyword">if</span> ~isempty(ind)
0176                 <span class="keyword">if</span> cells1(i,j).n&lt;tcell.N &amp;&amp; ~any(linkedCells==cells1(i,j).n)
0177                     linkedCells=[linkedCells cells1(i,j).n];
0178                 <span class="keyword">end</span>
0179             <span class="keyword">end</span>
0180         <span class="keyword">end</span>
0181     <span class="keyword">end</span>
0182     
0183 <span class="keyword">end</span>
0184 
0185 <span class="keyword">for</span> l=linkedCells
0186     <a href="#_sub1" class="code" title="subfunction setMoth(tcell)">setMoth</a>(tcells1(l));
0187 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Wed 27-Oct-2010 20:01:59 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2003</address>
</body>
</html>