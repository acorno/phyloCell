<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of phyloCell_mainGUI</title>
  <meta name="keywords" content="phyloCell_mainGUI">
  <meta name="description" content="Main graphical user interface;">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<!-- # phyloCell -->
<h1>phyloCell_mainGUI
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>Main graphical user interface;</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function varargout = phyloCell_mainGUI(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">Main graphical user interface;
Bild the main figure and all the grafics on that figure;
Call all the algorithms.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="phy_Object.html" class="code" title="">phy_Object</a>	</li><li><a href="phy_Tobject.html" class="code" title="">phy_Tobject</a>	</li><li><a href="phy_cell2csv.html" class="code" title="function phy_cell2csv(datName,cellArray,seperator,excelVersion)">phy_cell2csv</a>	Writes cell array content into a *.csv file.</li><li><a href="phy_createTimeLapseProjectGui.html" class="code" title="function varargout = phy_createTimeLapseProjectGui(varargin)">phy_createTimeLapseProjectGui</a>	create time lapse project from images</li><li><a href="phy_inputsdlg.html" class="code" title="function [Answer,Canceled] = phy_inputsdlg(Prompt, Title, Formats, DefAns, Options)">phy_inputsdlg</a>	INPUTSDLG Enhanced input dialog box supporting multiple data types</li><li><a href="phy_loadTimeLapseImage.html" class="code" title="function image=phy_loadTimeLapseImage(pos,frame,ch,option)">phy_loadTimeLapseImage</a>	toa an image from a project</li><li><a href="phy_makeTObject.html" class="code" title="function [tObjectOut fChanged]=phy_makeTObject(objects,tObjectIn)">phy_makeTObject</a>	refresh the link(the pointers) between the image cells and the Tobjects</li><li><a href="phy_mapObjects.html" class="code" title="function objectOut=phy_mapObjects(distanceParameter,objecti,objecti_1,objecti_2)">phy_mapObjects</a>	mapping objects</li><li><a href="phy_openProjectGui.html" class="code" title="function varargout = phy_openProjectGui(varargin)">phy_openProjectGui</a>	manage already oppened projects;</li><li><a href="phy_plotPedigree.html" class="code" title="function [haxe himg]=phy_plotPedigree(tcells,option)">phy_plotPedigree</a>	this function plots the pedigree in a separate figure</li><li><a href="phy_progressbar.html" class="code" title="function [stopBar] =  phy_progressbar(fractiondone, position)">phy_progressbar</a>	this m-file modified by Quan Quach on 12/12/07</li><li><a href="phy_scale.html" class="code" title="function y = phy_scale(varargin)">phy_scale</a>	SCALE  Scales matrix elements to a new range.</li><li><a href="phy_segmentBudneck.html" class="code" title="function [budneck]=phy_segmentBudneck(img,parametres)">phy_segmentBudneck</a>	segment budneck function</li><li><a href="phy_segmentCellsBallon.html" class="code" title="function cellsout=phy_segmentCellsBallon(image,cellsin,option,killcells,parametres)">phy_segmentCellsBallon</a>	find cell center based on phase image using bwdist to detect cell centers and</li><li><a href="phy_segmentCellsOmothetie.html" class="code" title="function cell=phy_segmentCellsOmothetie(imdata,param,display)">phy_segmentCellsOmothetie</a>	segmentation funtion of cells by omothetie</li><li><a href="phy_segmentCellsWatershedForme.html" class="code" title="function cells=phy_segmentCellsWatershedForme(imdata,parametres)">phy_segmentCellsWatershedForme</a>	segment cells with watershed method</li><li><a href="phy_segmentCellsWatershedFormeBF.html" class="code" title="function cells=phy_segmentCellsWatershedFormeBF(imdata,parametres)">phy_segmentCellsWatershedFormeBF</a>	segment cells with watershed method</li><li><a href="phy_setColorsGui.html" class="code" title="function varargout = phy_setColorsGui(varargin)">phy_setColorsGui</a>	set the colors of the displayed channels</li><li><a href="phy_setMothers.html" class="code" title="function [tcells tbudnecks]=phy_setMothers(tcells,tbudnecks,cell,firstMCell,firstCells)">phy_setMothers</a>	Based on the geometrical overlap of budnecks and cells, this function</li><li><a href="phy_setMothersWithoutBudneck.html" class="code" title="function phy_setMothersWithoutBudneck(fch,firstMCell,firstCells)">phy_setMothersWithoutBudneck</a>	</li><li><a href="phy_showObject.html" class="code" title="function [hplot htext]=phy_showObject(haxe,object,color,name,hplotin,htextin,option)">phy_showObject</a>	show the contours of the objects on an image</li><li><a href="phy_showPedigree.html" class="code" title="function h=phy_showPedigree(haxe,cells,hin,option)">phy_showPedigree</a>	shows pedigree on the figure(lines between the cells)</li><li><a href="phy_struct2class.html" class="code" title="function cells_class=phy_struct2class(cells_struct)">phy_struct2class</a>	change from cells in struct format to cells in class format</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="start.html" class="code" title="">start</a>	start the main program</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function phyloCell_mainGUI_OpeningFcn(hObject, eventdata, handles, varargin)</a></li><li><a href="#_sub2" class="code">function varargout = phyloCell_mainGUI_OutputFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub3" class="code">function pushbutton_First1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub4" class="code">function pushbutton_Previous1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub5" class="code">function pushbutton_Next1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub6" class="code">function pushbutton_Last1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub7" class="code">function pushbutton_Play_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub8" class="code">function pushbutton_segImg_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub9" class="code">function pushbutton_segAll_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub10" class="code">function pushbutton_saveAll_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub11" class="code">function pushbutton_Set_Mother_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub12" class="code">function pushbutton_Set_Number_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub13" class="code">function pushbutton_Delete_Object_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub14" class="code">function pushbutton_Edit_Contour_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub15" class="code">function pushbutton_Create_Object_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub16" class="code">function pushbutton_Clear_Image_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub17" class="code">function pushbutton_Clear_All_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub18" class="code">function slider1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub19" class="code">function slider1_ButtonDownFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub20" class="code">function slider1_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub21" class="code">function slider1_KeyPressFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub22" class="code">function editFrame1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub23" class="code">function edit_Find_Cell_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub24" class="code">function edit_Find_Budneck_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub25" class="code">function edit_Find_Budneck_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub26" class="code">function editFrame1_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub27" class="code">function edit_Find_Cell_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub28" class="code">function edit_TCell_Properties_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub29" class="code">function edit_Cell_Properties_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub30" class="code">function edit_Channel_Poperties_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub31" class="code">function edit_Channel_Poperties_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub32" class="code">function listbox_Channels_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub33" class="code">function listbox_Channels_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub34" class="code">function File_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub35" class="code">function File_Open_TimeLapse_Project_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub36" class="code">function Create_Project_From_Images_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub37" class="code">function Segmentation_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub38" class="code">function Segmentation_SegmentCells_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub39" class="code">function Segmentation_MapCell_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub40" class="code">function Segmentation_SegmentBudneck_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub41" class="code">function Segmentation_MapBudneck_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub42" class="code">function Segmentation_Setings_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub43" class="code">function Pedigree_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub44" class="code">function Pedigree_MakeP_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub45" class="code">function Pedigree_Plot_Pedigree_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub46" class="code">function Pedigree_Setings_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub47" class="code">function Pedigree_Clear_Mothers_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub48" class="code">function View_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub49" class="code">function View_Edit_Cell_Properties_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub50" class="code">function View_Edit_TCell_Properties_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub51" class="code">function View_Set_Channels_Colors_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub52" class="code">function Check_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub53" class="code">function Check_Cells_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub54" class="code">function Check_Budnecks_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub55" class="code">function Export_Data_To_File_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub56" class="code">function Export_frame_to_image_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub57" class="code">function Export_frames_to_movie_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub58" class="code">function OpenProject_ClickedCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub59" class="code">function NewProject_ClickedCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub60" class="code">function handles=checkbox_ShowCells_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub61" class="code">function handles=checkbox_ShowBudneck_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub62" class="code">function handles=checkbox_ShowCells2_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub63" class="code">function handles=checkbox_Show_Pedigree_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub64" class="code">function Change_Disp1(pos,handles)</a></li><li><a href="#_sub65" class="code">function mouseFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub66" class="code">function checkBoxChannel_first(hObject, eventdata, handles)</a></li><li><a href="#_sub67" class="code">function editChannel_first(hObject, eventdata, handles)</a></li><li><a href="#_sub68" class="code">function mousePedigreePlot(hObject, eventdata, handles,haxe)</a></li><li><a href="#_sub69" class="code">function mouseAxesImage(hObject, eventdata, handles)</a></li><li><a href="#_sub70" class="code">function mouseSelectObject(hObject, eventdata, handles)</a></li><li><a href="#_sub71" class="code">function mouse_dragginObj(hObect,evendata,obj)</a></li><li><a href="#_sub72" class="code">function status(str,handles)</a></li><li><a href="#_sub73" class="code">function figure1_WindowKeyPressFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub74" class="code">function figure1_WindowButtonUpFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub75" class="code">function Set_Key_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub76" class="code">function Context_Objects_Edit_Contour_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub77" class="code">function Context_Objects_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub78" class="code">function Context_Objects_Set_Number_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub79" class="code">function Context_Objects_Delete_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub80" class="code">function Context_Objects_Copy_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub81" class="code">function Context_Objects_Move_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub82" class="code">function Context_Objects_Lock_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub83" class="code">function Context_Objects_Set_Mother_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub84" class="code">function Context_Objects_Copy_Next_Frame_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub85" class="code">function Context_Image_Paste_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub86" class="code">function Context_Image_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub87" class="code">function Context_Image_Paste_Images_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub88" class="code">function Check_Setings_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub89" class="code">function checkbox_Use_Display_Image_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub90" class="code">function checkbox_Use_Cropped_Image_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub91" class="code">function Analyse_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub92" class="code">function Analyse_Levels_Inside_Contours_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub93" class="code">function Analyse_Plot_Levels_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub94" class="code">function mouseFluoPlot(hObject, eventdata, ha)</a></li></ul>
<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%Main graphical user interface;</span>
0002 <span class="comment">%Bild the main figure and all the grafics on that figure;</span>
0003 <span class="comment">%Call all the algorithms.</span>
0004 
0005 <a name="_sub0" href="#_subfunctions" class="code">function varargout = phyloCell_mainGUI(varargin)</a>
0006 
0007 <span class="comment">% Begin initialization code - DO NOT EDIT</span>
0008 gui_Singleton = 1;
0009 gui_State = struct(<span class="string">'gui_Name'</span>,       mfilename, <span class="keyword">...</span>
0010     <span class="string">'gui_Singleton'</span>,  gui_Singleton, <span class="keyword">...</span>
0011     <span class="string">'gui_OpeningFcn'</span>, @<a href="#_sub1" class="code" title="subfunction phyloCell_mainGUI_OpeningFcn(hObject, eventdata, handles, varargin)">phyloCell_mainGUI_OpeningFcn</a>, <span class="keyword">...</span>
0012     <span class="string">'gui_OutputFcn'</span>,  @<a href="#_sub2" class="code" title="subfunction varargout = phyloCell_mainGUI_OutputFcn(hObject, eventdata, handles)">phyloCell_mainGUI_OutputFcn</a>, <span class="keyword">...</span>
0013     <span class="string">'gui_LayoutFcn'</span>,  [] , <span class="keyword">...</span>
0014     <span class="string">'gui_Callback'</span>,   []);
0015 <span class="keyword">if</span> nargin &amp;&amp; ischar(varargin{1})
0016     gui_State.gui_Callback = str2func(varargin{1});
0017 <span class="keyword">end</span>
0018 
0019 <span class="keyword">if</span> nargout
0020     [varargout{1:nargout}] = gui_mainfcn(gui_State, varargin{:});
0021 <span class="keyword">else</span>
0022     gui_mainfcn(gui_State, varargin{:});
0023 <span class="keyword">end</span>
0024 <span class="comment">% End initialization code - DO NOT EDIT</span>
0025 
0026 
0027 <span class="comment">% --- Executes just before phyloCell_mainGUI is made visible.</span>
0028 <a name="_sub1" href="#_subfunctions" class="code">function phyloCell_mainGUI_OpeningFcn(hObject, eventdata, handles, varargin)</a>
0029 <span class="comment">% This function has no output args, see OutputFcn.</span>
0030 <span class="comment">% hObject    handle to figure</span>
0031 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0032 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0033 <span class="comment">% varargin   command line arguments to phyloCell_mainGUI (see VARARGIN)</span>
0034 
0035 
0036 
0037 <span class="keyword">global</span> segmentation;
0038 
0039 <span class="comment">%Open projects is empty when a new widow is oppen</span>
0040 handles.openedProjects={};
0041 
0042 <span class="comment">%The folder of export is set to current folder</span>
0043 handles.exportDir=pwd;
0044 
0045 <span class="comment">%initialize with empty cells the shorcut keys</span>
0046 segmentation.shorcutKeys=cell(1,2);
0047 
0048 cla(handles.axes1);
0049 
0050 <span class="comment">%set the current folder to the function folder</span>
0051 spath=which(<span class="string">'phyloCell_mainGUI.m'</span>);
0052 [pathstr, name, ext, versn] = fileparts(spath);
0053 cd(pathstr);
0054 
0055 <span class="comment">%copy watershed mayer function to curent directory</span>
0056 <span class="keyword">if</span> exist(<span class="string">'watershed_meyer'</span>,<span class="string">'file'</span>)~=3
0057     watPath=fullfile(matlabroot, <span class="string">'toolbox/images/images/private/watershed_meyer.*'</span>);
0058     copyfile(watPath,pwd,<span class="string">'f'</span>);
0059 <span class="keyword">end</span>
0060 
0061 addpath CppFiles
0062 <span class="keyword">if</span> exist(<span class="string">'phy_WatershedForme'</span>,<span class="string">'file'</span>)~=3
0063     mex(<span class="string">'CppFiles/phy_WatershedForme.cpp'</span>)
0064 <span class="keyword">end</span>
0065 
0066 segmentation.play=false;
0067 segmentation.frame1=1;
0068 
0069 
0070 <span class="comment">%for the same zoom and pan in the next images;</span>
0071 handles.Zoom = zoom;  
0072 set(handles.Zoom,<span class="string">'ActionPostCallback'</span>,{@<a href="#_sub65" class="code" title="subfunction mouseFcn(hObject, eventdata, handles)">mouseFcn</a>,handles});
0073 
0074 handles.Pan = pan;
0075 set(handles.Pan,<span class="string">'ActionPostCallback'</span>,{@<a href="#_sub65" class="code" title="subfunction mouseFcn(hObject, eventdata, handles)">mouseFcn</a>,handles});
0076 
0077 <span class="comment">% Choose default command line output for phyloCell_mainGUI</span>
0078 handles.output = hObject;
0079 
0080 set(handles.slider1,<span class="string">'Value'</span>,1);
0081 set(handles.editFrame1, <span class="string">'String'</span>, <span class="string">'1'</span>);
0082 
0083 <span class="comment">% Update handles structure</span>
0084 guidata(hObject, handles);
0085 
0086 
0087 <span class="comment">% --- Outputs from this function are returned to the command line.</span>
0088 <a name="_sub2" href="#_subfunctions" class="code">function varargout = phyloCell_mainGUI_OutputFcn(hObject, eventdata, handles)</a>
0089 
0090 varargout{1} = handles.output;
0091 
0092 
0093 
0094 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0095 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%% PUSHBUTTON CALLBACK FUNCTIONS %%%%%%%%%%%%%%%%%</span>
0096 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0097 
0098 
0099 <span class="comment">% --- Executes on button press in pushbutton_First1.</span>
0100 <a name="_sub3" href="#_subfunctions" class="code">function pushbutton_First1_Callback(hObject, eventdata, handles)</a>
0101 Min=get(handles.slider1,<span class="string">'Min'</span>);
0102 <a href="#_sub64" class="code" title="subfunction Change_Disp1(pos,handles)">Change_Disp1</a>(Min,handles);
0103 
0104 
0105 
0106 <span class="comment">% --- Executes on button press in pushbutton_Previous1.</span>
0107 <a name="_sub4" href="#_subfunctions" class="code">function pushbutton_Previous1_Callback(hObject, eventdata, handles)</a>
0108 <span class="keyword">global</span> segmentation;
0109 pos=segmentation.frame1-1;
0110 <a href="#_sub64" class="code" title="subfunction Change_Disp1(pos,handles)">Change_Disp1</a>(pos,handles);
0111 
0112 
0113 
0114 <span class="comment">% --- Executes on button press in pushbutton_Next1.</span>
0115 <a name="_sub5" href="#_subfunctions" class="code">function pushbutton_Next1_Callback(hObject, eventdata, handles)</a>
0116 <span class="keyword">global</span> segmentation;
0117 pos=segmentation.frame1+1;
0118 <a href="#_sub64" class="code" title="subfunction Change_Disp1(pos,handles)">Change_Disp1</a>(pos,handles);
0119 
0120 
0121 
0122 
0123 <span class="comment">% --- Executes on button press in pushbutton_Last1.</span>
0124 <a name="_sub6" href="#_subfunctions" class="code">function pushbutton_Last1_Callback(hObject, eventdata, handles)</a>
0125 Max=get(handles.slider1,<span class="string">'Max'</span>);
0126 <a href="#_sub64" class="code" title="subfunction Change_Disp1(pos,handles)">Change_Disp1</a>(Max,handles);
0127 
0128 
0129 
0130 <span class="comment">% --- Executes on button press in pushbutton_Play.</span>
0131 <a name="_sub7" href="#_subfunctions" class="code">function pushbutton_Play_Callback(hObject, eventdata, handles)</a>
0132 
0133 <span class="keyword">global</span> segmentation;
0134 <span class="keyword">if</span> ~segmentation.play
0135     segmentation.play=true;
0136     set(hObject,<span class="string">'String'</span>,<span class="string">'Pause'</span>);
0137     <span class="keyword">for</span> i=segmentation.frame1:get(handles.slider1,<span class="string">'Max'</span>) <span class="comment">% from actual frame to the end</span>
0138         <a href="#_sub64" class="code" title="subfunction Change_Disp1(pos,handles)">Change_Disp1</a>(i,handles);  <span class="comment">%refresh actual frame</span>
0139         pause(0.2)
0140         <span class="comment">%if a second click on the button-exit the for loop;</span>
0141         <span class="keyword">if</span> ~segmentation.play
0142             <span class="keyword">break</span>
0143         <span class="keyword">end</span>
0144     <span class="keyword">end</span>
0145 <span class="keyword">else</span>
0146     <span class="comment">%second click change buton and the variable</span>
0147     segmentation.play=false;
0148     set(hObject,<span class="string">'String'</span>,<span class="string">'Play'</span>);
0149 <span class="keyword">end</span>
0150 <span class="comment">% the end of the loop rechange the button as before</span>
0151 segmentation.play=false;
0152 set(hObject,<span class="string">'String'</span>,<span class="string">'Play'</span>);
0153 
0154 <span class="comment">% --- Executes on button press in pushbutton_segImg.</span>
0155 <a name="_sub8" href="#_subfunctions" class="code">function pushbutton_segImg_Callback(hObject, eventdata, handles)</a>
0156 
0157 <span class="keyword">global</span> segmentation
0158 
0159 
0160 <span class="comment">%budneck=phy_Object;</span>
0161 budnecks=segmentation.budnecks;
0162 cells1=segmentation.cells1;
0163 <span class="comment">% cells2=segmentation.cells2;</span>
0164         ax=floor(segmentation.v_axe1);
0165 <span class="keyword">if</span> get(handles.checkbox_segBud,<span class="string">'Value'</span>)&amp;&amp;(segmentation.budneckChannel~=0) <span class="comment">%if check box and if a valid budneckchannel</span>
0166     <span class="keyword">if</span> ~(~(get(hObject,<span class="string">'Value'</span>))&amp;&amp;(segmentation.budnecksSegmented(segmentation.frame1)))<span class="comment">% execut always if buton pressed but not if already segmented</span>
0167         budnecks(segmentation.frame1,:)=<a href="phy_Object.html" class="code" title="">phy_Object</a>;
0168         <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>([<span class="string">'segment frame '</span>,num2str(segmentation.frame1),<span class="string">': budnecks'</span>],handles);
0169         budneck=<a href="phy_segmentBudneck.html" class="code" title="function [budneck]=phy_segmentBudneck(img,parametres)">phy_segmentBudneck</a>(segmentation.segmentationImage(:,:,segmentation.budneckChannel),segmentation.parametres);
0170         <span class="keyword">for</span> j=1:length(budneck)
0171             budneck(j).image=segmentation.frame1;
0172             <span class="keyword">if</span> get(handles.checkbox_Use_Cropped_Image,<span class="string">'value'</span>)
0173                 budneck(j).x=budneck(j).x+ax(1)-1;
0174                 budneck(j).y=budneck(j).y+ax(3)-1;
0175                 budneck(j).ox=budneck(j).ox+ax(1)-1;
0176                 budneck(j).oy=budneck(j).oy+ax(3)-1;
0177             <span class="keyword">end</span>
0178             budnecks(segmentation.frame1,j)=budneck(j);
0179         <span class="keyword">end</span>
0180         segmentation.frameChanged(segmentation.frame1)=1;
0181         segmentation.budnecksSegmented(segmentation.frame1)=1;
0182         <span class="keyword">if</span> length(budneck)==1 &amp;&amp; budneck.n==0
0183             segmentation.budnecksSegmented(segmentation.frame1)=0;
0184         <span class="keyword">end</span>
0185     <span class="keyword">end</span>
0186     <span class="keyword">if</span> ishandle(segmentation.myHandles.showBudnecks)
0187         delete(segmentation.myHandles.showBudnecks);
0188         delete(segmentation.myHandles.showBudnecksText);
0189     <span class="keyword">end</span>
0190     [segmentation.myHandles.showBudnecks segmentation.myHandles.showBudnecksText]=<a href="phy_showObject.html" class="code" title="function [hplot htext]=phy_showObject(haxe,object,color,name,hplotin,htextin,option)">phy_showObject</a>(handles.axes1,budnecks(segmentation.frame1,:),<span class="string">'b'</span>,<span class="string">'budnecks'</span>,segmentation.myHandles.showBudnecks,segmentation.myHandles.showBudnecksText,<span class="string">'on'</span>);
0191     set(segmentation.myHandles.showBudnecks(:),<span class="string">'ButtonDownFcn'</span>,{@<a href="#_sub70" class="code" title="subfunction mouseSelectObject(hObject, eventdata, handles)">mouseSelectObject</a>,handles});
0192     set(segmentation.myHandles.showBudnecks(:),<span class="string">'UIContextMenu'</span>,handles.Context_Objects);
0193     
0194     segmentation.frameChanged(segmentation.frame1)=1;
0195     segmentation.budnecksMapped(segmentation.frame1)=0;
0196 <span class="keyword">end</span>
0197 
0198 segmentation.budnecks=budnecks;
0199 
0200 <span class="keyword">if</span> get(handles.checkbox_segCells,<span class="string">'Value'</span>)&amp;&amp;(segmentation.phaseChannel~=0)
0201     
0202     <span class="keyword">if</span> ~(~(get(hObject,<span class="string">'Value'</span>))&amp;&amp;(segmentation.cells1Segmented(segmentation.frame1)))<span class="comment">% execut always if buton pressed but not if already segmented</span>
0203 <span class="comment">%         cells2(segmentation.frame1,:)=phy_Object;</span>
0204         cells1(segmentation.frame1,:)=<a href="phy_Object.html" class="code" title="">phy_Object</a>;
0205         <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>([<span class="string">'segment frame '</span>,num2str(segmentation.frame1),<span class="string">': cells'</span>],handles);
0206 
0207         <span class="keyword">switch</span> segmentation.parametres.segmentation
0208             <span class="keyword">case</span> 1
0209                 cells_struct=<a href="phy_segmentCellsBallon.html" class="code" title="function cellsout=phy_segmentCellsBallon(image,cellsin,option,killcells,parametres)">phy_segmentCellsBallon</a>(segmentation.segmentationImage(:,:,segmentation.phaseChannel),[],<span class="string">'ROI'</span>,[],segmentation.parametres);
0210                 cell=<a href="phy_struct2class.html" class="code" title="function cells_class=phy_struct2class(cells_struct)">phy_struct2class</a>(cells_struct);
0211                 <span class="keyword">for</span> l=1:length(cell)
0212                     cell(l).image=segmentation.frame1;
0213                     <span class="keyword">if</span> get(handles.checkbox_Use_Cropped_Image,<span class="string">'value'</span>)
0214                         cell(l).x=cell(l).x+ax(1)-1;
0215                         cell(l).y=cell(l).y+ax(3)-1;
0216                         cell(l).ox=cell(l).ox+ax(1)-1;
0217                         cell(l).oy=cell(l).oy+ax(3)-1;
0218                     <span class="keyword">end</span>
0219                     cells1(segmentation.frame1,l)=cell(l);
0220                 <span class="keyword">end</span>
0221             <span class="keyword">case</span> 2
0222                 cell=<a href="phy_segmentCellsWatershedForme.html" class="code" title="function cells=phy_segmentCellsWatershedForme(imdata,parametres)">phy_segmentCellsWatershedForme</a>(segmentation.segmentationImage(:,:,segmentation.phaseChannel),segmentation.parametres);
0223                 <span class="keyword">for</span> l=1:length(cell)
0224                     cell(l).image=segmentation.frame1;
0225                     <span class="keyword">if</span> get(handles.checkbox_Use_Cropped_Image,<span class="string">'value'</span>)
0226                         cell(l).x=cell(l).x+ax(1)-1;
0227                         cell(l).y=cell(l).y+ax(3)-1;
0228                         cell(l).ox=cell(l).ox+ax(1)-1;
0229                         cell(l).oy=cell(l).oy+ax(3)-1;
0230                     <span class="keyword">end</span>
0231                     cells1(segmentation.frame1,l)=cell(l);
0232                 <span class="keyword">end</span>
0233             <span class="keyword">case</span> 3
0234                 cell=<a href="phy_segmentCellsOmothetie.html" class="code" title="function cell=phy_segmentCellsOmothetie(imdata,param,display)">phy_segmentCellsOmothetie</a>(segmentation.segmentationImage(:,:,segmentation.phaseChannel),segmentation.parametres,0);
0235                 <span class="keyword">for</span> l=1:length(cell)
0236                     cell(l).image=segmentation.frame1;
0237                     <span class="keyword">if</span> get(handles.checkbox_Use_Cropped_Image,<span class="string">'value'</span>)
0238                         cell(l).x=cell(l).x+ax(1)-1;
0239                         cell(l).y=cell(l).y+ax(3)-1;
0240                         cell(l).ox=cell(l).ox+ax(1)-1;
0241                         cell(l).oy=cell(l).oy+ax(3)-1;
0242                     <span class="keyword">end</span>
0243                     cells1(segmentation.frame1,l)=cell(l);
0244                 <span class="keyword">end</span>
0245             <span class="keyword">case</span> 4
0246                 cell=<a href="phy_segmentCellsWatershedFormeBF.html" class="code" title="function cells=phy_segmentCellsWatershedFormeBF(imdata,parametres)">phy_segmentCellsWatershedFormeBF</a>(segmentation.segmentationImage(:,:,segmentation.phaseChannel),segmentation.parametres);
0247                 <span class="keyword">for</span> l=1:length(cell)
0248                     cell(l).image=segmentation.frame1;
0249                     <span class="keyword">if</span> get(handles.checkbox_Use_Cropped_Image,<span class="string">'value'</span>)
0250                         cell(l).x=cell(l).x+ax(1)-1;
0251                         cell(l).y=cell(l).y+ax(3)-1;
0252                         cell(l).ox=cell(l).ox+ax(1)-1;
0253                         cell(l).oy=cell(l).oy+ax(3)-1;
0254                     <span class="keyword">end</span>
0255                     cells1(segmentation.frame1,l)=cell(l);
0256                 <span class="keyword">end</span>
0257         <span class="keyword">end</span>
0258             
0259 
0260             segmentation.cells1Segmented(segmentation.frame1)=1;
0261             segmentation.frameChanged(segmentation.frame1)=1;
0262             segmentation.cells1Mapped(segmentation.frame1)=0;
0263 
0264             
0265     <span class="keyword">end</span>
0266     <span class="keyword">if</span> ishandle(segmentation.myHandles.showCells)
0267         delete(segmentation.myHandles.showCells);
0268         delete(segmentation.myHandles.showCellsText);
0269     <span class="keyword">end</span>
0270 
0271     [segmentation.myHandles.showCells segmentation.myHandles.showCellsText]=<a href="phy_showObject.html" class="code" title="function [hplot htext]=phy_showObject(haxe,object,color,name,hplotin,htextin,option)">phy_showObject</a>(handles.axes1,cells1(segmentation.frame1,:),<span class="string">'r'</span>,<span class="string">'cells1'</span>,segmentation.myHandles.showCells,segmentation.myHandles.showCellsText,<span class="string">'on'</span>);
0272     set(segmentation.myHandles.showCells(:),<span class="string">'ButtonDownFcn'</span>,{@<a href="#_sub70" class="code" title="subfunction mouseSelectObject(hObject, eventdata, handles)">mouseSelectObject</a>,handles});
0273     set(segmentation.myHandles.showCells(:),<span class="string">'UIContextMenu'</span>,handles.Context_Objects);
0274 
0275 <span class="keyword">end</span>
0276 segmentation.cells1=cells1;
0277 <span class="comment">% segmentation.cells2=cells2;</span>
0278 <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'Idle'</span>,handles);
0279 guidata(hObject, handles);
0280 
0281 <span class="comment">% --- Executes on button press in pushbutton_segAll.</span>
0282 <a name="_sub9" href="#_subfunctions" class="code">function pushbutton_segAll_Callback(hObject, eventdata, handles)</a>
0283 
0284 <span class="keyword">global</span> segmentation
0285 <span class="keyword">global</span> timeLapse
0286 
0287 <span class="keyword">if</span> ~segmentation.play
0288     
0289     <span class="comment">%---------------------</span>
0290     <span class="comment">%dialog box</span>
0291     prompt = {<span class="string">'Enter first frame:'</span>,<span class="string">'Enter last frame:'</span>};
0292     dlg_title = <span class="string">'Segment frames'</span>;
0293     num_lines = 1;
0294     def = {num2str(segmentation.frame1),num2str(timeLapse.numberOfFrames)};
0295     <span class="comment">%def = {num2str(bSeg(1)),num2str(bSeg(end))};</span>
0296     answer = inputdlg(prompt,dlg_title,num_lines,def);
0297     <span class="keyword">if</span> isempty(answer)
0298         segmentation.play=false;
0299         set(hObject,<span class="string">'String'</span>,<span class="string">'Segment All'</span>);
0300         <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'Idle'</span>,handles);
0301         <span class="keyword">return</span>
0302     <span class="keyword">end</span>
0303     startFrame=str2double(answer(1));
0304     endFrame=str2double(answer(2));
0305     <span class="comment">%-----------------------</span>
0306     segmentation.play=true;
0307     set(hObject,<span class="string">'String'</span>,<span class="string">'Pause'</span>);
0308     <span class="keyword">for</span> i=startFrame:endFrame
0309         <a href="#_sub64" class="code" title="subfunction Change_Disp1(pos,handles)">Change_Disp1</a>(i,handles);
0310         
0311         segmentation.frame1
0312         timeStart=tic;
0313         <a href="#_sub8" class="code" title="subfunction pushbutton_segImg_Callback(hObject, eventdata, handles)">pushbutton_segImg_Callback</a>(handles.pushbutton_segImg, eventdata, handles)
0314         toc(timeStart)
0315         pause(0.2);
0316         <span class="keyword">if</span> ~segmentation.play
0317             <span class="keyword">break</span>
0318         <span class="keyword">end</span>
0319     <span class="keyword">end</span>
0320 <span class="keyword">else</span>
0321     segmentation.play=false;
0322     set(hObject,<span class="string">'String'</span>,<span class="string">'Segment All'</span>);
0323 <span class="keyword">end</span>
0324 segmentation.play=false;
0325 set(hObject,<span class="string">'String'</span>,<span class="string">'Segment All'</span>);
0326 <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'Idle'</span>,handles);
0327 
0328 <span class="comment">% --- Executes on button press in pushbutton_saveAll.</span>
0329 <a name="_sub10" href="#_subfunctions" class="code">function pushbutton_saveAll_Callback(hObject, eventdata, handles)</a>
0330 
0331 <span class="keyword">global</span> timeLapse;
0332 <span class="keyword">global</span> segmentation
0333 
0334 <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'Saving'</span>,handles);
0335 tic
0336 
0337 save(fullfile(timeLapse.path,timeLapse.pathList.position{segmentation.position},<span class="string">'segmentation.mat'</span>),<span class="string">'segmentation'</span>);
0338       
0339 toc
0340 <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'Idle'</span>,handles);
0341 
0342 <span class="comment">% --- Executes on button press in pushbutton_Set_Mother.</span>
0343 <a name="_sub11" href="#_subfunctions" class="code">function pushbutton_Set_Mother_Callback(hObject, eventdata, handles)</a>
0344 <span class="keyword">global</span> segmentation
0345 <span class="comment">%---------------------------------------------</span>
0346 prompt = {<span class="string">'Enter mother number:'</span>};
0347 dlg_title = <span class="string">'Mother'</span>;
0348 num_lines = 1;
0349 def = {<span class="string">'0'</span>};
0350 answer = inputdlg(prompt,dlg_title,num_lines,def);
0351 <span class="keyword">if</span> isempty(answer)
0352     <span class="keyword">return</span>
0353 <span class="keyword">end</span>
0354 <span class="comment">%--------------------------------------------------</span>
0355 
0356 <span class="keyword">if</span> get(handles.radiobutton_Image,<span class="string">'Value'</span>)
0357 
0358     segmentation.selectedObj.mother=str2double((answer{1}));
0359     <span class="comment">%segmentation.frameChanged(segmentation.frame1)=1;</span>
0360 <span class="keyword">end</span>
0361 <span class="keyword">if</span> get(handles.radiobutton_All_Images,<span class="string">'Value'</span>)&amp;&amp;~isempty(segmentation.selectedTObj)
0362     m=str2double(answer{1});
0363     <span class="keyword">if</span> segmentation.selectedTObj.mother&gt;0
0364         tobj=segmentation.([<span class="string">'t'</span>,segmentation.selectedType]);
0365         tobj(segmentation.selectedTObj.mother).removeDaughter(segmentation.selectedTObj.N)
0366         segmentation.([<span class="string">'t'</span>,segmentation.selectedType])=tobj;
0367     <span class="keyword">end</span>
0368     segmentation.selectedTObj.setMother(0,0);
0369 
0370     
0371     <span class="keyword">if</span> m~=0
0372         segmentation.selectedTObj.setMother(m);
0373         segmentation.selectedTObj.birthFrame=segmentation.selectedTObj.detectionFrame;
0374         tobj=segmentation.([<span class="string">'t'</span>,segmentation.selectedType]);
0375         divisionStart=segmentation.selectedTObj.detectionFrame;
0376         divisionEnd=segmentation.selectedTObj.detectionFrame;
0377         tobj(m).addDaughter(segmentation.selectedTObj.N,divisionStart,divisionEnd);
0378         segmentation.([<span class="string">'t'</span>,segmentation.selectedType])=tobj;
0379         <span class="comment">%segmentation.frameChanged(segmentation.selectedTObj.detectionFrame:segmentation.selectedTObj.lastFrame)=1;</span>
0380     <span class="keyword">end</span>
0381 <span class="keyword">end</span>
0382 
0383 <span class="keyword">if</span> get(handles.radiobutton_From_This_Image,<span class="string">'Value'</span>)&amp;&amp;~isempty(segmentation.selectedTObj)
0384     segmentation.selectedTObj.setMother(0,segmentation.frame1);
0385     segmentation.selectedTObj.setMother(str2double(answer{1}),segmentation.frame1);
0386     <span class="comment">%segmentation.frameChanged(segmentation.frame1:segmentation.selectedTObj.lastFrame)=1;</span>
0387 <span class="keyword">end</span>
0388 
0389 <span class="comment">% --- Executes on button press in pushbutton_Set_Number.</span>
0390 <a name="_sub12" href="#_subfunctions" class="code">function pushbutton_Set_Number_Callback(hObject, eventdata, handles)</a>
0391 <span class="keyword">global</span> segmentation
0392 
0393 tobj=segmentation.([<span class="string">'t'</span>,segmentation.selectedType]);
0394 obj= segmentation.(segmentation.selectedType);
0395 
0396 prompt = {<span class="string">'Enter object number:'</span>};
0397 dlg_title = <span class="string">'Number'</span>;
0398 num_lines = 1;
0399 def = {num2str(length(tobj)+1)};
0400 answer = inputdlg(prompt,dlg_title,num_lines,def);
0401 
0402 <span class="keyword">if</span> ~isempty(answer)
0403     n=str2double(answer);
0404     
0405     <span class="keyword">if</span> ~isempty(segmentation.selectedTObj) <span class="comment">%if not already mapped</span>
0406         <span class="keyword">for</span> i=1:size(obj,2)
0407             <span class="keyword">if</span> obj(segmentation.frame1,i).n==n &amp;&amp; obj(segmentation.frame1,i)~=segmentation.selectedObj
0408                 button = questdlg({<span class="string">'An object with the same number already exist.'</span>,<span class="string">'Do you want to continue?'</span>,<span class="string">'(if YES: the object with same numbet will change the number)'</span>},<span class="string">'warning'</span>,<span class="string">'YES'</span>,<span class="string">'Cancel'</span>,<span class="string">'YES'</span>) ;
0409                 <span class="keyword">if</span> strcmp(button,<span class="string">'YES'</span>)
0410                     maxn=length(tobj);
0411                     tobj(end+1)=<a href="phy_Tobject.html" class="code" title="">phy_Tobject</a>;
0412                     tobj(n).setNumber(maxn+1);
0413                     tobj(end)=tobj(n);
0414                     tobj(n)=<a href="phy_Tobject.html" class="code" title="">phy_Tobject</a>;
0415                     set(obj(segmentation.frame1,i).htext,<span class="string">'string'</span>,num2str(maxn+1));
0416                     segmentation.([<span class="string">'t'</span>,segmentation.selectedType])=tobj;
0417                     segmentation.frameChanged(tobj(end).detectionFrame:tobj(end).lastFrame)=1;
0418                 <span class="keyword">else</span>
0419                     <span class="keyword">return</span>
0420                 <span class="keyword">end</span>
0421             <span class="keyword">end</span>
0422         <span class="keyword">end</span>
0423     <span class="keyword">end</span>
0424     
0425     <span class="keyword">if</span> get(handles.radiobutton_Image,<span class="string">'Value'</span>)
0426         segmentation.selectedObj.n=n;
0427         <span class="keyword">if</span> ~isempty(segmentation.selectedTObj)
0428             tobj=segmentation.([<span class="string">'t'</span>,segmentation.selectedType]);
0429             <span class="keyword">if</span> length(tobj)&lt;n
0430                 tobj(n)=<a href="phy_Tobject.html" class="code" title="">phy_Tobject</a>;
0431             <span class="keyword">end</span>
0432             tobj(n).addObject(segmentation.selectedObj);
0433             segmentation.selectedTObj.deleteObject(segmentation.selectedObj,<span class="string">'only from tobject'</span>);
0434             segmentation.([<span class="string">'t'</span>,segmentation.selectedType])=tobj;
0435         <span class="keyword">end</span>
0436         segmentation.frameChanged(segmentation.frame1)=1;
0437     <span class="keyword">end</span>
0438     
0439     <span class="keyword">if</span> get(handles.radiobutton_All_Images,<span class="string">'Value'</span>)&amp;&amp;~isempty(segmentation.selectedTObj)
0440         nold=segmentation.selectedTObj.N;
0441         <span class="keyword">if</span> n&gt;length(tobj)
0442             tobj(n)=<a href="phy_Tobject.html" class="code" title="">phy_Tobject</a>;
0443             
0444             tobj(n)=segmentation.selectedTObj;
0445             tobj(n).setNumber(n);
0446             tobj(nold)=<a href="phy_Tobject.html" class="code" title="">phy_Tobject</a>;
0447             segmentation.selectedTObj=tobj(n);
0448             segmentation.([<span class="string">'t'</span>,segmentation.selectedType])=tobj;
0449             segmentation.frameChanged(tobj(n).detectionFrame:tobj(n).lastFrame)=1;
0450         <span class="keyword">end</span>
0451             
0452         
0453     <span class="keyword">end</span>
0454     
0455     <span class="keyword">if</span> get(handles.radiobutton_From_This_Image,<span class="string">'Value'</span>)&amp;&amp;~isempty(segmentation.selectedTObj)
0456         button = questdlg([<span class="string">'The objects from this image to the end will be atached to the new object,'</span>,num2str(n)],<span class="string">'Warning'</span>,<span class="string">'OK'</span>,<span class="string">'Cancel'</span>,<span class="string">'OK'</span>) ;
0457         <span class="keyword">if</span> strcmp(button,<span class="string">'OK'</span>)
0458             tobj=segmentation.([<span class="string">'t'</span>,segmentation.selectedType]);
0459             <span class="keyword">if</span> length(tobj)&lt;n
0460                 tobj(n)=<a href="phy_Tobject.html" class="code" title="">phy_Tobject</a>;
0461             <span class="keyword">end</span>
0462             c=0;
0463             objectMoved=<a href="phy_Object.html" class="code" title="">phy_Object</a>;
0464             <span class="keyword">for</span> i=1:length(segmentation.selectedTObj.Obj)
0465                 <span class="keyword">if</span> segmentation.selectedTObj.Obj(i).image&gt;=segmentation.frame1
0466                     segmentation.selectedTObj.Obj(i).n=n;
0467                     tobj(n).addObject(segmentation.selectedTObj.Obj(i));
0468                     c=c+1;
0469                     objectMoved(c)=segmentation.selectedTObj.Obj(i);
0470                     
0471                 <span class="keyword">end</span>
0472             <span class="keyword">end</span>
0473             <span class="keyword">for</span> i=1:c
0474                 segmentation.selectedTObj.deleteObject(objectMoved(i),<span class="string">'only from tobject'</span>);
0475             <span class="keyword">end</span>
0476             segmentation.([<span class="string">'t'</span>,segmentation.selectedType])=tobj;
0477             segmentation.frameChanged(segmentation.frame1:tobj(n).lastFrame)=1;
0478         <span class="keyword">end</span>
0479         
0480     <span class="keyword">end</span>
0481     
0482     set(segmentation.selectedObj.htext,<span class="string">'string'</span>,num2str(n));
0483 <span class="keyword">end</span>
0484 
0485 <span class="comment">% --- Executes on button press in pushbutton_Delete_Object.</span>
0486 <a name="_sub13" href="#_subfunctions" class="code">function pushbutton_Delete_Object_Callback(hObject, eventdata, handles)</a>
0487 <span class="keyword">global</span> segmentation
0488 
0489 <span class="comment">% if ~isempty(segmentation.selectedTObj)</span>
0490 <span class="comment">%     %index=find(segmentation.selectedTObj.C==segmentation.selectedObj);</span>
0491 <span class="comment">%     segmentation.selectedTObj.Obj(segmentation.selectedTObj.Obj==segmentation.selectedObj)=[];</span>
0492 <span class="comment">% end</span>
0493 <span class="comment">% segmentation.selectedObj.ox=0;</span>
0494 <span class="comment">% segmentation.selectedObj.oy=0;</span>
0495 <span class="comment">% segmentation.selectedObj.n=0;</span>
0496 
0497 
0498 <span class="keyword">if</span> get(handles.radiobutton_Image,<span class="string">'Value'</span>)
0499     set([segmentation.selectedObj.htext,segmentation.selectedObj.hcontour],<span class="string">'visible'</span>,<span class="string">'off'</span>);
0500     <span class="keyword">if</span> ~isempty(segmentation.selectedTObj)
0501         segmentation.selectedTObj.deleteObject(segmentation.selectedObj);
0502     <span class="keyword">else</span>
0503         segmentation.selectedObj.ox=0;
0504         segmentation.selectedObj.oy=0;
0505         segmentation.selectedObj.n=0;
0506         
0507     <span class="keyword">end</span>
0508     segmentation.selectedObj=[];
0509     segmentation.frameChanged(segmentation.frame1)=1;
0510     
0511 <span class="keyword">end</span>
0512 <span class="keyword">if</span> get(handles.radiobutton_From_This_Image,<span class="string">'Value'</span>)
0513     <span class="keyword">if</span> ~isempty(segmentation.selectedTObj)
0514         button = questdlg({<span class="string">'The objects from this image to the end will be completely deleted.'</span>,<span class="string">'Are you shure?'</span>},<span class="string">'Warning'</span>,<span class="string">'Yes'</span>,<span class="string">'No'</span>,<span class="string">'Yes'</span>) ;
0515         <span class="keyword">if</span> strcmpi(button,<span class="string">'Yes'</span>)
0516             set([segmentation.selectedObj.htext,segmentation.selectedObj.hcontour],<span class="string">'visible'</span>,<span class="string">'off'</span>);
0517             segmentation.selectedTObj.deleteObject(segmentation.frame1);
0518            
0519             segmentation.selectedObj=[];
0520             segmentation.frameChanged(segmentation.frame1)=1;
0521             
0522         <span class="keyword">end</span>
0523     <span class="keyword">else</span>
0524         warndlg(<span class="string">'No mapping done. To delete use radio button &quot;image&quot;'</span>,<span class="string">' Warning'</span>);
0525     <span class="keyword">end</span>
0526 <span class="keyword">end</span>
0527 <span class="keyword">if</span> get(handles.radiobutton_All_Images,<span class="string">'Value'</span>)
0528     <span class="keyword">if</span> ~isempty(segmentation.selectedTObj)
0529         button = questdlg({<span class="string">'The objects from the detection frame to the end will be completely deleted.'</span>,<span class="string">'Are you shure?'</span>},<span class="string">'Warning'</span>,<span class="string">'Yes'</span>,<span class="string">'No'</span>,<span class="string">'Yes'</span>) ;
0530         <span class="keyword">if</span> strcmpi(button,<span class="string">'Yes'</span>)
0531             set([segmentation.selectedObj.htext,segmentation.selectedObj.hcontour],<span class="string">'visible'</span>,<span class="string">'off'</span>);
0532             segmentation.selectedTObj.deleteObject(<span class="string">'all'</span>);
0533             
0534             segmentation.selectedObj=[];
0535             segmentation.frameChanged(segmentation.frame1)=1;
0536             
0537         <span class="keyword">end</span>
0538     <span class="keyword">else</span>
0539         warndlg(<span class="string">'No mapping done. To delete use radio button &quot;image&quot;'</span>,<span class="string">' Warning'</span>);
0540     <span class="keyword">end</span>
0541 <span class="keyword">end</span>
0542 
0543 
0544 
0545 <span class="comment">% --- Executes on button press in pushbutton_Edit_Contour.</span>
0546 <a name="_sub14" href="#_subfunctions" class="code">function pushbutton_Edit_Contour_Callback(hObject, eventdata, handles)</a>
0547 <span class="keyword">global</span> segmentation
0548 
0549 set(segmentation.selectedObj.htext,<span class="string">'visible'</span>,<span class="string">'off'</span>);
0550 set(segmentation.selectedObj.hcontour,<span class="string">'visible'</span>,<span class="string">'off'</span>);
0551 [x,y] = getline(handles.axes1,<span class="string">'closed'</span>);
0552 segmentation.selectedObj.x=x;
0553 segmentation.selectedObj.y=y;
0554 segmentation.selectedObj.ox=mean(x);
0555 segmentation.selectedObj.oy=mean(y);
0556 segmentation.selectedObj.area=polyarea(x,y);
0557 set(segmentation.selectedObj.hcontour,<span class="string">'xData'</span>,x);
0558 set(segmentation.selectedObj.hcontour,<span class="string">'yData'</span>,y);
0559 set(segmentation.selectedObj.htext,<span class="string">'position'</span>,[mean(x),mean(y)]);
0560 set(segmentation.selectedObj.htext,<span class="string">'visible'</span>,<span class="string">'on'</span>);
0561 set(segmentation.selectedObj.hcontour,<span class="string">'visible'</span>,<span class="string">'on'</span>);
0562 segmentation.frameChanged(segmentation.frame1)=1;
0563 
0564 <span class="comment">% --- Executes on button press in pushbutton_Create_Object.</span>
0565 <a name="_sub15" href="#_subfunctions" class="code">function pushbutton_Create_Object_Callback(hObject, eventdata, handles)</a>
0566 <span class="keyword">global</span> segmentation
0567 
0568 <span class="comment">% create the dialog box</span>
0569 dim = [3 3]; <span class="comment">%number of objects in dialog box</span>
0570 Title = <span class="string">'Create object'</span>;
0571 
0572 Prompt = cell(1,2);
0573 Prompt{1,1} = <span class="string">'Chose the type and the number of the new object'</span>;
0574 Formats(1,1).type = <span class="string">'text'</span>;
0575 <span class="keyword">for</span> k = 2:dim(2) <span class="comment">% span the static text across the entire dialog</span>
0576    Formats(1,k).type = <span class="string">'none'</span>;
0577    Formats(1,k).limits = [0 1]; <span class="comment">% extend from left</span>
0578 <span class="keyword">end</span>
0579 
0580 Prompt(2,:) = {<span class="string">'Choose type of objects'</span>,<span class="string">'type'</span>};
0581 Formats(2,1).type = <span class="string">'list'</span>;
0582 Formats(2,1).style = <span class="string">'radiobutton'</span>;
0583 Formats(2,1).items = {<span class="string">'Budnecks'</span>,<span class="string">'Cells1'</span>};
0584 <span class="keyword">for</span> k = 2:dim(2) <span class="comment">% span the static text across the entire dialog</span>
0585    Formats(2,k).type = <span class="string">'none'</span>;
0586    Formats(2,k).limits = [0 1]; <span class="comment">% extend from left</span>
0587 <span class="keyword">end</span>
0588 
0589 Prompt(3,:) = {<span class="string">'Budneck Number'</span>,<span class="string">'budneck_number'</span>};
0590 Formats(3,1).type = <span class="string">'edit'</span>;
0591 Formats(3,1).format = <span class="string">'integer'</span>;
0592 Formats(3,1).limits = [0 9999]; <span class="comment">% 4-digits (positive #)</span>
0593 Formats(3,1).size = 50;
0594 
0595 Prompt(4,:) = {<span class="string">'Cell Number1'</span>,<span class="string">'cell_number1'</span>};
0596 Formats(3,2).type = <span class="string">'edit'</span>;
0597 Formats(3,2).format = <span class="string">'integer'</span>;
0598 Formats(3,2).limits = [0 9999]; <span class="comment">% 4-digits (positive #)</span>
0599 Formats(3,2).size = 50;
0600 <span class="comment">%</span>
0601 <span class="comment">% Prompt(5,:) = {'Cell Number2','cell_number2'};</span>
0602 <span class="comment">% Formats(3,3).type = 'edit';</span>
0603 <span class="comment">% Formats(3,3).format = 'integer';</span>
0604 <span class="comment">% Formats(3,3).limits = [0 9999]; % 4-digits (positive #)</span>
0605 <span class="comment">% Formats(3,3).size = 50;</span>
0606 
0607 DefAns.type = 2;
0608 <span class="keyword">if</span> ~isempty(segmentation.tbudnecks)
0609     DefAns.budneck_number = length(segmentation.tbudnecks)+1;
0610 <span class="keyword">else</span>
0611     DefAns.budneck_number=0;
0612 <span class="keyword">end</span>
0613 <span class="keyword">if</span> ~isempty(segmentation.tcells1)
0614     DefAns.cell_number1 = length(segmentation.tcells1)+1;
0615 <span class="keyword">else</span>
0616     DefAns.cell_number1=0;
0617 <span class="keyword">end</span>
0618 <span class="comment">% if ~isempty(segmentation.tcells2)</span>
0619 <span class="comment">%     DefAns.cell_number2=length(segmentation.tcells2)+1;</span>
0620 <span class="comment">% else</span>
0621 <span class="comment">%     DefAns.cell_number2=0;</span>
0622 <span class="comment">% end</span>
0623 
0624 
0625 
0626 
0627 [Answer,Cancelled] = <a href="phy_inputsdlg.html" class="code" title="function [Answer,Canceled] = phy_inputsdlg(Prompt, Title, Formats, DefAns, Options)">phy_inputsdlg</a>(Prompt,Title,Formats,DefAns);<span class="comment">%Options);</span>
0628 
0629 <span class="comment">% create the points</span>
0630 <span class="keyword">if</span> ~Cancelled
0631 <span class="comment">%     [x,y] = getline(handles.axes1,'closed');</span>
0632 <span class="comment">%     hold(handles.axes1,'on');</span>
0633 <span class="comment">%     plot(handles.axes1,x,y);</span>
0634 <span class="comment">%     hold(handles.axes1,'off');</span>
0635     hellipse=imellipse(handles.axes1);
0636     vertices=wait(hellipse);
0637     x=vertices(:,1);
0638     y=vertices(:,2);
0639     hellipse.delete;
0640     ox=mean(x);
0641     oy=mean(y);
0642     added=false;
0643     <span class="keyword">switch</span> Answer.type
0644         <span class="keyword">case</span> 1
0645             n=Answer.budneck_number;
0646             budn=<a href="phy_Object.html" class="code" title="">phy_Object</a>(n,x,y);
0647             budn.ox=ox;
0648             budn.oy=oy;
0649             budn.image=segmentation.frame1;
0650             budn.area=polyarea(x,y);
0651             <span class="keyword">for</span> i=1:length(segmentation.budnecks(segmentation.frame1,:))
0652                 <span class="keyword">if</span> segmentation.budnecks(segmentation.frame1,i).ox==0
0653                     segmentation.budnecks(segmentation.frame1,i)=budn;
0654                     added=true;
0655                     <span class="keyword">break</span>;
0656                 <span class="keyword">end</span>
0657             <span class="keyword">end</span>
0658             <span class="keyword">if</span> ~added
0659                 segmentation.budnecks(segmentation.frame1,end+1)=budn;
0660             <span class="keyword">end</span>
0661             <span class="keyword">if</span> n~=0 &amp;&amp; ~isempty(segmentation.selectedTObj)
0662                 <span class="keyword">if</span> n&gt;length(segmentation.tbudnecks)
0663                     segmentation.tbudnecks(n)=<a href="phy_Tobject.html" class="code" title="">phy_Tobject</a>;
0664                 <span class="keyword">end</span>
0665                 segmentation.tbudnecks(n).addObject(budn);
0666             <span class="keyword">end</span>
0667         <span class="keyword">case</span> 2
0668             n=Answer.cell_number1;
0669             cellule=<a href="phy_Object.html" class="code" title="">phy_Object</a>(n,x,y);
0670             cellule.ox=ox;
0671             cellule.oy=oy;
0672             cellule.image=segmentation.frame1;
0673             cellule.area=polyarea(x,y);
0674             <span class="keyword">for</span> i=1:length(segmentation.cells1(segmentation.frame1,:))
0675                 <span class="keyword">if</span> segmentation.cells1(segmentation.frame1,i).ox==0
0676                     segmentation.cells1(segmentation.frame1,i)=cellule;
0677                     added=true;
0678                     <span class="keyword">break</span>;
0679                 <span class="keyword">end</span>
0680             <span class="keyword">end</span>
0681             <span class="keyword">if</span> ~added
0682                 segmentation.cells1(segmentation.frame1,end+1)=cellule;
0683             <span class="keyword">end</span>
0684             <span class="keyword">if</span> n~=0 &amp;&amp; ~isempty(segmentation.selectedTObj)
0685                 <span class="keyword">if</span> n&gt;length(segmentation.tcells1)
0686                     segmentation.tcells1(n)=<a href="phy_Tobject.html" class="code" title="">phy_Tobject</a>;
0687                 <span class="keyword">end</span>
0688                 segmentation.tcells1(n).addObject(cellule);
0689             <span class="keyword">end</span>
0690 <span class="comment">%         case 3</span>
0691 <span class="comment">%             n=Answer.cell_number2;</span>
0692 <span class="comment">%             cellule=phy_Object(n,x,y);</span>
0693 <span class="comment">%             cellule.ox=ox;</span>
0694 <span class="comment">%             cellule.oy=oy;</span>
0695 <span class="comment">%             cellule.image=segmentation.frame1;</span>
0696 <span class="comment">%             cellule.area=polyarea(x,y);</span>
0697 <span class="comment">%             for i=1:length(segmentation.cells2(segmentation.frame1,:))</span>
0698 <span class="comment">%                 if segmentation.cells2(segmentation.frame1,i).ox==0</span>
0699 <span class="comment">%                     segmentation.cells2(segmentation.frame1,i)=cellule;</span>
0700 <span class="comment">%                     added=true;</span>
0701 <span class="comment">%                     break;</span>
0702 <span class="comment">%                 end</span>
0703 <span class="comment">%             end</span>
0704 <span class="comment">%             if ~added</span>
0705 <span class="comment">%                 segmentation.cells2(segmentation.frame1,end+1)=cellule;</span>
0706 <span class="comment">%             end</span>
0707 <span class="comment">%             if n~=0 &amp;&amp; ~isempty(segmentation.selectedTObj)</span>
0708 <span class="comment">%                 if n&gt;length(segmentation.tcells1)</span>
0709 <span class="comment">%                     segmentation.tcells2(n)=phy_Tobject;</span>
0710 <span class="comment">%                 end</span>
0711 <span class="comment">%                 segmentation.tcells2(n).addObject(cellule);</span>
0712 <span class="comment">%             end</span>
0713     <span class="keyword">end</span>
0714     <a href="#_sub64" class="code" title="subfunction Change_Disp1(pos,handles)">Change_Disp1</a>(<span class="string">'refresh'</span>,handles);
0715     segmentation.frameChanged(segmentation.frame1)=1;
0716 <span class="keyword">end</span>
0717 
0718 <span class="comment">% --- Executes on button press in pushbutton_Clear_Image.</span>
0719 <a name="_sub16" href="#_subfunctions" class="code">function pushbutton_Clear_Image_Callback(hObject, eventdata, handles)</a>
0720 
0721 <span class="keyword">global</span> segmentation
0722 <span class="comment">%  if segmentation.cells1Mapped(segmentation.frame1)</span>
0723 <span class="comment">% if segmentation.budnecksMapped(segmentation.frame1)</span>
0724 
0725 <span class="comment">%if get(handles.checkbox_segBud,'Value')</span>
0726 <span class="keyword">if</span> get(handles.checkbox_segCells,<span class="string">'Value'</span>)
0727     <span class="keyword">if</span> segmentation.cells1Mapped(segmentation.frame1)
0728         <span class="keyword">for</span> i=1:size(segmentation.cells1,2)
0729             <span class="keyword">if</span> segmentation.cells1(segmentation.frame1,i).n~=0
0730                 n=segmentation.cells1(segmentation.frame1,i).n;
0731                 segmentation.tcells1(n).deleteObject(segmentation.cells1(segmentation.frame1,i))
0732             <span class="keyword">end</span>
0733         <span class="keyword">end</span>
0734     <span class="keyword">end</span>
0735     segmentation.cells1(segmentation.frame1,:)=<a href="phy_Object.html" class="code" title="">phy_Object</a>;
0736     segmentation.cells1Segmented(segmentation.frame1)=0;
0737     segmentation.cells1Mapped(segmentation.frame1)=0;
0738     segmentation.frameChanged(segmentation.frame1)=1;
0739     <span class="keyword">if</span> ishandle(segmentation.myHandles.showCells)
0740         delete(segmentation.myHandles.showCells);
0741         delete(segmentation.myHandles.showCellsText);
0742     <span class="keyword">end</span>
0743     
0744 <span class="keyword">end</span>
0745 
0746 <span class="keyword">if</span> get(handles.checkbox_segBud,<span class="string">'Value'</span>)
0747     <span class="keyword">if</span> segmentation.budnecksMapped(segmentation.frame1)
0748         <span class="keyword">for</span> i=1:size(segmentation.budnecks,2)
0749             <span class="keyword">if</span> segmentation.budnecks(segmentation.frame1,i).n~=0
0750                 n=segmentation.budnecks(segmentation.frame1,i).n;
0751                 segmentation.tbudnecks(n).deleteObject(segmentation.budnecks(segmentation.frame1,i))
0752             <span class="keyword">end</span>
0753         <span class="keyword">end</span>
0754     <span class="keyword">end</span>
0755     segmentation.budnecks(segmentation.frame1,:)=<a href="phy_Object.html" class="code" title="">phy_Object</a>;
0756     segmentation.budnecksSegmented(segmentation.frame1)=0;
0757     segmentation.budnecksMapped(segmentation.frame1)=0;
0758     segmentation.frameChanged(segmentation.frame1)=1;
0759     <span class="keyword">if</span> ishandle(segmentation.myHandles.showBudnecks)
0760         delete(segmentation.myHandles.showBudnecks);
0761         delete(segmentation.myHandles.showBudnecksText);
0762     <span class="keyword">end</span>
0763 <span class="keyword">end</span>
0764 
0765 <span class="comment">% --- Executes on button press in pushbutton_Clear_All.</span>
0766 <a name="_sub17" href="#_subfunctions" class="code">function pushbutton_Clear_All_Callback(hObject, eventdata, handles)</a>
0767 
0768 <span class="keyword">global</span> segmentation
0769 
0770 <span class="keyword">if</span> get(handles.checkbox_segCells,<span class="string">'Value'</span>)
0771     segFrames=find(segmentation.cells1Segmented);
0772     def = {num2str(segFrames)};
0773 <span class="keyword">elseif</span> get(handles.checkbox_segBud,<span class="string">'Value'</span>)
0774     
0775     segFrames=find(segmentation.budnecksSegmented);
0776     def = {num2str(segFrames)};
0777 <span class="keyword">end</span>
0778     <span class="comment">%---------------------------------------</span>
0779     prompt = {<span class="string">'Enter the frames to clear'</span>};
0780     dlg_title = <span class="string">'Frames to clear'</span>;
0781     num_lines = 2;
0782 
0783     answer = inputdlg(prompt,dlg_title,num_lines,def);
0784     <span class="comment">%-----------------------</span>
0785 <span class="keyword">if</span> ~isempty(answer)&amp;&amp;~isempty(answer{1})
0786     clearFrames=str2num(answer{1});
0787     <span class="keyword">for</span> i=clearFrames
0788         segmentation.frame1=i;
0789         <a href="#_sub16" class="code" title="subfunction pushbutton_Clear_Image_Callback(hObject, eventdata, handles)">pushbutton_Clear_Image_Callback</a>(handles.pushbutton_Clear_Image, eventdata, handles);
0790     <span class="keyword">end</span>
0791 <span class="keyword">end</span>
0792 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0793 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%% SLIDER CALLBACK FUNCTIONS%%%%%%%%%%%%%%%%%%%%%%%%</span>
0794 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0795 
0796 <a name="_sub18" href="#_subfunctions" class="code">function slider1_Callback(hObject, eventdata, handles)</a>
0797 newVal = get(hObject, <span class="string">'Value'</span>);
0798 <a href="#_sub64" class="code" title="subfunction Change_Disp1(pos,handles)">Change_Disp1</a>(newVal,handles);
0799 
0800 
0801 
0802 <a name="_sub19" href="#_subfunctions" class="code">function slider1_ButtonDownFcn(hObject, eventdata, handles)</a>
0803 
0804 
0805 <a name="_sub20" href="#_subfunctions" class="code">function slider1_CreateFcn(hObject, eventdata, handles)</a>
0806 
0807 
0808 <span class="comment">% Hint: slider controls usually have a light gray background.</span>
0809 <span class="keyword">if</span> isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0810     set(hObject,<span class="string">'BackgroundColor'</span>,[.9 .9 .9]);
0811 <span class="keyword">end</span>
0812 
0813 <span class="comment">% --- Executes on key press with focus on slider1 and none of its controls.</span>
0814 <a name="_sub21" href="#_subfunctions" class="code">function slider1_KeyPressFcn(hObject, eventdata, handles)</a>
0815 <span class="comment">%</span>
0816 
0817 
0818 
0819 
0820 
0821 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0822 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%% EDIT CALLBACK FUNCTIONS%%%%%%%%%%%%%%%%%%%%%%%%</span>
0823 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0824 
0825 <a name="_sub22" href="#_subfunctions" class="code">function editFrame1_Callback(hObject, eventdata, handles)</a>
0826 NewStrVal = get(hObject, <span class="string">'String'</span>);
0827 NewVal = str2double(NewStrVal);
0828 <a href="#_sub64" class="code" title="subfunction Change_Disp1(pos,handles)">Change_Disp1</a>(NewVal,handles);
0829 
0830 <a name="_sub23" href="#_subfunctions" class="code">function edit_Find_Cell_Callback(hObject, eventdata, handles)</a>
0831 <span class="keyword">global</span> segmentation
0832 
0833 <span class="keyword">if</span> ~isempty(segmentation.selectedTObj)  <span class="comment">%if exist a selected tobject then delesect it</span>
0834     segmentation.selectedTObj.deselect();
0835     segmentation.selectedTObj={};
0836 <span class="keyword">end</span>
0837 <span class="keyword">if</span> ~isempty(segmentation.selectedObj) <span class="comment">%if exist a selected object then deselect it</span>
0838     segmentation.selectedObj.selected=0;
0839     segmentation.selectedObj={};    
0840 <span class="keyword">end</span>
0841 nCell=str2double(get(hObject,<span class="string">'string'</span>)); <span class="comment">%get the value of the edit case</span>
0842 <span class="keyword">if</span> nCell&lt;=length(segmentation.tcells1) &amp;&amp; nCell&gt;=1 <span class="comment">%if it is in the limits</span>
0843     <span class="keyword">if</span> segmentation.tcells1(nCell).N==nCell <span class="comment">%check if it was deleted (.N==0)</span>
0844         segmentation.tcells1(nCell).select(); <span class="comment">%select the new cell</span>
0845         segmentation.selectedTObj=segmentation.tcells1(nCell); <span class="comment">% copy it</span>
0846         <span class="keyword">if</span> segmentation.tcells1(nCell).detectionFrame==segmentation.frame1 <span class="comment">%refresh</span>
0847             <a href="#_sub64" class="code" title="subfunction Change_Disp1(pos,handles)">Change_Disp1</a>(<span class="string">'refresh'</span>,handles);
0848         <span class="keyword">else</span>
0849             <a href="#_sub64" class="code" title="subfunction Change_Disp1(pos,handles)">Change_Disp1</a>(segmentation.tcells1(nCell).detectionFrame,handles);
0850         <span class="keyword">end</span>
0851     <span class="keyword">else</span>
0852         set(hObject,<span class="string">'string'</span>,<span class="string">'Deleted'</span>);
0853     <span class="keyword">end</span>
0854 <span class="keyword">end</span>
0855 
0856 <a name="_sub24" href="#_subfunctions" class="code">function edit_Find_Budneck_Callback(hObject, eventdata, handles)</a>
0857 <span class="keyword">global</span> segmentation
0858 
0859 <span class="keyword">if</span> ~isempty(segmentation.selectedTObj)
0860     segmentation.selectedTObj.deselect();
0861 <span class="keyword">end</span>
0862 nCell=str2double(get(hObject,<span class="string">'string'</span>));
0863 <span class="keyword">if</span> nCell&lt;=length(segmentation.tbudnecks) &amp;&amp; nCell&gt;=1
0864     segmentation.tbudnecks(nCell).select();
0865     segmentation.selectedTObj=segmentation.tbudnecks(nCell);
0866     <span class="keyword">if</span> segmentation.tbudnecks(nCell).detectionFrame==segmentation.frame1
0867         <a href="#_sub64" class="code" title="subfunction Change_Disp1(pos,handles)">Change_Disp1</a>(<span class="string">'refresh'</span>,handles);
0868     <span class="keyword">else</span>
0869         <a href="#_sub64" class="code" title="subfunction Change_Disp1(pos,handles)">Change_Disp1</a>(segmentation.tbudnecks(nCell).detectionFrame,handles);
0870     <span class="keyword">end</span>
0871 <span class="keyword">end</span>
0872 
0873 
0874 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0875 <a name="_sub25" href="#_subfunctions" class="code">function edit_Find_Budneck_CreateFcn(hObject, eventdata, handles)</a>
0876 
0877 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0878     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0879 <span class="keyword">end</span>
0880 
0881 
0882 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0883 <a name="_sub26" href="#_subfunctions" class="code">function editFrame1_CreateFcn(hObject, eventdata, handles)</a>
0884 
0885 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0886     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0887 <span class="keyword">end</span>
0888 
0889 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0890 <a name="_sub27" href="#_subfunctions" class="code">function edit_Find_Cell_CreateFcn(hObject, eventdata, handles)</a>
0891 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0892     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0893 <span class="keyword">end</span>
0894 
0895 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0896 <a name="_sub28" href="#_subfunctions" class="code">function edit_TCell_Properties_CreateFcn(hObject, eventdata, handles)</a>
0897 
0898 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0899     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0900 <span class="keyword">end</span>
0901 
0902 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0903 <a name="_sub29" href="#_subfunctions" class="code">function edit_Cell_Properties_CreateFcn(hObject, eventdata, handles)</a>
0904 
0905 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0906     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0907 <span class="keyword">end</span>
0908 
0909 <a name="_sub30" href="#_subfunctions" class="code">function edit_Channel_Poperties_Callback(hObject, eventdata, handles)</a>
0910 <span class="comment">% allow to change the color and the saturation on the selected channel</span>
0911 <span class="keyword">global</span> segmentation
0912 
0913 chval=get(handles.listbox_Channels,<span class="string">'Value'</span>);
0914 newdata=str2num(get(hObject,<span class="string">'String'</span>));
0915 segmentation.colorData(chval,:)=newdata;
0916 <a href="#_sub64" class="code" title="subfunction Change_Disp1(pos,handles)">Change_Disp1</a>(<span class="string">'refresh'</span>,handles);
0917 
0918 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0919 <a name="_sub31" href="#_subfunctions" class="code">function edit_Channel_Poperties_CreateFcn(hObject, eventdata, handles)</a>
0920 
0921 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0922     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0923 <span class="keyword">end</span>
0924 
0925 
0926 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0927 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%% LISTBOX CALLBACK FUNCTIONS%%%%%%%%%%%%%%%%%%%%%%</span>
0928 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0929 
0930 <span class="comment">% --- Executes on selection change in listbox_Channels.</span>
0931 <a name="_sub32" href="#_subfunctions" class="code">function listbox_Channels_Callback(hObject, eventdata, handles)</a>
0932 <span class="keyword">global</span> segmentation
0933 
0934 butonType=get(handles.figure1,<span class="string">'SelectionType'</span>);
0935 chval = get(hObject,<span class="string">'Value'</span>);
0936 
0937 <span class="keyword">if</span> strcmp(butonType,<span class="string">'open'</span>)  <span class="comment">%duble click</span>
0938     <span class="keyword">if</span> any(segmentation.channels==chval)   <span class="comment">% if already shown</span>
0939         
0940         ind=find(segmentation.channels==chval);  <span class="comment">%find the chanel to be made invisible</span>
0941         <span class="keyword">for</span> i=ind:length(segmentation.channels)-1    <span class="comment">%deplace all the layers from the one to be deleted</span>
0942             imData=get(segmentation.himg(i+1),<span class="string">'Cdata'</span>);
0943             set(segmentation.himg(i),<span class="string">'Cdata'</span>,imData);
0944         <span class="keyword">end</span>
0945         im=zeros(1,1,3);
0946         set(segmentation.himg(length(segmentation.channels)),<span class="string">'CData'</span>,im); <span class="comment">%make the last layer invisible</span>
0947         set(segmentation.himg(length(segmentation.channels)),<span class="string">'Alphadata'</span>,0);
0948         segmentation.channels(ind)=[]; <span class="comment">%delete the index from the list</span>
0949 
0950     <span class="keyword">else</span>  <span class="comment">%if is not in the list / not already shown</span>
0951         segmentation.channels=[segmentation.channels chval]; <span class="comment">%add the new channel to the list</span>
0952         <a href="#_sub64" class="code" title="subfunction Change_Disp1(pos,handles)">Change_Disp1</a>(<span class="string">'refresh'</span>,handles);<span class="comment">%refresh dislay</span>
0953     <span class="keyword">end</span>
0954 <span class="keyword">end</span>
0955 str=get(hObject,<span class="string">'String'</span>);
0956 set(handles.text_Channels,<span class="string">'string'</span>,{str{segmentation.channels}});
0957 set(handles.edit_Channel_Poperties,<span class="string">'string'</span>,num2str(segmentation.colorData(chval,:),<span class="string">'(%0.1f) (%0.1f) (%0.1f) (%0.4f) (%0.4f) (%0.1f)'</span>));
0958 
0959 
0960 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0961 <a name="_sub33" href="#_subfunctions" class="code">function listbox_Channels_CreateFcn(hObject, eventdata, handles)</a>
0962 
0963 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0964     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0965 <span class="keyword">end</span>
0966 
0967 
0968 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0969 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%% MENU FUNCTIONS %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0970 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0971 
0972 
0973 <span class="comment">%======================== FILE ==========================================</span>
0974 
0975 <span class="comment">% --------------------------------------------------------------------</span>
0976 <a name="_sub34" href="#_subfunctions" class="code">function File_Callback(hObject, eventdata, handles)</a>
0977 
0978 <span class="comment">% --------------------------------------------------------------------</span>
0979 <a name="_sub35" href="#_subfunctions" class="code">function File_Open_TimeLapse_Project_Callback(hObject, eventdata, handles)</a>
0980 <a href="#_sub58" class="code" title="subfunction OpenProject_ClickedCallback(hObject, eventdata, handles)">OpenProject_ClickedCallback</a>(hObject, eventdata, handles);
0981 
0982 <span class="comment">% --------------------------------------------------------------------</span>
0983 <a name="_sub36" href="#_subfunctions" class="code">function Create_Project_From_Images_Callback(hObject, eventdata, handles)</a>
0984 <a href="phy_createTimeLapseProjectGui.html" class="code" title="function varargout = phy_createTimeLapseProjectGui(varargin)">phy_createTimeLapseProjectGui</a>();
0985 
0986 
0987 <span class="comment">%============= SEGMENTATION ==============================================</span>
0988 
0989 <span class="comment">% --------------------------------------------------------------------</span>
0990 <a name="_sub37" href="#_subfunctions" class="code">function Segmentation_Callback(hObject, eventdata, handles)</a>
0991 
0992 <span class="comment">% --------------------------------------------------------------------</span>
0993 <a name="_sub38" href="#_subfunctions" class="code">function Segmentation_SegmentCells_Callback(hObject, eventdata, handles)</a>
0994 set(handles.checkbox_segCells,<span class="string">'value'</span>,1);
0995 set(handles.checkbox_segBud,<span class="string">'value'</span>,0);
0996 <a href="#_sub9" class="code" title="subfunction pushbutton_segAll_Callback(hObject, eventdata, handles)">pushbutton_segAll_Callback</a>(handles.pushbutton_segAll, eventdata, handles);
0997 
0998 
0999 <span class="comment">% --------------------------------------------------------------------</span>
1000 <a name="_sub39" href="#_subfunctions" class="code">function Segmentation_MapCell_Callback(hObject, eventdata, handles)</a>
1001 
1002 <span class="keyword">global</span> segmentation
1003 
1004 cSeg1=find(segmentation.cells1Segmented);
1005 <span class="comment">%cSeg2=find(segmentation.cell2Segmented);</span>
1006 <span class="comment">%---------------------</span>
1007 <span class="comment">%dialog box</span>
1008 prompt = {<span class="string">'Enter first frame:'</span>,<span class="string">'Enter last frame:'</span>};
1009 dlg_title = <span class="string">'Map all the segmented frames'</span>;
1010 num_lines = 1;
1011 <span class="comment">%def = {'1',num2str(timeLapse.numberOfFrames)};</span>
1012 def = {num2str(cSeg1(1)),num2str(cSeg1(end))};
1013 answer = inputdlg(prompt,dlg_title,num_lines,def);
1014 <span class="keyword">if</span> isempty(answer)
1015     <span class="keyword">return</span>
1016 <span class="keyword">end</span>
1017 <span class="comment">%-----------------------</span>
1018 
1019 startFrame=str2double(answer(1));
1020 endFrame=str2double(answer(2));
1021 <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'Map Cells'</span>,handles);
1022 tic
1023 
1024 param=2*segmentation.parametres.cell_diameter;
1025 c=0;
1026 <span class="keyword">for</span> i=1:length(cSeg1)<span class="comment">%(endFrame-startFrame)%get(handles.slider1,'Max')</span>
1027     <span class="comment">%x=startFrame+i; %image to start mapping</span>
1028     <span class="keyword">if</span> cSeg1(i)&gt;=startFrame &amp;&amp; cSeg1(i)&lt;=endFrame
1029         x=cSeg1(i);
1030         c=c+1;
1031         <span class="keyword">if</span> c==1
1032             segmentation.cells1(x,:)=<a href="phy_mapObjects.html" class="code" title="function objectOut=phy_mapObjects(distanceParameter,objecti,objecti_1,objecti_2)">phy_mapObjects</a>(param,segmentation.cells1(x,:));
1033         <span class="keyword">elseif</span> c==2
1034             segmentation.cells1(x,:)=<a href="phy_mapObjects.html" class="code" title="function objectOut=phy_mapObjects(distanceParameter,objecti,objecti_1,objecti_2)">phy_mapObjects</a>(param,segmentation.cells1(x,:),segmentation.cells1(cSeg1(i-1),:));
1035         <span class="keyword">elseif</span> c&gt;2
1036             segmentation.cells1(x,:)=<a href="phy_mapObjects.html" class="code" title="function objectOut=phy_mapObjects(distanceParameter,objecti,objecti_1,objecti_2)">phy_mapObjects</a>(param,segmentation.cells1(x,:),segmentation.cells1(cSeg1(i-1),:),segmentation.cells1(cSeg1(i-2),:));
1037         <span class="keyword">end</span>
1038         segmentation.cells1Mapped(x)=1;
1039         segmentation.frameChanged(x)=1;
1040     <span class="keyword">end</span>
1041 <span class="keyword">end</span>
1042 toc
1043 
1044 <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'Check Cells'</span>,handles);
1045 <a href="#_sub53" class="code" title="subfunction Check_Cells_Callback(hObject, eventdata, handles)">Check_Cells_Callback</a>([], [], handles);
1046 
1047 
1048 
1049 <span class="comment">% warningDisparitionCells=[];</span>
1050 <span class="comment">% for i=1:length(segmentation.tcells1)</span>
1051 <span class="comment">%     if segmentation.tcells1(i).N~=0</span>
1052 <span class="comment">%         if segmentation.tcells1(i).lastFrame&lt;cSeg1(end)</span>
1053 <span class="comment">%             warningDisparitionCells=[warningDisparitionCells i];</span>
1054 <span class="comment">%         end</span>
1055 <span class="comment">%     end</span>
1056 <span class="comment">% end</span>
1057 <span class="comment">% if ~isempty(warningDisparitionCells)</span>
1058 <span class="comment">%     warndlg({'The folowing cells are not present on the last segmented frame',num2str(warningDisparitionCells)},...</span>
1059 <span class="comment">%         'Warning cell disparition')</span>
1060 <span class="comment">% end</span>
1061 
1062 <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'Idle'</span>,handles);
1063 
1064 <span class="comment">% --------------------------------------------------------------------</span>
1065 <a name="_sub40" href="#_subfunctions" class="code">function Segmentation_SegmentBudneck_Callback(hObject, eventdata, handles)</a>
1066 set(handles.checkbox_segCells,<span class="string">'value'</span>,0);
1067 set(handles.checkbox_segBud,<span class="string">'value'</span>,1);
1068 <a href="#_sub9" class="code" title="subfunction pushbutton_segAll_Callback(hObject, eventdata, handles)">pushbutton_segAll_Callback</a>(handles.pushbutton_segAll, eventdata, handles);
1069 
1070 
1071 <span class="comment">% --------------------------------------------------------------------</span>
1072 <a name="_sub41" href="#_subfunctions" class="code">function Segmentation_MapBudneck_Callback(hObject, eventdata, handles)</a>
1073 
1074 <span class="keyword">global</span> segmentation
1075 bSeg=find(segmentation.budnecksSegmented);
1076 
1077 <span class="comment">%---------------------</span>
1078 <span class="comment">%dialog box</span>
1079 prompt = {<span class="string">'Enter first frame:'</span>,<span class="string">'Enter last frame:'</span>};
1080 dlg_title = <span class="string">'Map all the segmented frames'</span>;
1081 num_lines = 1;
1082 <span class="comment">%def = {'1',num2str(timeLapse.numberOfFrames)};</span>
1083 def = {num2str(bSeg(1)),num2str(bSeg(end))};
1084 answer = inputdlg(prompt,dlg_title,num_lines,def);
1085 <span class="keyword">if</span> isempty(answer)
1086     <span class="keyword">return</span>
1087 <span class="keyword">end</span>
1088 <span class="comment">%-----------------------</span>
1089 
1090 startFrame=str2double(answer(1));
1091 endFrame=str2double(answer(2));
1092 <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'Map budnecks'</span>,handles);
1093 tic
1094 
1095 param=2*segmentation.parametres.budneck_diameter;
1096 c=0;
1097 <span class="keyword">for</span> i=1:length(bSeg)<span class="comment">%get(handles.slider1,'Max')</span>
1098     <span class="comment">%x=startFrame+i; %image to start mapping</span>
1099     <span class="keyword">if</span> bSeg(i)&gt;=startFrame &amp;&amp; bSeg(i)&lt;=endFrame
1100         x=bSeg(i);
1101         c=c+1;
1102         <span class="keyword">if</span> c==1
1103             segmentation.budnecks(x,:)=<a href="phy_mapObjects.html" class="code" title="function objectOut=phy_mapObjects(distanceParameter,objecti,objecti_1,objecti_2)">phy_mapObjects</a>(param,segmentation.budnecks(x,:));
1104         <span class="keyword">elseif</span> c==2
1105             segmentation.budnecks(x,:)=<a href="phy_mapObjects.html" class="code" title="function objectOut=phy_mapObjects(distanceParameter,objecti,objecti_1,objecti_2)">phy_mapObjects</a>(param,segmentation.budnecks(x,:),segmentation.budnecks(bSeg(i-1),:));
1106         <span class="keyword">elseif</span> c&gt;2
1107             segmentation.budnecks(x,:)=<a href="phy_mapObjects.html" class="code" title="function objectOut=phy_mapObjects(distanceParameter,objecti,objecti_1,objecti_2)">phy_mapObjects</a>(param,segmentation.budnecks(x,:),segmentation.budnecks(bSeg(i-1),:),segmentation.budnecks(bSeg(i-2),:));
1108         <span class="keyword">end</span>
1109         segmentation.budnecksMapped(x)=1;
1110         segmentation.frameChanged(x)=1;
1111     <span class="keyword">end</span>
1112 <span class="keyword">end</span>
1113 toc
1114 
1115 <a href="#_sub54" class="code" title="subfunction Check_Budnecks_Callback(hObject, eventdata, handles)">Check_Budnecks_Callback</a>([], [], handles)
1116 <span class="comment">% status('refresh tbudnecks',handles);</span>
1117 <span class="comment">% tic</span>
1118 <span class="comment">% [segmentation.tbudnecks fchange]=phy_makeTObject(segmentation.budnecks,segmentation.tbudnecks);</span>
1119 <span class="comment">% segmentation.frameChanged(fchange)=1;</span>
1120 <span class="comment">% toc</span>
1121 <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'Idle'</span>,handles);
1122 
1123 <span class="comment">% --------------------------------------------------------------------</span>
1124 <a name="_sub42" href="#_subfunctions" class="code">function Segmentation_Setings_Callback(hObject, eventdata, handles)</a>
1125 
1126 <span class="keyword">global</span> segmentation
1127 
1128 <span class="comment">%check struct saved from previous versions</span>
1129 <span class="keyword">if</span> ~isfield(segmentation.parametres,<span class="string">'cell_diameter'</span>)
1130     segmentation.parametres.cell_diameter=50;
1131 <span class="keyword">end</span>
1132 
1133 <span class="keyword">if</span> ~isfield(segmentation.parametres,<span class="string">'budneck_diameter'</span>)
1134     segmentation.parametres.budneck_diameter=15;
1135 <span class="keyword">end</span>
1136 
1137 <span class="keyword">if</span> ~isfield(segmentation.parametres,<span class="string">'segmentation'</span>)
1138     segmentation.parametres.segmentation=2;
1139 <span class="keyword">end</span>
1140 
1141 <span class="keyword">if</span> ~isfield(segmentation.parametres,<span class="string">'numberPixelsWat'</span>)
1142     segmentation.parametres.numberPixelsWat=50;
1143 <span class="keyword">end</span>
1144 <span class="keyword">if</span> ~isfield(segmentation.parametres,<span class="string">'budneckRefine'</span>)
1145     segmentation.parametres.budneckRefine=0;
1146 <span class="keyword">end</span>
1147 <span class="comment">%-------------------------------------------------------------------------</span>
1148 
1149 <span class="comment">%dialog</span>
1150 prompt = {<span class="string">'Enter cell diameter:'</span>,<span class="string">'Enter budneck diameter:'</span>,<span class="string">'Enter segmentation method: 1-balon / 2-watershedPH / 3-omothetie /4-watershedBF'</span>,<span class="string">'Enter the number of pixel to add in watershed before doing an ellipse aproximation:'</span>,<span class="string">'Enter the refine value for budneck segmentation (-1 to 1):'</span>};
1151 dlg_title = <span class="string">'Segmentation parametres'</span>;
1152 num_lines = 1;
1153 def = {num2str(segmentation.parametres.cell_diameter),num2str(segmentation.parametres.budneck_diameter),num2str(segmentation.parametres.segmentation),num2str(segmentation.parametres.numberPixelsWat),num2str(segmentation.parametres.budneckRefine)};
1154 answer = inputdlg(prompt,dlg_title,num_lines,def);
1155 <span class="keyword">if</span> isempty(answer)
1156     <span class="keyword">return</span>
1157 <span class="keyword">end</span>
1158 <span class="comment">%-----------------------</span>
1159 
1160 segmentation.parametres.cell_diameter=str2double(answer(1));
1161 segmentation.parametres.budneck_diameter=str2double(answer(2));
1162 segmentation.parametres.segmentation=str2double(answer(3));
1163 segmentation.parametres.numberPixelsWat=str2double(answer(4)); 
1164 segmentation.parametres.budneckRefine=str2double(answer(5)); 
1165 
1166 
1167 
1168 <span class="comment">%============= PEDIGREE =================================================</span>
1169 <span class="comment">% --------------------------------------------------------------------</span>
1170 <a name="_sub43" href="#_subfunctions" class="code">function Pedigree_Callback(hObject, eventdata, handles)</a>
1171 
1172 
1173 <span class="comment">% --------------------------------------------------------------------</span>
1174 <a name="_sub44" href="#_subfunctions" class="code">function Pedigree_MakeP_Callback(hObject, eventdata, handles)</a>
1175 <span class="keyword">global</span> segmentation
1176 
1177 <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'refresh tbudnecks'</span>,handles);
1178 tic
1179 [segmentation.tbudnecks fchange]=<a href="phy_makeTObject.html" class="code" title="function [tObjectOut fChanged]=phy_makeTObject(objects,tObjectIn)">phy_makeTObject</a>(segmentation.budnecks,segmentation.tbudnecks);
1180 segmentation.frameChanged(fchange)=1;
1181 toc
1182 
1183 <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'refresh tcells1'</span>,handles);
1184 tic
1185 [segmentation.tcells1 fchange]=<a href="phy_makeTObject.html" class="code" title="function [tObjectOut fChanged]=phy_makeTObject(objects,tObjectIn)">phy_makeTObject</a>(segmentation.cells1,segmentation.tcells1); 
1186 segmentation.frameChanged(fchange)=1;
1187 toc
1188 
1189 
1190 firstSegmented=find(segmentation.cells1Segmented,1,<span class="string">'first'</span>);<span class="comment">%first frame segmented</span>
1191 <a href="#_sub64" class="code" title="subfunction Change_Disp1(pos,handles)">Change_Disp1</a>(firstSegmented,handles);
1192 pause(0.1);
1193 
1194 <span class="comment">%---------------------</span>
1195 <span class="comment">%dialog box</span>
1196 prompt = {<span class="string">'Enter first mother cell:'</span>,<span class="string">'Enter others cell in first frame:'</span>};
1197 dlg_title = <span class="string">'First frame cells'</span>;
1198 num_lines = 1;
1199 firstMCell=[];<span class="comment">%first mother cell</span>
1200 tcells=segmentation.tcells1;
1201 <span class="keyword">for</span> i=1:length(tcells)
1202     <span class="keyword">if</span> tcells(i).detectionFrame==firstSegmented &amp;&amp; tcells(i).mother==0
1203         firstMCell=i;
1204         <span class="keyword">break</span>
1205     <span class="keyword">end</span>
1206 <span class="keyword">end</span>
1207 
1208 <span class="keyword">if</span> isempty(firstMCell)
1209     warndlg(<span class="string">'There is no cell with no mother in first frame'</span>,<span class="string">'Warning cell no mother'</span>)
1210     <span class="keyword">return</span>
1211 <span class="keyword">end</span>
1212 firstCells=[];
1213 <span class="keyword">for</span> i=1:length(tcells)
1214     <span class="keyword">if</span> tcells(i).detectionFrame==firstSegmented &amp;&amp; tcells(i).N~=firstMCell
1215         firstCells=[firstCells,i];
1216     <span class="keyword">end</span>
1217 <span class="keyword">end</span>
1218 
1219 <span class="comment">%def = {'1',num2str(timeLapse.numberOfFrames)};</span>
1220 def = {num2str(firstMCell),num2str(firstCells)};
1221 answer = inputdlg(prompt,dlg_title,num_lines,def);
1222 <span class="keyword">if</span> isempty(answer)
1223     <span class="keyword">return</span>
1224 <span class="keyword">end</span>
1225 
1226 firstMCell=str2double(answer{1});
1227 firstCells=str2num(answer{2});
1228 <span class="comment">%-----------------------</span>
1229 
1230 
1231 
1232 fch=find(segmentation.frameChanged);
1233 <span class="keyword">if</span> isempty(fch)
1234     button = questdlg({<span class="string">'There were no changes on the frames.'</span>,<span class="string">'Do you realy want to rebuild the pedigree?'</span>,<span class="string">'(if YES: the masks will be redone)'</span>},<span class="string">'Warning'</span>,<span class="string">'YES'</span>,<span class="string">'NO'</span>,<span class="string">'NO'</span>) ;
1235     <span class="keyword">if</span> strcmpi(button,<span class="string">'YES'</span>)
1236         <span class="comment">%---------------------------------------</span>
1237         prompt = {<span class="string">'Enter the first frame :'</span>,<span class="string">'Enter the last frame :'</span>};
1238         dlg_title = <span class="string">'Frames'</span>;
1239         num_lines = 1;
1240         def = {<span class="string">'1'</span>,<span class="string">'0'</span>};
1241         answer = inputdlg(prompt,dlg_title,num_lines,def);
1242         <span class="keyword">if</span> isempty(answer)
1243             <span class="keyword">return</span>
1244         <span class="keyword">end</span>
1245         <span class="comment">%-----------------------</span>
1246         firstFrame=str2double(answer(1));
1247         lastFrame=str2double(answer(2));
1248         fch=firstFrame:lastFrame;
1249         
1250     <span class="keyword">end</span>
1251 <span class="keyword">end</span>
1252 
1253 button = questdlg({<span class="string">'Do you want to celar all the mothers?'</span>},<span class="string">'Warning'</span>,<span class="string">'Yes'</span>,<span class="string">'No'</span>,<span class="string">'No'</span>) ;
1254 <span class="keyword">if</span> strcmpi(button,<span class="string">'Yes'</span>)
1255     <span class="keyword">for</span> i=1:length(segmentation.tcells1)
1256         segmentation.tcells1(i).setMother(0);
1257         segmentation.tcells1(i).mothers=[];
1258     <span class="keyword">end</span>
1259 <span class="keyword">end</span>
1260 
1261 <span class="keyword">if</span> segmentation.pedigree.makeType==1
1262     tic
1263     <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'Make Pedigree (masks budnecks cells)'</span>,handles);
1264     <a href="phy_progressbar.html" class="code" title="function [stopBar] =  phy_progressbar(fractiondone, position)">phy_progressbar</a>;
1265     cnt=0;
1266     <span class="keyword">for</span> i=fch
1267         cnt=cnt+1;
1268         <a href="phy_progressbar.html" class="code" title="function [stopBar] =  phy_progressbar(fractiondone, position)">phy_progressbar</a>(cnt/length(fch));
1269         <span class="comment">%i=startFrame+x;</span>
1270         <span class="comment">%if i&gt;=startFrame &amp;&amp; i&lt;=endFrame</span>
1271             <span class="keyword">if</span> size(segmentation.cells1,1)&gt;=i
1272             cell1=segmentation.cells1(i,:);
1273             <span class="keyword">else</span>
1274                 cell1=[];
1275                 <span class="keyword">continue</span>
1276             <span class="keyword">end</span>
1277 <span class="comment">%            cell2=segmentation.cells2(i,:);</span>
1278             <span class="keyword">if</span> size(segmentation.budnecks,1)&gt;=i
1279             budneck=segmentation.budnecks(i,:);
1280             <span class="keyword">else</span> 
1281                 budneck=[];
1282                 <span class="keyword">continue</span>
1283             <span class="keyword">end</span>
1284             
1285             masks1=(zeros(size(segmentation.realImage(:,:,1))));
1286 
1287             <span class="keyword">for</span> j=1:length(cell1)
1288                 <span class="keyword">if</span> cell1(j).n~=0
1289                     bw_cell = poly2mask(cell1(j).x,cell1(j).y,size(segmentation.realImage,1),size(segmentation.realImage,2));
1290                     masks1(bw_cell)=cell1(j).n;
1291                 <span class="keyword">end</span>
1292             <span class="keyword">end</span>
1293             <span class="comment">%figure;imshow(tot1);</span>
1294             
1295             <span class="keyword">for</span> j=1:length(budneck)
1296                 <span class="keyword">if</span> segmentation.budnecks(i,j).n~=0
1297                     segmentation.budnecks(i,j).cell1=[];
1298                     <span class="comment">%segmentation.budnecks(i,j).cell2=[];</span>
1299                     bw_bud = poly2mask(budneck(j).x,budneck(j).y,size(segmentation.realImage,1),size(segmentation.realImage,2));
1300                     segmentation.budnecks(i,j).cell1=masks1(bw_bud);
1301                     <span class="comment">%segmentation.budnecks(i,j).cell2=masks2(bw_bud);</span>
1302                 <span class="keyword">end</span>
1303             <span class="keyword">end</span>
1304             segmentation.frameChanged(i)=0;
1305         <span class="comment">%end</span>
1306     <span class="keyword">end</span>
1307     <a href="phy_progressbar.html" class="code" title="function [stopBar] =  phy_progressbar(fractiondone, position)">phy_progressbar</a>(1);
1308     pause(0.01);
1309     <span class="string">'masks1'</span>
1310     toc
1311     
1312     tic
1313     
1314     <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'Set mothers'</span>,handles);
1315     [segmentation.tcells1 segmentation.tbudnecks]=<a href="phy_setMothers.html" class="code" title="function [tcells tbudnecks]=phy_setMothers(tcells,tbudnecks,cell,firstMCell,firstCells)">phy_setMothers</a>(segmentation.tcells1,segmentation.tbudnecks,<span class="string">'cell1'</span>,firstMCell,firstCells);
1316     <span class="comment">%[segmentation.tcells2 segmentation.tbudnecks]=phy_setMothers(segmentation.tcells2,segmentation.tbudnecks,'cell2');</span>
1317     <span class="string">'find daughter'</span>
1318     toc
1319 <span class="keyword">else</span>
1320     <a href="phy_setMothersWithoutBudneck.html" class="code" title="function phy_setMothersWithoutBudneck(fch,firstMCell,firstCells)">phy_setMothersWithoutBudneck</a>(fch,firstMCell,firstCells)
1321     <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'Set mothers'</span>,handles);
1322 <span class="keyword">end</span>
1323 <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'Idle'</span>,handles); 
1324 
1325 
1326 <span class="comment">% --------------------------------------------------------------------</span>
1327 <a name="_sub45" href="#_subfunctions" class="code">function Pedigree_Plot_Pedigree_Callback(hObject, eventdata, handles)</a>
1328 <span class="keyword">global</span> segmentation
1329 hgui=gcf;
1330 [haxe,himg]=<a href="phy_plotPedigree.html" class="code" title="function [haxe himg]=phy_plotPedigree(tcells,option)">phy_plotPedigree</a>(segmentation.tcells1,segmentation.pedigree.plotType);
1331 set(himg,<span class="string">'ButtonDownFcn'</span>,{@<a href="#_sub68" class="code" title="subfunction mousePedigreePlot(hObject, eventdata, handles,haxe)">mousePedigreePlot</a>,handles,haxe});
1332 segmentation.myHandles.pedigreeImage=himg;
1333 
1334 <span class="comment">% --------------------------------------------------------------------</span>
1335 <a name="_sub46" href="#_subfunctions" class="code">function Pedigree_Setings_Callback(hObject, eventdata, handles)</a>
1336 <span class="comment">% chose some settings for the pedigree</span>
1337 <span class="keyword">global</span> segmentation
1338 prompt = {<span class="string">'Enter the plot type: 1-color of data; 2-budneck times'</span>,<span class="string">'Enter the way of making the pedigree: 1-with budnecks; 2-without budnecks'</span>};
1339 dlg_title = <span class="string">'Pedigree setings'</span>;
1340 num_lines = 1;
1341 def = {num2str(segmentation.pedigree.plotType),num2str(segmentation.pedigree.makeType)};
1342 
1343 answer = inputdlg(prompt,dlg_title,num_lines,def);
1344 <span class="keyword">if</span> isempty(answer)
1345     <span class="keyword">return</span>
1346 <span class="keyword">end</span>
1347 
1348 segmentation.pedigree.plotType=str2double(answer{1});
1349 segmentation.pedigree.makeType=str2double(answer{2});
1350 
1351 <span class="comment">% --------------------------------------------------------------------</span>
1352 <a name="_sub47" href="#_subfunctions" class="code">function Pedigree_Clear_Mothers_Callback(hObject, eventdata, handles)</a>
1353 <span class="keyword">global</span> segmentation
1354 
1355 button = questdlg({<span class="string">'Do you want to celar all the mothers?'</span>},<span class="string">'Warning'</span>,<span class="string">'Yes'</span>,<span class="string">'No'</span>,<span class="string">'No'</span>) ;
1356 <span class="keyword">if</span> strcmpi(button,<span class="string">'Yes'</span>)
1357     <span class="keyword">for</span> i=1:length(segmentation.tcells1)
1358         segmentation.tcells1(i).setMother(0);
1359         segmentation.tcells1(i).mothers=[];
1360     <span class="keyword">end</span>
1361 <span class="keyword">end</span>
1362 
1363 
1364 <span class="comment">%================= VIEW ==================================================</span>
1365 
1366 <span class="comment">% --------------------------------------------------------------------</span>
1367 <a name="_sub48" href="#_subfunctions" class="code">function View_Callback(hObject, eventdata, handles)</a>
1368 
1369 
1370 <span class="comment">% --------------------------------------------------------------------</span>
1371 <a name="_sub49" href="#_subfunctions" class="code">function View_Edit_Cell_Properties_Callback(hObject, eventdata, handles)</a>
1372 <span class="comment">%edit the fields that can be viewed in &quot;Cell Properties&quot;</span>
1373 
1374 <span class="keyword">global</span> segmentation
1375 <span class="comment">%build the proprietes for inputdlg</span>
1376 <span class="comment">%title</span>
1377 dlg_title = <span class="string">'Show propreties'</span>;
1378 <span class="comment">%prompt string</span>
1379 names = fieldnames(<a href="phy_Object.html" class="code" title="">phy_Object</a>);
1380 s=<span class="string">'Available propreties options: \n'</span>;
1381 <span class="keyword">for</span> i=1:length(names)
1382     <span class="keyword">if</span> mod(i,4)==0
1383         s=[s,names{i},<span class="string">'\n'</span>];
1384     <span class="keyword">else</span>
1385         s=[s,names{i},<span class="string">'\t'</span>];
1386     <span class="keyword">end</span>
1387 <span class="keyword">end</span>
1388 s=sprintf(s);
1389 prompt={s};
1390 
1391 <span class="comment">%default value of the string (the last value)</span>
1392 default=<span class="string">''</span>;
1393 <span class="keyword">for</span> i=1:length(segmentation.showFieldsObj)
1394     default=[default,segmentation.showFieldsObj{i},<span class="string">' '</span>];
1395 <span class="keyword">end</span>
1396 num_lines = 2;
1397 def = {default};
1398 
1399 <span class="comment">%options</span>
1400 options.Resize=<span class="string">'on'</span>;
1401 
1402 <span class="comment">%dialog figure</span>
1403 answer = inputdlg(prompt,dlg_title,num_lines,def,options);
1404 <span class="keyword">if</span> isempty(answer)
1405     <span class="keyword">return</span>
1406 <span class="keyword">end</span>
1407 <span class="comment">%save the result</span>
1408 C=textscan(answer{1},<span class="string">'%s'</span>);
1409 segmentation.showFieldsObj=C{1};
1410 
1411 
1412 <span class="comment">% --------------------------------------------------------------------</span>
1413 <a name="_sub50" href="#_subfunctions" class="code">function View_Edit_TCell_Properties_Callback(hObject, eventdata, handles)</a>
1414 <span class="comment">%edit the fields that can be viewed in &quot;TCell Properties&quot;</span>
1415 
1416 <span class="keyword">global</span> segmentation
1417 
1418 <span class="comment">%build the proprietes for inputdlg</span>
1419 <span class="comment">%title</span>
1420 dlg_title = <span class="string">'Show propreties'</span>;
1421 <span class="comment">%prompt string</span>
1422 names = fieldnames(<a href="phy_Object.html" class="code" title="">phy_Object</a>);
1423 s=<span class="string">'Available propreties options: \n'</span>;
1424 <span class="keyword">for</span> i=1:length(names)
1425     <span class="keyword">if</span> mod(i,4)==0
1426         s=[s,names{i},<span class="string">'\n'</span>];
1427     <span class="keyword">else</span>
1428         s=[s,names{i},<span class="string">'\t'</span>];
1429     <span class="keyword">end</span>
1430 <span class="keyword">end</span>
1431 s=sprintf(s);
1432 prompt={s};
1433 
1434 <span class="comment">%default value of the string (the last value)</span>
1435 default=<span class="string">''</span>;
1436 <span class="keyword">for</span> i=1:length(segmentation.showFieldsTObj)
1437     default=[default,segmentation.showFieldsTObj{i},<span class="string">' '</span>];
1438 <span class="keyword">end</span>
1439 num_lines = 2;
1440 def = {default};
1441 
1442 <span class="comment">%options</span>
1443 options.Resize=<span class="string">'on'</span>;
1444 
1445 <span class="comment">%dialog figure</span>
1446 answer = inputdlg(prompt,dlg_title,num_lines,def,options);
1447 <span class="keyword">if</span> isempty(answer)
1448     <span class="keyword">return</span>
1449 <span class="keyword">end</span>
1450 <span class="comment">%save the result</span>
1451 C=textscan(answer{1},<span class="string">'%s'</span>);
1452 segmentation.showFieldsTObj=C{1};
1453 
1454 
1455 <span class="comment">% --------------------------------------------------------------------</span>
1456 <a name="_sub51" href="#_subfunctions" class="code">function View_Set_Channels_Colors_Callback(hObject, eventdata, handles)</a>
1457 <span class="comment">% call the GUI to set the cannels colors</span>
1458 <span class="keyword">global</span> segmentation
1459 <span class="keyword">global</span> timeLapse;
1460 
1461 set(handles.checkbox_Use_Display_Image,<span class="string">'value'</span>,0);
1462 <a href="#_sub64" class="code" title="subfunction Change_Disp1(pos,handles)">Change_Disp1</a>(<span class="string">'refresh'</span>,handles);
1463 
1464 segmentation.colorData=<a href="phy_setColorsGui.html" class="code" title="function varargout = phy_setColorsGui(varargin)">phy_setColorsGui</a>(segmentation.colorData,segmentation.realImage);
1465 pause(0.1);
1466 <span class="comment">%status('Saving to file',handles);</span>
1467 <span class="comment">%save(fullfile(timeLapse.path,timeLapse.pathList.position{segmentation.position},'segmentation.mat'),'segmentation','-append');</span>
1468 <a href="#_sub64" class="code" title="subfunction Change_Disp1(pos,handles)">Change_Disp1</a>(<span class="string">'refresh'</span>,handles);
1469 
1470 
1471 <span class="comment">%===================== CHECK ============================================</span>
1472 
1473 <span class="comment">% --------------------------------------------------------------------</span>
1474 <a name="_sub52" href="#_subfunctions" class="code">function Check_Callback(hObject, eventdata, handles)</a>
1475 
1476 <span class="comment">% --------------------------------------------------------------------</span>
1477 <a name="_sub53" href="#_subfunctions" class="code">function Check_Cells_Callback(hObject, eventdata, handles)</a>
1478 <span class="keyword">global</span> segmentation
1479 
1480 cSeg1=find(segmentation.cells1Segmented);
1481 
1482 [segmentation.tcells1 fchange]=<a href="phy_makeTObject.html" class="code" title="function [tObjectOut fChanged]=phy_makeTObject(objects,tObjectIn)">phy_makeTObject</a>(segmentation.cells1,segmentation.tcells1);
1483 
1484 
1485 
1486 warningDisparitionCells=[];
1487 <span class="keyword">for</span> i=1:length(segmentation.tcells1)
1488     <span class="keyword">if</span> segmentation.tcells1(i).N~=0
1489         <span class="keyword">if</span> segmentation.tcells1(i).lastFrame&lt;cSeg1(end)
1490             warningDisparitionCells=[warningDisparitionCells i];
1491         <span class="keyword">end</span>
1492     <span class="keyword">end</span>
1493 <span class="keyword">end</span>
1494 
1495 len=zeros(1,length(segmentation.tcells1));
1496 <span class="keyword">for</span> i=1:length(segmentation.tcells1)
1497     <span class="keyword">if</span> segmentation.tcells1(i).N~=0
1498         len(i)=segmentation.tcells1(i).lastFrame-segmentation.tcells1(i).detectionFrame+1;
1499     <span class="keyword">end</span>
1500 <span class="keyword">end</span>
1501 
1502 <span class="keyword">if</span> ~isempty(warningDisparitionCells)
1503     str={[<span class="string">'The folowing cells are not present on the last segmented frame('</span>,num2str(cSeg1(end)),<span class="string">'): '</span>]};
1504     <span class="keyword">for</span> i=1:length(segmentation.tcells1)
1505         <span class="keyword">if</span> len(i)~=0 &amp;&amp; any(warningDisparitionCells==i)
1506             str=[str;[num2str(i),<span class="string">'- length :'</span> ,num2str(len(i))]];
1507         <span class="keyword">end</span>
1508     <span class="keyword">end</span>
1509     warndlg(str,<span class="string">'Warning cell disparition'</span>)
1510 <span class="keyword">end</span>
1511 
1512 lostCells=[];
1513 str={<span class="string">'The folowing cells have lost frames: '</span>};
1514 <span class="keyword">for</span> i=1:length(segmentation.tcells1)
1515     <span class="keyword">if</span> segmentation.tcells1(i).N~=0
1516         frames=segmentation.tcells1(i).lostFrames;
1517         <span class="keyword">if</span> ~isempty(frames)
1518             lostCells=[lostCells i];
1519             str=[str;[num2str(i),<span class="string">'- frames :'</span> ,num2str(frames)]];
1520         <span class="keyword">end</span>
1521     <span class="keyword">end</span>
1522 <span class="keyword">end</span>
1523 <span class="keyword">if</span> ~isempty(lostCells)
1524     warndlg(str,<span class="string">'Warning cell frame disparition'</span>);
1525 <span class="keyword">end</span>
1526 
1527 <span class="keyword">if</span> isempty(warningDisparitionCells)&amp;&amp;isempty(lostCells)
1528     warndlg(<span class="string">'Cells are OK'</span>,<span class="string">'OK'</span>);
1529 <span class="keyword">end</span>
1530         
1531 
1532 <span class="comment">% --------------------------------------------------------------------</span>
1533 <a name="_sub54" href="#_subfunctions" class="code">function Check_Budnecks_Callback(hObject, eventdata, handles)</a>
1534 <span class="keyword">global</span> segmentation
1535 
1536 <span class="comment">%bSeg=find(segmentation.budnecksSegmented);</span>
1537 
1538 <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'refresh tbudnecks'</span>,handles);
1539 tic
1540 [segmentation.tbudnecks fchange]=<a href="phy_makeTObject.html" class="code" title="function [tObjectOut fChanged]=phy_makeTObject(objects,tObjectIn)">phy_makeTObject</a>(segmentation.budnecks,segmentation.tbudnecks);
1541 toc
1542 <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'Idle'</span>,handles);
1543 
1544 lostBudnecks=[];
1545 str={<span class="string">'The folowing budnecks have lost frames: '</span>};
1546 <span class="keyword">for</span> i=1:length(segmentation.tbudnecks)
1547     <span class="keyword">if</span> segmentation.tbudnecks(i).N~=0
1548         frames=segmentation.tbudnecks(i).lostFrames;
1549         <span class="keyword">if</span> ~isempty(frames)
1550             lostBudnecks=[lostBudnecks i];
1551             str=[str;[num2str(i),<span class="string">'- frames :'</span> ,num2str(frames)]];
1552         <span class="keyword">end</span>
1553     <span class="keyword">end</span>
1554 <span class="keyword">end</span>
1555 <span class="keyword">if</span> ~isempty(lostBudnecks)
1556     warndlg(str,<span class="string">'Warning budnecks frame disparition'</span>);
1557 <span class="keyword">end</span>
1558 
1559 len=zeros(1,length(segmentation.tbudnecks));
1560 <span class="keyword">for</span> i=1:length(segmentation.tbudnecks)
1561     <span class="keyword">if</span> segmentation.tbudnecks(i).N~=0
1562         len(i)=segmentation.tbudnecks(i).lastFrame-segmentation.tbudnecks(i).detectionFrame+1;
1563     <span class="keyword">end</span>
1564 <span class="keyword">end</span>
1565 
1566 meanLength=mean(len(len~=0));
1567 sdLength=std(len(len~=0));
1568 
1569 lengthError=false;
1570 str={[<span class="string">'The folowing budnecks have wierd time of life: (mean='</span>, num2str(meanLength),<span class="string">')'</span>]};
1571 <span class="keyword">for</span> i=1:length(segmentation.tbudnecks)
1572     <span class="keyword">if</span> len(i)~=0 &amp;&amp; (len(i)&gt; segmentation.check.budneckTimeHigh || len(i)&lt;segmentation.check.budneckTimeLow)
1573         str=[str;[num2str(i),<span class="string">'- length :'</span> ,num2str(len(i))]];
1574         lengthError=true;
1575     <span class="keyword">end</span>
1576 <span class="keyword">end</span>
1577 <span class="keyword">if</span> lengthError
1578     warndlg(str,<span class="string">'Warning budnecks frame disparition'</span>);
1579 <span class="keyword">end</span>
1580 <span class="keyword">if</span> isempty(lostBudnecks)&amp;&amp;~lengthError
1581     warndlg(<span class="string">'Budnecks are OK'</span>,<span class="string">'OK'</span>);
1582 <span class="keyword">end</span>
1583     
1584 
1585 
1586 <span class="comment">%===================== EXPORT ============================================</span>
1587 <span class="comment">% --------------------------------------------------------------------</span>
1588 <a name="_sub55" href="#_subfunctions" class="code">function Export_Data_To_File_Callback(hObject, eventdata, handles)</a>
1589 <span class="keyword">global</span> segmentation;
1590 <span class="keyword">global</span> timeLapse;
1591 divisionTime=[];
1592 buddedTime=[];
1593 nonBudedTime=[];
1594 areaDivision=[];
1595 areaBudneck=[];
1596 <span class="keyword">for</span> i=1:length(segmentation.tcells1)
1597     div=[segmentation.tcells1(i).birthFrame segmentation.tcells1(i).divisionTimes];
1598     divt=diff(div);
1599     budt=segmentation.tcells1(i).divisionTimes-segmentation.tcells1(i).budTimes;
1600     <span class="keyword">if</span> div(end)==segmentation.tcells1(i).lastFrame &amp;&amp; numel(divt)~=0
1601         divt(end)=[];
1602         budt(end)=[];
1603     <span class="keyword">end</span>
1604     nbudt=[segmentation.tcells1(i).budTimes(:)]'-div(1:end-1);
1605     ad=[];
1606     <span class="keyword">for</span> f=divt
1607         <span class="keyword">for</span> j=1:length(segmentation.tcells1(i).Obj)
1608             <span class="keyword">if</span> segmentation.tcells1(i).Obj(j).image==f
1609                 ad=[ad round(segmentation.tcells1(i).Obj(j).area)];
1610                 <span class="keyword">break</span>
1611             <span class="keyword">end</span>
1612         <span class="keyword">end</span>
1613     <span class="keyword">end</span>
1614     
1615     ab=[];
1616     <span class="keyword">for</span> f=segmentation.tcells1(i).budTimes
1617         <span class="keyword">for</span> j=1:length(segmentation.tcells1(i).Obj)
1618             <span class="keyword">if</span> segmentation.tcells1(i).Obj(j).image==f
1619                 ab=[ab round(segmentation.tcells1(i).Obj(j).area)];
1620                 <span class="keyword">break</span>
1621             <span class="keyword">end</span>
1622         <span class="keyword">end</span>
1623     <span class="keyword">end</span>
1624     
1625     <span class="keyword">for</span> j=1:length(divt)
1626         divisionTime(i,j)=divt(j);
1627     <span class="keyword">end</span>
1628     <span class="keyword">for</span> j=1:length(budt)
1629         buddedTime(i,j)=budt(j);
1630     <span class="keyword">end</span>
1631     <span class="keyword">for</span> j=1:length(nbudt)
1632         nonBudedTime(i,j)=nbudt(j);
1633     <span class="keyword">end</span>
1634     <span class="keyword">for</span> j=1:length(ad)
1635         areaDivision(i,j)=ad(j);
1636     <span class="keyword">end</span>
1637     <span class="keyword">for</span> j=1:length(ab)
1638         areaBudneck(i,j)=ab(j);
1639     <span class="keyword">end</span>
1640     datName=fullfile(timeLapse.path,timeLapse.pathList.position{segmentation.position},<span class="string">'divisionTime.csv'</span>);
1641     <a href="phy_cell2csv.html" class="code" title="function phy_cell2csv(datName,cellArray,seperator,excelVersion)">phy_cell2csv</a>(datName,divisionTime,<span class="string">','</span>,1);
1642     
1643     datName=fullfile(timeLapse.path,timeLapse.pathList.position{segmentation.position},<span class="string">'buddedTime.csv'</span>);
1644     <a href="phy_cell2csv.html" class="code" title="function phy_cell2csv(datName,cellArray,seperator,excelVersion)">phy_cell2csv</a>(datName,buddedTime,<span class="string">','</span>,1);
1645     
1646     datName=fullfile(timeLapse.path,timeLapse.pathList.position{segmentation.position},<span class="string">'nonBudedTime.csv'</span>);
1647     <a href="phy_cell2csv.html" class="code" title="function phy_cell2csv(datName,cellArray,seperator,excelVersion)">phy_cell2csv</a>(datName,nonBudedTime,<span class="string">','</span>,1);
1648     
1649     datName=fullfile(timeLapse.path,timeLapse.pathList.position{segmentation.position},<span class="string">'areaDivision.csv'</span>);
1650     <a href="phy_cell2csv.html" class="code" title="function phy_cell2csv(datName,cellArray,seperator,excelVersion)">phy_cell2csv</a>(datName,areaDivision,<span class="string">','</span>,1);
1651     
1652     datName=fullfile(timeLapse.path,timeLapse.pathList.position{segmentation.position},<span class="string">'areaBudneck.csv'</span>);
1653     <a href="phy_cell2csv.html" class="code" title="function phy_cell2csv(datName,cellArray,seperator,excelVersion)">phy_cell2csv</a>(datName,areaBudneck,<span class="string">','</span>,1);
1654 
1655 <span class="keyword">end</span>
1656 
1657 
1658 <span class="comment">% --------------------------------------------------------------------</span>
1659 <a name="_sub56" href="#_subfunctions" class="code">function Export_frame_to_image_Callback(hObject, eventdata, handles)</a>
1660 
1661 dir=handles.exportDir;
1662 name=[<span class="string">'frame'</span>,get(handles.editFrame1,<span class="string">'string'</span>)];
1663 fileName=fullfile(dir,name);
1664 [name,dir] = uiputfile({<span class="string">'*.png'</span>;<span class="string">'*.bmp'</span>;<span class="string">'*.jpg'</span>;<span class="string">'*.tif'</span>},<span class="string">'Save Image'</span>,fileName);
1665 <span class="keyword">if</span> name==0
1666     <span class="keyword">return</span>
1667 <span class="keyword">end</span>
1668 handles.exportDir=dir;
1669 
1670 fileName=fullfile(dir,name);
1671 f=getframe(handles.axes1);
1672 [x,map]=frame2im(f);
1673 imwrite(x,fileName);
1674 guidata(hObject, handles);
1675 
1676 
1677  <span class="comment">%--------------------------------------------------------------------</span>
1678 <a name="_sub57" href="#_subfunctions" class="code">function Export_frames_to_movie_Callback(hObject, eventdata, handles)</a>
1679 <span class="keyword">global</span> segmentation
1680 <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'Making movie'</span>,handles);
1681 dir=handles.exportDir;
1682 name=[<span class="string">'movie'</span>,get(handles.editFrame1,<span class="string">'string'</span>)];
1683 fileName=fullfile(dir,name);
1684 [name,dir] = uiputfile({<span class="string">'*.avi'</span>;<span class="string">'*.mat'</span>},<span class="string">'Save movie'</span>,fileName);
1685 <span class="keyword">if</span> name==0
1686     <span class="keyword">return</span>
1687 <span class="keyword">end</span>
1688 handles.exportDir=dir;
1689 fileName=fullfile(dir,name);
1690 
1691 <span class="comment">%---------------------</span>
1692 <span class="comment">%dialog box</span>
1693 prompt = {<span class="string">'Enter first frame:'</span>,<span class="string">'Enter last frame:'</span>};
1694 dlg_title = <span class="string">'Movie frames'</span>;
1695 num_lines = 1;
1696 def = {<span class="string">'1'</span>,num2str(segmentation.frame1)};
1697 <span class="comment">%def = {num2str(bSeg(1)),num2str(bSeg(end))};</span>
1698 answer = inputdlg(prompt,dlg_title,num_lines,def);
1699 <span class="keyword">if</span> isempty(answer)
1700     <span class="keyword">return</span>
1701 <span class="keyword">end</span>
1702 startFrame=str2double(answer(1));
1703 endFrame=str2double(answer(2));
1704 <span class="comment">%-----------------------</span>
1705 movieCount=0;
1706 <span class="keyword">for</span> i=startFrame:endFrame
1707     <a href="#_sub64" class="code" title="subfunction Change_Disp1(pos,handles)">Change_Disp1</a>(i,handles);
1708     disp(segmentation.frame1);
1709     
1710     movieCount=movieCount+1;
1711     F(movieCount)=getframe(handles.axes1);
1712     pause(0.2);
1713     
1714 <span class="keyword">end</span>
1715 
1716 [pathstr, name, ext, versn] = fileparts(fileName);
1717 <span class="keyword">if</span> strcmpi(ext,<span class="string">'.avi'</span>);
1718     movie2avi(F,fileName);
1719 <span class="keyword">elseif</span> strcmpi(ext,<span class="string">'.mat'</span>);
1720     save(fileName,<span class="string">'F'</span>);
1721 <span class="keyword">end</span>
1722 
1723 <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'Idle'</span>,handles);
1724 guidata(hObject, handles);
1725 
1726 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
1727 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%% TOOLBAR CLICKED CALLBACK FUNCTIONS %%%%%%%%%%%%%</span>
1728 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
1729 
1730 <span class="comment">% --------------------------------------------------------------------</span>
1731 <a name="_sub58" href="#_subfunctions" class="code">function OpenProject_ClickedCallback(hObject, eventdata, handles)</a>
1732 <span class="keyword">global</span> timeLapse;
1733 <span class="keyword">global</span> segmentation
1734 
1735 <span class="comment">%check if some projects already oppened</span>
1736 <span class="keyword">if</span> exist(<span class="string">'phy_openedProjects.mat'</span>,<span class="string">'file'</span>)
1737     load(<span class="string">'phy_openedProjects.mat'</span>)
1738     handles.openedProjects=openedProjects;
1739 <span class="keyword">end</span>
1740 
1741 <span class="keyword">if</span> isempty(handles.openedProjects)
1742     [timeLapsefile, timeLapsepath] = uigetfile({<span class="string">'*.mat'</span>;<span class="string">'*.*'</span>},<span class="string">'Get timelapse file'</span>);
1743     <span class="keyword">if</span> timeLapsefile==0 <span class="comment">%if the user not press cancel</span>
1744         <span class="keyword">return</span>
1745     <span class="keyword">end</span>
1746     
1747     strPath=strcat(timeLapsepath,timeLapsefile);
1748     <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'loading timeLapse project'</span>,handles);
1749     load(strPath);
1750     
1751     <span class="keyword">if</span> ~isfield(timeLapse,<span class="string">'path'</span>) <span class="comment">%if the user loaded a valid timelapse project</span>
1752         <span class="keyword">return</span>
1753     <span class="keyword">end</span>
1754     
1755     timeLapse.path=timeLapsepath;
1756     timeLapse.realPath=timeLapsepath;
1757     
1758     <span class="comment">%dialog box for entering the position</span>
1759     <span class="comment">%------------------------------------</span>
1760     prompt = {<span class="string">'Enter position:'</span>};
1761     dlg_title = <span class="string">'Position'</span>;
1762     num_lines = 1;
1763     def = {<span class="string">'1'</span>};
1764     val=0;
1765     <span class="keyword">while</span> ~val
1766         
1767         answer = inputdlg(prompt,dlg_title,num_lines,def);
1768         <span class="keyword">if</span> isempty(answer)
1769             <span class="keyword">return</span>
1770         <span class="keyword">end</span>
1771         <span class="keyword">try</span>
1772             segmentation.position=str2double(answer{1});
1773             img=<a href="phy_loadTimeLapseImage.html" class="code" title="function image=phy_loadTimeLapseImage(pos,frame,ch,option)">phy_loadTimeLapseImage</a>(segmentation.position,1,1,<span class="string">'non retreat'</span>);
1774             val=1;
1775         <span class="keyword">catch</span>
1776             <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'wrong position'</span>,handles);
1777             prompt = {<span class="string">'Enter a valid position:'</span>};
1778         <span class="keyword">end</span>
1779     <span class="keyword">end</span>
1780     <span class="comment">%---------------------------------------------</span>
1781     handles.openedProjects={};
1782     handles.openedProjects={strPath,segmentation.position};
1783 <span class="keyword">else</span>
1784     project=<a href="phy_openProjectGui.html" class="code" title="function varargout = phy_openProjectGui(varargin)">phy_openProjectGui</a>(handles.openedProjects);
1785     <span class="keyword">if</span> isempty(project)
1786         <span class="keyword">return</span>
1787     <span class="keyword">end</span>
1788     <span class="keyword">if</span> isempty(project{1,1})
1789         [file, path] = uigetfile({<span class="string">'*.mat'</span>;<span class="string">'*.*'</span>},<span class="string">'Get timelapse file'</span>,handles.openedProjects{<span class="keyword">end</span>,1});
1790         <span class="keyword">if</span> file==0 <span class="comment">%if the user not press cancel</span>
1791             <span class="keyword">return</span>
1792         <span class="keyword">end</span>
1793         strPath=strcat(path,file);
1794         load(strPath);
1795         <span class="keyword">if</span> ~isfield(timeLapse,<span class="string">'path'</span>) <span class="comment">%if the user loaded a valid timelapse project</span>
1796             <span class="keyword">return</span>
1797         <span class="keyword">end</span>
1798         strPath=strcat(path,file);
1799         timeLapse.path=path;
1800         timeLapse.realPath=path;
1801 
1802         <span class="comment">%dialog box for entering the position</span>
1803         <span class="comment">%------------------------------------</span>
1804         prompt = {<span class="string">'Enter position:'</span>};
1805         dlg_title = <span class="string">'Position'</span>;
1806         num_lines = 1;
1807         def = {<span class="string">'1'</span>};
1808         val=0;
1809         <span class="keyword">while</span> ~val
1810             answer = inputdlg(prompt,dlg_title,num_lines,def);
1811             <span class="keyword">if</span> isempty(answer)
1812                 <span class="keyword">return</span>
1813             <span class="keyword">end</span>
1814             <span class="keyword">try</span>
1815                 segmentation.position=str2double(answer{1});
1816                 img=<a href="phy_loadTimeLapseImage.html" class="code" title="function image=phy_loadTimeLapseImage(pos,frame,ch,option)">phy_loadTimeLapseImage</a>(segmentation.position,1,1,<span class="string">'non retreat'</span>);
1817                 val=1;
1818             <span class="keyword">catch</span>
1819                 <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'wrong position'</span>,handles);
1820                 prompt = {<span class="string">'Enter a valid position:'</span>};
1821             <span class="keyword">end</span>
1822         <span class="keyword">end</span>
1823         <span class="comment">%---------------------------------------------</span>
1824         handles.openedProjects=[handles.openedProjects;{strPath,segmentation.position}];
1825     <span class="keyword">else</span>
1826         str=project{1};
1827         
1828         load(str);
1829         str=project{1};
1830         [pathstr, name, ext, versn] = fileparts(str);
1831         path=[pathstr,<span class="string">'/'</span>];
1832         timeLapse.path=path;
1833         timeLapse.realPath=path;
1834         
1835         segmentation.position=project{2};
1836         img=<a href="phy_loadTimeLapseImage.html" class="code" title="function image=phy_loadTimeLapseImage(pos,frame,ch,option)">phy_loadTimeLapseImage</a>(segmentation.position,1,1,<span class="string">'non retreat'</span>);
1837 
1838     <span class="keyword">end</span>
1839         
1840 <span class="keyword">end</span>
1841 
1842 openedProjects=handles.openedProjects;
1843 save(<span class="string">'phy_openedProjects.mat'</span>,<span class="string">'openedProjects'</span>);
1844 
1845 <span class="keyword">if</span> exist(fullfile(timeLapse.path,timeLapse.pathList.position{segmentation.position},<span class="string">'segmentation.mat'</span>),<span class="string">'file'</span>)
1846     <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'loading saved file segmentation'</span>,handles);
1847     tic
1848     load(fullfile(timeLapse.path,timeLapse.pathList.position{segmentation.position},<span class="string">'segmentation.mat'</span>))
1849     toc
1850     
1851     <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'refresh tbudnecks'</span>,handles);
1852     tic
1853     [segmentation.tbudnecks fchange]=<a href="phy_makeTObject.html" class="code" title="function [tObjectOut fChanged]=phy_makeTObject(objects,tObjectIn)">phy_makeTObject</a>(segmentation.budnecks,segmentation.tbudnecks);
1854     segmentation.frameChanged(fchange)=1;
1855     toc
1856     
1857     <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'refresh tcells1'</span>,handles);
1858     tic
1859     [segmentation.tcells1 fchange]=<a href="phy_makeTObject.html" class="code" title="function [tObjectOut fChanged]=phy_makeTObject(objects,tObjectIn)">phy_makeTObject</a>(segmentation.cells1,segmentation.tcells1); 
1860     segmentation.frameChanged(fchange)=1;
1861     toc
1862     
1863 <span class="comment">%     status('refresh segmentation.tcells2',handles);</span>
1864 <span class="comment">%     tic</span>
1865 <span class="comment">%     [segmentation.tcells2 fchange]=phy_makeTObject(segmentation.cells2,segmentation.tcells2);</span>
1866 <span class="comment">%     segmentation.frameChanged(fchange)=1;</span>
1867 <span class="comment">%     toc</span>
1868     <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'Idle'</span>,handles);
1869 <span class="keyword">else</span>
1870     <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'creating the segemntation file'</span>,handles);
1871     segmentation.cells1=<a href="phy_Object.html" class="code" title="">phy_Object</a>;
1872     <span class="comment">%segmentation.cells1(1:timeLapse.numberOfFrames)=phy_Object;</span>
1873     segmentation.cells1Segmented=zeros(1,timeLapse.numberOfFrames);
1874     <span class="comment">%segmentation.cells2=phy_Object;</span>
1875     <span class="comment">%segmentation.cells2(1:timeLapse.numberOfFrames)=phy_Object;</span>
1876     <span class="comment">%segmentation.cell2Segmented=zeros(1,timeLapse.numberOfFrames);</span>
1877     segmentation.budnecks=<a href="phy_Object.html" class="code" title="">phy_Object</a>;
1878     <span class="comment">%segmentation.budnecks(1:timeLapse.numberOfFrames)=phy_Object;</span>
1879     segmentation.budnecksSegmented=zeros(1,timeLapse.numberOfFrames);
1880     segmentation.tcells1=<a href="phy_Tobject.html" class="code" title="">phy_Tobject</a>;
1881     <span class="comment">%segmentation.tcells2=phy_Tobject;</span>
1882     segmentation.tbudnecks=<a href="phy_Tobject.html" class="code" title="">phy_Tobject</a>;
1883     
1884     segmentation.cells1Mapped=zeros(1,timeLapse.numberOfFrames);
1885     segmentation.budnecksMapped=zeros(1,timeLapse.numberOfFrames);
1886     
1887     nch=length(timeLapse.pathList.channels(1,:));
1888     
1889     segmentation.colorData=zeros(nch,6);
1890     segmentation.colorData(:,[1 2 3 5])=1;
1891     segmentation.colorData(:,6)=2;
1892     segmentation.phaseChannel=1;
1893     segmentation.budneckChannel=2;
1894     
1895     <span class="comment">%segmentation settings</span>
1896     segmentation.parametres.budneck_diameter=15;
1897     segmentation.parametres.cell_diameter=50;
1898     segmentation.parametres.segmentation=2;
1899     segmentation.parametres.numberPixelsWat=50; <span class="comment">%number of pixel to add in watershed before doing an ellipse aproximation</span>
1900     segmentation.parametres.budneckRefine=0; <span class="comment">%refine budneck segmentation [-1,1]</span>
1901     
1902     <span class="comment">%pedigree settings default values</span>
1903     segmentation.pedigree.plotType=2;
1904     segmentation.pedigree.makeType=1;
1905     
1906     <span class="comment">%check settings default values</span>
1907     segmentation.check.budneckTimeLow=5;
1908     segmentation.check.budneckTimeHigh=20;
1909     
1910     segmentation.frame1=1;
1911     
1912     segmentation.frameChanged=zeros(1,timeLapse.numberOfFrames);
1913     
1914     segmentation.showFieldsObj={<span class="string">'n'</span>,<span class="string">'area'</span>,<span class="string">'ox'</span>,<span class="string">'oy'</span>,<span class="string">'image'</span>,<span class="string">'mother'</span>,<span class="string">'selected'</span>,<span class="string">'dependentData'</span>,<span class="string">'cell2'</span>};
1915     segmentation.showFieldsTObj={<span class="string">'N'</span>,<span class="string">'detectionFrame'</span>,<span class="string">'birthFrame'</span>,<span class="string">'lastFrame'</span>,<span class="string">'mother'</span>,<span class="string">'mothers'</span>,<span class="string">'daughterList'</span>,<span class="string">'divisionTimes'</span>,<span class="string">'budTimes'</span>,<span class="string">'selected'</span>};
1916     
1917     
1918     save(fullfile(timeLapse.path,timeLapse.pathList.position{segmentation.position},<span class="string">'segmentation.mat'</span>),<span class="string">'segmentation'</span>);
1919     <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'idle'</span>,handles);
1920 <span class="keyword">end</span>
1921 
1922 nch=length(timeLapse.pathList.channels(1,:));
1923 <span class="comment">%dialog box for entering the position</span>
1924 <span class="comment">%------------------------------------</span>
1925 prompt = {<span class="string">'Enter phase channel(0 if not existent)'</span>,<span class="string">'Enter budneck channel(0 if not existent)'</span>};
1926 dlg_title = <span class="string">'Phase/budneck channel'</span>;
1927 num_lines = 1;
1928 pc=segmentation.phaseChannel;
1929 bc=segmentation.budneckChannel;
1930 def = {num2str(segmentation.phaseChannel),num2str(segmentation.budneckChannel)};
1931 val=0;
1932 <span class="keyword">while</span> ~val
1933     
1934     answer = inputdlg(prompt,dlg_title,num_lines,def);
1935     <span class="keyword">if</span> isempty(answer)
1936         <span class="keyword">return</span>
1937     <span class="keyword">end</span>
1938     val=1;
1939     segmentation.phaseChannel=str2double(answer{1});
1940     segmentation.budneckChannel=str2double(answer{2});
1941     <span class="keyword">if</span> segmentation.phaseChannel==segmentation.budneckChannel
1942         <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'wrong channel'</span>,handles);
1943         prompt = {<span class="string">'Enter a diferent phase channel or'</span>,<span class="string">'Enter a diferent budneck channel'</span>};
1944         val=0;
1945     <span class="keyword">end</span>
1946     <span class="keyword">if</span> segmentation.phaseChannel&gt;nch || segmentation.phaseChannel&lt;0
1947         <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'wrong channel'</span>,handles);
1948         prompt = {<span class="string">'Enter a valid phase channel'</span>,<span class="string">'Enter budneck channel'</span>};
1949         val=0;
1950     <span class="keyword">end</span>
1951     <span class="keyword">if</span> segmentation.budneckChannel&gt;nch || segmentation.budneckChannel&lt;0
1952         <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'wrong channel'</span>,handles);
1953         prompt = {<span class="string">'Enter phase channel'</span>,<span class="string">'Enter a valid budneck channel'</span>};
1954         val=0;
1955     <span class="keyword">end</span>
1956 <span class="keyword">end</span>
1957 <span class="comment">%---------------------------------------------</span>
1958 <span class="keyword">if</span> segmentation.phaseChannel~=pc || segmentation.budneckChannel~=bc
1959 <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'saving to file'</span>,handles);
1960 save(fullfile(timeLapse.path,timeLapse.pathList.position{segmentation.position},<span class="string">'segmentation.mat'</span>),<span class="string">'segmentation'</span>,<span class="string">'-append'</span>);
1961 <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'idle'</span>,handles);
1962 <span class="keyword">end</span>
1963 img_size=size(img);
1964 nch=length(timeLapse.pathList.channels(1,:));
1965 
1966 
1967 hold(handles.axes1,<span class="string">'on'</span>);
1968 str={};
1969 <span class="keyword">for</span> i=1:nch
1970     img=<a href="phy_loadTimeLapseImage.html" class="code" title="function image=phy_loadTimeLapseImage(pos,frame,ch,option)">phy_loadTimeLapseImage</a>(segmentation.position,segmentation.frame1,i,<span class="string">'non retreat'</span>);
1971     classimg=class(img);
1972     img_size=max(img_size,size(img));
1973     img=<a href="phy_scale.html" class="code" title="function y = phy_scale(varargin)">phy_scale</a>(img);
1974     img=repmat(img,[1,1,3]);
1975     segmentation.himg(i)=imshow(img,<span class="string">'Parent'</span>,handles.axes1);
1976     str=[str;[<span class="string">'channel'</span>,num2str(i)]];
1977 <span class="keyword">end</span>
1978 
1979 
1980 hold(handles.axes1,<span class="string">'off'</span>);
1981 
1982 set(handles.listbox_Channels,<span class="string">'string'</span>,str);
1983 set(handles.text_Channels,<span class="string">'string'</span>,str);
1984 
1985 segmentation.channels=1:nch;
1986 segmentation.realImage=zeros([img_size,nch],classimg);
1987 segmentation.segmentationImage=zeros([img_size,nch],class(img));
1988 segmentation.sizeImageMax=img_size;
1989 
1990 timeLapse.currentFrame=0;
1991 timeLapse.currentFrame2=0;
1992 
1993 segmentation.v_axe1=[0    img_size(2)   0    img_size(1)];
1994 segmentation.v_axe2=[0    img_size(2)   0    img_size(1)];
1995 
1996 segmentation.myHandles.showBudnecks=[];
1997 segmentation.myHandles.showBudnecksText=[];
1998 segmentation.myHandles.showCells=[];
1999 segmentation.myHandles.showCellsText=[];
2000 segmentation.myHandles.showCells2=[];
2001 segmentation.myHandles.showCells2Text=[];
2002 segmentation.myHandles.showPedigree2=[];
2003 segmentation.myHandles.showPedigree1=[];
2004 
2005 segmentation.selectedTObj={};
2006 segmentation.selectedObj={};
2007 segmentation.copyedObj={};
2008 
2009 set(handles.listbox_Channels,<span class="string">'value'</span>,1)
2010 set(handles.Segmentation,<span class="string">'Enable'</span>,<span class="string">'on'</span>);
2011 set(handles.Pedigree,<span class="string">'Enable'</span>,<span class="string">'on'</span>);
2012 set(handles.uipanel_Segmentation,<span class="string">'Visible'</span>,<span class="string">'on'</span>);
2013 set(handles.slider1,<span class="string">'Max'</span>,timeLapse.numberOfFrames);
2014 <span class="comment">%        set(handles.slider2,'Max',timeLapse.numberOfFrames);</span>
2015 <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'displaing the channels'</span>,handles);
2016 <a href="#_sub64" class="code" title="subfunction Change_Disp1(pos,handles)">Change_Disp1</a>(segmentation.frame1,handles);
2017 <span class="comment">% Change_Disp2(2,handles);</span>
2018 
2019 guidata(hObject, handles);
2020 <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'Idle'</span>,handles);
2021 
2022 
2023 <span class="comment">% --------------------------------------------------------------------</span>
2024 <a name="_sub59" href="#_subfunctions" class="code">function NewProject_ClickedCallback(hObject, eventdata, handles)</a>
2025 <span class="comment">%</span>
2026 <a href="phy_createTimeLapseProjectGui.html" class="code" title="function varargout = phy_createTimeLapseProjectGui(varargin)">phy_createTimeLapseProjectGui</a>();
2027 
2028 
2029 
2030 
2031 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
2032 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%% CHECKBOX CALLBACK FUNCTIONS %%%%%%%%%%%%%%%%%%%%</span>
2033 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
2034 
2035 
2036 
2037 <a name="_sub60" href="#_subfunctions" class="code">function handles=checkbox_ShowCells_Callback(hObject, eventdata, handles)</a>
2038 <span class="comment">%show the cells1 by first segmentation on the first display</span>
2039 <span class="keyword">global</span> segmentation
2040 
2041 
2042 <span class="comment">%AppData=getappdata(handles.figure1);</span>
2043 <span class="keyword">if</span> size(segmentation.cells1,1)&gt;=segmentation.frame1 <span class="comment">%check if the image was segmented</span>
2044     <span class="keyword">if</span> get(hObject,<span class="string">'Value'</span>) <span class="comment">%if checked</span>
2045         [segmentation.myHandles.showCells segmentation.myHandles.showCellsText]=<a href="phy_showObject.html" class="code" title="function [hplot htext]=phy_showObject(haxe,object,color,name,hplotin,htextin,option)">phy_showObject</a>(handles.axes1,segmentation.cells1(segmentation.frame1,:),<span class="string">'r'</span>,<span class="string">'cells1'</span>,segmentation.myHandles.showCells,segmentation.myHandles.showCellsText,<span class="string">'on'</span>);
2046         set(segmentation.myHandles.showCells(:),<span class="string">'ButtonDownFcn'</span>,{@<a href="#_sub70" class="code" title="subfunction mouseSelectObject(hObject, eventdata, handles)">mouseSelectObject</a>,handles});
2047         set(segmentation.myHandles.showCells(:),<span class="string">'UIContextMenu'</span>,handles.Context_Objects);    
2048          <span class="comment">%set(segmentation.myHandles.showCells(:),'userdata',segmentation.cells1(segmentation.frame1,:));</span>
2049     <span class="keyword">else</span> <span class="comment">%if not checked</span>
2050         [segmentation.myHandles.showCells segmentation.myHandles.showCellsText]=<a href="phy_showObject.html" class="code" title="function [hplot htext]=phy_showObject(haxe,object,color,name,hplotin,htextin,option)">phy_showObject</a>(handles.axes1,segmentation.cells1(segmentation.frame1,:),<span class="string">'r'</span>,<span class="string">'cells1'</span>,segmentation.myHandles.showCells,segmentation.myHandles.showCellsText,<span class="string">'off'</span>);
2051     <span class="keyword">end</span>
2052 <span class="keyword">end</span>
2053 <span class="comment">%setappdata(handles.figure1,'AppData',AppData);</span>
2054 guidata(hObject, handles); <span class="comment">% Save the structure</span>
2055 
2056 
2057 
2058 <a name="_sub61" href="#_subfunctions" class="code">function handles=checkbox_ShowBudneck_Callback(hObject, eventdata, handles)</a>
2059 <span class="keyword">global</span> segmentation
2060 
2061 <span class="keyword">if</span> size(segmentation.budnecks,1)&gt;=segmentation.frame1 <span class="comment">%check if the image was segmented</span>
2062     <span class="keyword">if</span> get(hObject,<span class="string">'Value'</span>) <span class="comment">%if checked</span>
2063         [segmentation.myHandles.showBudnecks segmentation.myHandles.showBudnecksText]<span class="keyword">...</span>
2064             =<a href="phy_showObject.html" class="code" title="function [hplot htext]=phy_showObject(haxe,object,color,name,hplotin,htextin,option)">phy_showObject</a>(handles.axes1,segmentation.budnecks(segmentation.frame1,:),<span class="string">'b'</span>,<span class="string">'budnecks'</span>,segmentation.myHandles.showBudnecks,segmentation.myHandles.showBudnecksText,<span class="string">'on'</span>);
2065         set(segmentation.myHandles.showBudnecks(:),<span class="string">'ButtonDownFcn'</span>,{@<a href="#_sub70" class="code" title="subfunction mouseSelectObject(hObject, eventdata, handles)">mouseSelectObject</a>,handles});
2066         set(segmentation.myHandles.showBudnecks(:),<span class="string">'UIContextMenu'</span>,handles.Context_Objects); 
2067     <span class="keyword">else</span> <span class="comment">%if not checked</span>
2068         [segmentation.myHandles.showBudnecks segmentation.myHandles.showBudnecksText]<span class="keyword">...</span>
2069             =<a href="phy_showObject.html" class="code" title="function [hplot htext]=phy_showObject(haxe,object,color,name,hplotin,htextin,option)">phy_showObject</a>(handles.axes1,segmentation.budnecks(segmentation.frame1,:),<span class="string">'b'</span>,<span class="string">'budnecks'</span>,segmentation.myHandles.showBudnecks,segmentation.myHandles.showBudnecksText,<span class="string">'off'</span>);
2070     <span class="keyword">end</span>
2071 <span class="keyword">end</span>
2072 guidata(hObject, handles);<span class="comment">% Save the structure</span>
2073 
2074 <span class="comment">% --- Executes on button press in checkbox_ShowCells2.</span>
2075 <a name="_sub62" href="#_subfunctions" class="code">function handles=checkbox_ShowCells2_Callback(hObject, eventdata, handles)</a>
2076 
2077 <span class="comment">% --- Executes on button press in checkbox_Show_Pedigree.</span>
2078 <a name="_sub63" href="#_subfunctions" class="code">function handles=checkbox_Show_Pedigree_Callback(hObject, eventdata, handles)</a>
2079 
2080 <span class="keyword">global</span> segmentation
2081 
2082 <span class="keyword">if</span> size(segmentation.cells1,1)&gt;=segmentation.frame1 <span class="comment">%test if the image already segmented</span>
2083     <span class="keyword">if</span> get(hObject,<span class="string">'Value'</span>) <span class="comment">%if checked</span>
2084         segmentation.myHandles.showPedigree1=<a href="phy_showPedigree.html" class="code" title="function h=phy_showPedigree(haxe,cells,hin,option)">phy_showPedigree</a>(handles.axes1,segmentation.cells1(segmentation.frame1,:),segmentation.myHandles.showPedigree1,<span class="string">'on'</span>);
2085     <span class="keyword">else</span>
2086         segmentation.myHandles.showPedigree1=<a href="phy_showPedigree.html" class="code" title="function h=phy_showPedigree(haxe,cells,hin,option)">phy_showPedigree</a>(handles.axes1,segmentation.cells1(segmentation.frame1,:),segmentation.myHandles.showPedigree1,<span class="string">'off'</span>);
2087     <span class="keyword">end</span>
2088 <span class="keyword">end</span>
2089 
2090 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
2091 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%% OWN FUNCTIONS %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
2092 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
2093 
2094 
2095 <a name="_sub64" href="#_subfunctions" class="code">function Change_Disp1(pos,handles)</a>
2096 <span class="comment">%change all the buttons, sliders edittxe related to axex1</span>
2097 
2098 <span class="keyword">global</span> timeLapse;
2099 <span class="keyword">global</span> segmentation
2100 
2101 
2102 <span class="keyword">if</span> strcmpi(pos,<span class="string">'refresh'</span>)
2103     timeLapse.currentFrame=0;
2104     pos=segmentation.frame1;
2105 <span class="keyword">end</span>
2106 
2107 Min=get(handles.slider1,<span class="string">'Min'</span>);
2108 Max=get(handles.slider1,<span class="string">'Max'</span>);
2109 
2110 <span class="keyword">if</span> isempty(pos)
2111     pos=segmentation.frame1;
2112 <span class="keyword">end</span>
2113 <span class="keyword">if</span> (pos&lt; Min)
2114     pos=Min;
2115 <span class="keyword">end</span>
2116 <span class="keyword">if</span> (pos&gt;Max)
2117     pos=Max;
2118 <span class="keyword">end</span>
2119 <span class="comment">% Check that the entered value falls within the allowable range.</span>
2120 set(handles.editFrame1,<span class="string">'String'</span>,round(pos));
2121 set(handles.slider1,<span class="string">'Value'</span>,pos);
2122 
2123 
2124 segmentation.frame1=round(pos);
2125 
2126 <span class="keyword">if</span> isfield(timeLapse,<span class="string">'numberOfFrames'</span>)
2127     <span class="keyword">if</span> segmentation.frame1~=timeLapse.currentFrame
2128         <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'Displaying ...'</span>,handles);
2129         
2130         segmentation.myHandles.showCells=[];
2131         segmentation.myHandles.showBudnecks=[];<span class="comment">%clear contours from previous image</span>
2132         
2133         timeLapse.currentFrame=segmentation.frame1;
2134         nch=length(timeLapse.pathList.channels(1,:));<span class="comment">%n chanels</span>
2135         
2136         segmentation.segmentationImage=zeros(size(segmentation.realImage),class(segmentation.realImage));
2137 
2138         <span class="keyword">for</span> i=1:nch
2139             <span class="keyword">if</span> length(segmentation.channels)&gt;=i <span class="comment">%for displayed images load the image</span>
2140 
2141                 img=<a href="phy_loadTimeLapseImage.html" class="code" title="function image=phy_loadTimeLapseImage(pos,frame,ch,option)">phy_loadTimeLapseImage</a>(segmentation.position,segmentation.frame1,segmentation.channels(i),<span class="string">'non retreat'</span>);
2142                 img=imresize(img,segmentation.sizeImageMax);
2143                 segmentation.realImage(:,:,segmentation.channels(i))=img;
2144                 <span class="keyword">if</span> segmentation.colorData(segmentation.channels(i),4)&gt;=segmentation.colorData(segmentation.channels(i),5)
2145                     segmentation.colorData(segmentation.channels(i),5)=segmentation.colorData(segmentation.channels(i),4)+0.001;
2146                 <span class="keyword">end</span>
2147                 img=imadjust(img,segmentation.colorData(segmentation.channels(i),[4 5]),[]);
2148                 
2149                 <span class="keyword">if</span> get(handles.checkbox_Use_Display_Image,<span class="string">'value'</span>)
2150                     
2151                     I2=img;
2152                     
2153                 <span class="keyword">else</span>
2154                     I2=segmentation.realImage(:,:,segmentation.channels(i));
2155                     <span class="comment">%img=imadjust(img,segmentation.colorData(segmentation.channels(i),[4 5]),[]);</span>
2156                 <span class="keyword">end</span>
2157                 
2158                 <span class="keyword">if</span> i==1 &amp;&amp; get(handles.checkbox_Use_Cropped_Image,<span class="string">'value'</span>) <span class="comment">%crop</span>
2159                     ax=floor(segmentation.v_axe1); <span class="comment">%the axes</span>
2160                     s1=size(img,1);
2161                     s2=size(img,2);
2162                     segmentation.segmentationImage=zeros([min(ax(4)-ax(3)+1,s1),min(ax(2)-ax(1)+1,s2),nch],class(segmentation.segmentationImage));
2163 
2164                     I2=imcrop(I2, [ax(1),ax(3),ax(2)-ax(1),ax(4)-ax(3)]);
2165                     segmentation.segmentationImage(:,:,segmentation.channels(i))=I2;
2166                 <span class="keyword">elseif</span> get(handles.checkbox_Use_Cropped_Image,<span class="string">'value'</span>)
2167                     I2=imcrop(I2, [ax(1),ax(3),ax(2)-ax(1),ax(4)-ax(3)]);
2168                     segmentation.segmentationImage(:,:,segmentation.channels(i))=I2;
2169                 <span class="keyword">else</span>
2170                     segmentation.segmentationImage(:,:,segmentation.channels(i))=I2;                                   
2171                 <span class="keyword">end</span>
2172                 
2173                 <span class="comment">%create rgb image</span>
2174                 RGB=segmentation.colorData(segmentation.channels(i),[1 2 3]);
2175                 imgRGB=cat(3,img*RGB(1),img*RGB(2),img*RGB(3));
2176                 
2177                 <span class="comment">%set(segmentation.himg(i),'Cdata',imgRGB);</span>
2178                 segmentation.himg(i)=imshow(imgRGB,<span class="string">'Parent'</span>,handles.axes1);
2179                 <span class="keyword">if</span> i==1
2180                     set(segmentation.himg(i),<span class="string">'AlphaData'</span>,1);
2181                     hold(handles.axes1,<span class="string">'on'</span>);
2182                 <span class="keyword">else</span>
2183                     <span class="keyword">if</span> segmentation.colorData(segmentation.channels(i),6)==2
2184                         set(segmentation.himg(i),<span class="string">'AlphaData'</span>,img);
2185                     <span class="keyword">else</span>
2186                         set(segmentation.himg(i),<span class="string">'AlphaData'</span>,segmentation.colorData(segmentation.channels(i),6));
2187                     <span class="keyword">end</span>
2188                 <span class="keyword">end</span>
2189             <span class="keyword">else</span> <span class="comment">%for non displayed channels use an empty image</span>
2190                 im=zeros(1,1,3);
2191                 segmentation.himg(i)=imshow(im,<span class="string">'Parent'</span>,handles.axes1);
2192                 <span class="keyword">if</span> i==1
2193                     set(segmentation.himg(i),<span class="string">'AlphaData'</span>,1);
2194                     hold(handles.axes1,<span class="string">'on'</span>);
2195                 <span class="keyword">else</span>
2196                     set(segmentation.himg(i),<span class="string">'AlphaData'</span>,0);
2197                 <span class="keyword">end</span>
2198 
2199             <span class="keyword">end</span>
2200             set(segmentation.himg(i),<span class="string">'ButtonDownFcn'</span>,{@<a href="#_sub69" class="code" title="subfunction mouseAxesImage(hObject, eventdata, handles)">mouseAxesImage</a>,handles});
2201             set(segmentation.himg(i),<span class="string">'UIContextMenu'</span>,handles.Context_Image);
2202         <span class="keyword">end</span>
2203         hold(handles.axes1,<span class="string">'off'</span>);
2204         axis(handles.axes1,segmentation.v_axe1);
2205         
2206 
2207         handles=<a href="#_sub63" class="code" title="subfunction handles=checkbox_Show_Pedigree_Callback(hObject, eventdata, handles)">checkbox_Show_Pedigree_Callback</a>(handles.checkbox_Show_Pedigree, [], handles);
2208 
2209         handles=<a href="#_sub60" class="code" title="subfunction handles=checkbox_ShowCells_Callback(hObject, eventdata, handles)">checkbox_ShowCells_Callback</a>(handles.checkbox_ShowCells, [], handles);<span class="comment">%if the case is checked then show the segmentation.cells1 by first segmentation</span>
2210 
2211         handles=<a href="#_sub61" class="code" title="subfunction handles=checkbox_ShowBudneck_Callback(hObject, eventdata, handles)">checkbox_ShowBudneck_Callback</a>(handles.checkbox_ShowBudneck, [], handles); <span class="comment">%if the case is checked then show the budnecks</span>
2212         
2213         segmentation.selectedObj={};
2214         segmentation.selectedTObj={};
2215                 hselected=findobj(<span class="string">'Selected'</span>,<span class="string">'on'</span>);
2216         <span class="keyword">if</span> isempty(hselected)
2217             set(handles.edit_Cell_Properties,<span class="string">'string'</span>,[]);
2218             <span class="comment">%set(handles.edit_TCell_Properties,'string',[]);</span>
2219         <span class="keyword">else</span>
2220             <a href="#_sub70" class="code" title="subfunction mouseSelectObject(hObject, eventdata, handles)">mouseSelectObject</a>(hselected(1), 1, handles);
2221         <span class="keyword">end</span>
2222 
2223         
2224         
2225         <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'Idle'</span>,handles);
2226     <span class="keyword">end</span>
2227     segmentation.v_axe1=axis(handles.axes1);
2228 <span class="keyword">end</span>
2229 uicontrol(handles.pushbutton_Next1); <span class="comment">%give focus to buton next (key pres when slider has focux)</span>
2230 
2231 
2232 <span class="comment">% ------------------------------------------------------------------------</span>
2233 <a name="_sub65" href="#_subfunctions" class="code">function mouseFcn(hObject, eventdata, handles)</a>
2234 <span class="comment">%called by zoom and pan functions</span>
2235 <span class="comment">%mouse motion sensible function</span>
2236 <span class="comment">%change all the values on the frame panel</span>
2237 
2238 newVal = get(handles.slider1, <span class="string">'Value'</span>);
2239 <a href="#_sub64" class="code" title="subfunction Change_Disp1(pos,handles)">Change_Disp1</a>(newVal,handles);
2240 set(handles.checkbox_Use_Cropped_Image,<span class="string">'value'</span>,0);
2241 
2242 
2243 <span class="comment">% ------------------------------------------------------------------------</span>
2244 <a name="_sub66" href="#_subfunctions" class="code">function checkBoxChannel_first(hObject, eventdata, handles)</a>
2245 <span class="keyword">global</span> timeLapse
2246 <span class="keyword">global</span> segmentation;
2247 timeLapse.currentFrame=0;
2248 <a href="#_sub64" class="code" title="subfunction Change_Disp1(pos,handles)">Change_Disp1</a>(segmentation.frame1,handles);
2249 
2250 <span class="comment">% ------------------------------------------------------------------------</span>
2251 <a name="_sub67" href="#_subfunctions" class="code">function editChannel_first(hObject, eventdata, handles)</a>
2252 <span class="keyword">global</span> timeLapse
2253 <span class="keyword">global</span> segmentation;
2254 timeLapse.currentFrame=0;
2255 <a href="#_sub64" class="code" title="subfunction Change_Disp1(pos,handles)">Change_Disp1</a>(segmentation.frame1,handles);
2256 
2257 <span class="comment">% ------------------------------------------------------------------------</span>
2258 <a name="_sub68" href="#_subfunctions" class="code">function mousePedigreePlot(hObject, eventdata, handles,haxe)</a>
2259 <span class="comment">% use to get the cells by duble clicking on the pedigree plot</span>
2260 <span class="keyword">global</span> segmentation
2261 
2262 <span class="keyword">if</span> ~isempty(segmentation.selectedTObj)  <span class="comment">%if exist a selected tobject then delesect it</span>
2263     segmentation.selectedTObj.deselect();
2264     segmentation.selectedTObj={};
2265 <span class="keyword">end</span>
2266 <span class="keyword">if</span> ~isempty(segmentation.selectedObj) <span class="comment">%if exist a selected object then deselect it</span>
2267     segmentation.selectedObj.selected=0;
2268     segmentation.selectedObj={};    
2269 <span class="keyword">end</span>
2270 
2271 butonType=get(get(haxe,<span class="string">'parent'</span>),<span class="string">'SelectionType'</span>);
2272 pt = get(haxe, <span class="string">'CurrentPoint'</span>);
2273 i=round(pt(1,2));
2274 j=round(pt(1,1));
2275 uData=get(hObject,<span class="string">'UserData'</span>);
2276 img=uData.image;
2277 col=zeros(1,3);
2278 col(:)=img(i,j,:);
2279 <span class="keyword">if</span> col(1)~=1||col(2)~=1||col(2)~=1
2280     xpos=uData.xpos;
2281     linesize=uData.linesize;
2282      tcells=segmentation.tcells1;
2283     nCell=find((xpos&lt;=j)&amp;(xpos+linesize&gt;=j));
2284     <span class="keyword">if</span> ~isempty(nCell)
2285         scaleFactor=uData.scaleFactor;
2286         frame=ceil(i/scaleFactor);
2287         <span class="keyword">if</span> tcells(nCell).birthFrame&lt;=frame
2288             set(get(haxe,<span class="string">'Title'</span>),<span class="string">'string'</span>,{[<span class="string">'Cell :'</span>,num2str(nCell)],[<span class="string">'Frame :'</span>,num2str(frame)]});
2289             <span class="keyword">if</span> isfield(uData,<span class="string">'hselect'</span>)
2290                 hs=uData.hselect;
2291                 set(hs,<span class="string">'xData'</span>,j);
2292                 set(hs,<span class="string">'yData'</span>,i);
2293             <span class="keyword">else</span>
2294                 hold(haxe,<span class="string">'on'</span>);
2295                 uData.hselect=plot(haxe,j,i,<span class="string">'co'</span>,<span class="string">'hitTest'</span>,<span class="string">'off'</span>);
2296                 hold(haxe,<span class="string">'off'</span>);
2297             <span class="keyword">end</span>
2298             set(hObject,<span class="string">'UserData'</span>,uData);
2299             <span class="keyword">if</span> strcmp(butonType,<span class="string">'open'</span>)
2300                 <span class="comment">%set(handles.figure1,'visible','off');</span>
2301                 set(handles.figure1,<span class="string">'visible'</span>,<span class="string">'on'</span>);
2302                 pause(0.01);
2303                 segmentation.selectedTObj=tcells(nCell);
2304                 tcells(nCell).select();
2305 <span class="comment">%                 for i=1:length(tcells(nCell).Obj)</span>
2306 <span class="comment">%                     if tcells(nCell).Obj(i).image==frame;</span>
2307 <span class="comment">%                         segmentation.selectedObj=tcells(nCell).Obj(i);</span>
2308 <span class="comment">%                     end</span>
2309 <span class="comment">%                 end</span>
2310                 <a href="#_sub64" class="code" title="subfunction Change_Disp1(pos,handles)">Change_Disp1</a>(frame,handles);
2311             <span class="keyword">end</span>
2312         <span class="keyword">end</span>
2313     <span class="keyword">end</span>
2314 <span class="keyword">end</span>;
2315 
2316 <span class="comment">% ------------------------------------------------------------------------</span>
2317 <a name="_sub69" href="#_subfunctions" class="code">function mouseAxesImage(hObject, eventdata, handles)</a>
2318 <span class="comment">% use to deselect objects</span>
2319 <span class="keyword">global</span> segmentation
2320 
2321 butonType=get(handles.figure1,<span class="string">'SelectionType'</span>);
2322 
2323 <span class="keyword">if</span> ~isempty(segmentation.selectedObj)
2324     <span class="comment">%segmentation.selectedObj.selected=false;</span>
2325     <span class="keyword">if</span> ishandle(segmentation.selectedObj.hcontour)
2326         set(segmentation.selectedObj.hcontour,<span class="string">'Marker'</span>,<span class="string">'none'</span>);
2327         set(segmentation.selectedObj.hcontour,<span class="string">'Selected'</span>,<span class="string">'off'</span>);
2328     <span class="keyword">end</span>
2329     set(handles.edit_Cell_Properties,<span class="string">'string'</span>,[]);
2330     segmentation.selectedObj={};
2331             
2332 <span class="keyword">end</span>
2333 
2334 <span class="keyword">if</span> strcmp(butonType,<span class="string">'open'</span>)
2335     <span class="keyword">if</span> ~isempty(segmentation.selectedTObj)
2336         segmentation.selectedTObj.deselect();
2337     <span class="keyword">end</span>
2338 
2339 set(handles.edit_TCell_Properties,<span class="string">'string'</span>,[]);
2340 segmentation.selectedTObj={};
2341 <span class="keyword">end</span>
2342 
2343 
2344 
2345 <span class="comment">%------------------------------------------------------------------------</span>
2346 <span class="comment">%function to select an object with the mouse</span>
2347 <a name="_sub70" href="#_subfunctions" class="code">function mouseSelectObject(hObject, eventdata, handles)</a>
2348 <span class="comment">%used to select the objects with mouse</span>
2349 
2350 <span class="keyword">global</span> segmentation
2351 
2352 butonType=get(handles.figure1,<span class="string">'SelectionType'</span>);<span class="comment">%get the tipe of click</span>
2353 
2354 <span class="comment">%deselect selected object</span>
2355 <span class="keyword">if</span> ~isempty(segmentation.selectedObj) <span class="comment">% if already selected an object</span>
2356     <span class="comment">%segmentation.selectedObj.selected=false;</span>
2357     <span class="keyword">if</span> ishandle(segmentation.selectedObj.hcontour)&amp;&amp;(segmentation.selectedObj.hcontour~=0)
2358         set(segmentation.selectedObj.hcontour,<span class="string">'Marker'</span>,<span class="string">'none'</span>);
2359         set(segmentation.selectedObj.hcontour,<span class="string">'Selected'</span>,<span class="string">'off'</span>);
2360     <span class="keyword">end</span>
2361     segmentation.selectedObj={};
2362 <span class="keyword">end</span>
2363 
2364 <span class="comment">%deselect selected object</span>
2365 <span class="keyword">if</span> ~isempty(segmentation.selectedTObj)
2366     segmentation.selectedTObj.deselect();
2367     segmentation.selectedTObj={};
2368 <span class="keyword">end</span>
2369 
2370 <span class="comment">%change the contour</span>
2371 set(hObject,<span class="string">'Selected'</span>,<span class="string">'on'</span>);
2372 set(hObject,<span class="string">'Marker'</span>,<span class="string">'*'</span>,<span class="string">'MarkerSize'</span>,4,<span class="string">'MarkerEdgeColor'</span>,<span class="string">'c'</span>);
2373 
2374 <span class="comment">%get the selected object from user data</span>
2375 str=get(hObject,<span class="string">'DisplayName'</span>);
2376 segmentation.selectedObj=get(hObject,<span class="string">'userdata'</span>);
2377 <span class="comment">%segmentation.selectedObj.selected=true;</span>
2378 segmentation.selectedType=str;
2379 n=segmentation.selectedObj.n;
2380 
2381 <span class="comment">%move the object with the mouse</span>
2382 <span class="keyword">if</span> strcmpi(butonType,<span class="string">'normal'</span>) &amp;&amp; segmentation.selectedObj.move==1 &amp;&amp; isempty(eventdata) 
2383     <span class="comment">%if clicked , if allowed to move , if object selected by mouse , not by</span>
2384     <span class="comment">%change Disp1</span>
2385     old = get(gca, <span class="string">'CurrentPoint'</span>);
2386     segmentation.myHandles.oldPoint=old;
2387     set(handles.figure1, <span class="string">'WindowButtonMotionFcn'</span>,{@<a href="#_sub71" class="code" title="subfunction mouse_dragginObj(hObect,evendata,obj)">mouse_dragginObj</a>,hObject});
2388     segmentation.frameChanged(segmentation.frame1)=1;
2389 <span class="keyword">end</span>
2390 
2391 <span class="comment">%lock the object by duble click</span>
2392 <span class="keyword">if</span> segmentation.selectedObj.move==1 &amp;&amp;strcmp(butonType,<span class="string">'open'</span>)
2393     segmentation.selectedObj.move=0;
2394 <span class="keyword">end</span>
2395     
2396 
2397 <span class="comment">%show the fields of the object in the cell properties</span>
2398 s=<span class="string">''</span>;
2399 <span class="keyword">for</span> i=1:length(segmentation.showFieldsObj)
2400     <span class="keyword">if</span> isnumeric(segmentation.selectedObj.(segmentation.showFieldsObj{i}))
2401         sprop=segmentation.selectedObj.(segmentation.showFieldsObj{i});
2402         <span class="keyword">if</span> size(sprop,1)&gt;size(sprop,2)
2403             sprop=sprop';
2404         <span class="keyword">end</span>
2405         s=[s,segmentation.showFieldsObj{i},<span class="string">': '</span>,num2str(sprop),<span class="string">'\n'</span>];
2406     <span class="keyword">end</span>
2407 <span class="keyword">end</span>
2408 s=sprintf(s);
2409 set(handles.edit_Cell_Properties,<span class="string">'string'</span>,s);
2410 
2411 
2412 <span class="comment">%select the tobject coresponding to the object</span>
2413 <span class="keyword">if</span> strcmp(str,<span class="string">'cells1'</span>)
2414     <span class="keyword">if</span> segmentation.cells1Mapped(segmentation.frame1)
2415         segmentation.selectedTObj=segmentation.tcells1(n);
2416     <span class="keyword">end</span>
2417 <span class="keyword">end</span>
2418 <span class="comment">% if strcmp(str,'cells2')</span>
2419 <span class="comment">%     if segmentation.cells1Mapped(segmentation.frame1)</span>
2420 <span class="comment">%         segmentation.selectedTObj=segmentation.tcells2(n);</span>
2421 <span class="comment">%     end</span>
2422 <span class="comment">% end</span>
2423 <span class="keyword">if</span> strcmp(str,<span class="string">'budnecks'</span>)
2424     <span class="keyword">if</span> segmentation.budnecksMapped(segmentation.frame1)
2425         segmentation.selectedTObj=segmentation.tbudnecks(n);
2426     <span class="keyword">end</span>
2427 <span class="keyword">end</span>
2428 
2429 
2430 <span class="comment">%select tobject by duble click and if the pedigree is shown , show in</span>
2431 <span class="comment">%pedigree the coresponding cell</span>
2432 <span class="keyword">if</span> strcmp(butonType,<span class="string">'open'</span>)&amp;&amp;~isempty(segmentation.selectedTObj)
2433     
2434     segmentation.selectedTObj.select();
2435 
2436     <span class="keyword">if</span> isfield(segmentation.myHandles,<span class="string">'pedigreeImage'</span>) &amp;&amp; ishandle(segmentation.myHandles.pedigreeImage)<span class="comment">% show the cell on the pedigree image</span>
2437         uData=get(segmentation.myHandles.pedigreeImage,<span class="string">'UserData'</span>);
2438         xpos=uData.xpos;
2439         <span class="comment">%linesize=uData.linesize;</span>
2440         <span class="comment">%tcells=uData.tcells;</span>
2441         <span class="comment">%nCell=find((xpos&lt;=j)&amp;(xpos+linesize&gt;=j));</span>
2442         <span class="comment">%if ~isempty(nCell)</span>
2443         scaleFactor=uData.scaleFactor;
2444         frame=segmentation.selectedObj.image;
2445         x=xpos(n);
2446         y=frame*scaleFactor;
2447         haxe=uData.haxe;
2448         <span class="keyword">if</span> isfield(uData,<span class="string">'hselect'</span>)
2449             hs=uData.hselect;
2450             set(hs,<span class="string">'xData'</span>,x);
2451             set(hs,<span class="string">'yData'</span>,y);
2452         <span class="keyword">else</span>
2453             hold(haxe,<span class="string">'on'</span>);
2454             uData.hselect=plot(haxe,x,y,<span class="string">'co'</span>,<span class="string">'hitTest'</span>,<span class="string">'off'</span>);
2455             hold(haxe,<span class="string">'off'</span>);
2456         <span class="keyword">end</span>
2457         set(hObject,<span class="string">'UserData'</span>,uData);
2458         
2459     <span class="keyword">end</span>
2460 <span class="keyword">end</span>
2461 
2462 <span class="comment">%modify the string coresponding to the tcell properties edit box</span>
2463 <span class="keyword">if</span> ~isempty(segmentation.selectedTObj)
2464     s=<span class="string">''</span>;
2465     <span class="keyword">for</span> i=1:length(segmentation.showFieldsTObj)
2466         <span class="keyword">if</span> strcmp(class(segmentation.selectedTObj.(segmentation.showFieldsTObj{i})),<span class="string">'double'</span>)
2467             s=[s,segmentation.showFieldsTObj{i},<span class="string">': '</span>,num2str(segmentation.selectedTObj.(segmentation.showFieldsTObj{i})),<span class="string">'\n'</span>];
2468         <span class="keyword">end</span>
2469     <span class="keyword">end</span>
2470     s=sprintf(s);
2471     set(handles.edit_TCell_Properties,<span class="string">'string'</span>,s);
2472 <span class="keyword">else</span>
2473     set(handles.edit_TCell_Properties,<span class="string">'string'</span>,[]);
2474 <span class="keyword">end</span>
2475 
2476 <span class="comment">%-----------------------------------------------------------------------</span>
2477 <span class="comment">%function to move objects when thei are draggd</span>
2478 <a name="_sub71" href="#_subfunctions" class="code">function mouse_dragginObj(hObect,evendata,obj)</a>
2479 <span class="comment">% real time dragging function</span>
2480 <span class="comment">%Mouse click + drag mouve selected object</span>
2481 
2482 <span class="keyword">global</span> segmentation
2483 old=segmentation.myHandles.oldPoint;
2484 pt = get(gca, <span class="string">'CurrentPoint'</span>);
2485 X=get(obj,<span class="string">'xData'</span>);
2486 Y=get(obj,<span class="string">'yData'</span>);
2487 set(obj, <span class="string">'xData'</span>, (pt(1)-old(1))+X);
2488 set(obj, <span class="string">'yData'</span>, (pt(1,2)-old(1,2))+Y);
2489 segmentation.selectedObj.x=(pt(1)-old(1))+X;
2490 segmentation.selectedObj.y=(pt(1,2)-old(1,2))+Y;
2491 select=segmentation.selectedObj;
2492 t=get(segmentation.selectedObj.htext,<span class="string">'position'</span>);
2493 X=t(1);
2494 Y=t(2);
2495 t(1)=(pt(1)-old(1))+X;
2496 t(2)=(pt(1,2)-old(1,2))+Y;
2497 set(select.htext, <span class="string">'position'</span>, t);
2498 segmentation.selectedObj.ox=t(1);
2499 segmentation.selectedObj.oy=t(2);
2500 <span class="comment">%set(select.htext, 'yData', (pt(1,2)-old(1,2))+Y);</span>
2501 
2502 segmentation.myHandles.oldPoint=pt;
2503 
2504 <span class="comment">%change the status text</span>
2505 <a name="_sub72" href="#_subfunctions" class="code">function status(str,handles)</a>
2506 <span class="comment">% set status</span>
2507 set(handles.text_status,<span class="string">'String'</span>,str);
2508 pause(0.01);
2509 
2510 <span class="comment">% --- Executes on key press with focus on figure1 or any of its controls.</span>
2511 <a name="_sub73" href="#_subfunctions" class="code">function figure1_WindowKeyPressFcn(hObject, eventdata, handles)</a>
2512 
2513 <span class="comment">%shortcut keys callback</span>
2514 <span class="comment">%called each time a key is presed</span>
2515 
2516 <span class="keyword">global</span> segmentation
2517 <span class="keyword">if</span> isfield(eventdata,<span class="string">'VerticalScrollCount'</span>)
2518     <span class="keyword">return</span>
2519 <span class="keyword">end</span>
2520 <span class="keyword">if</span> strcmp(eventdata.Key,<span class="string">'leftarrow'</span>)
2521     <span class="comment">%disp('left');</span>
2522     <a href="#_sub4" class="code" title="subfunction pushbutton_Previous1_Callback(hObject, eventdata, handles)">pushbutton_Previous1_Callback</a>(handles.pushbutton_Previous1, [], handles);
2523     
2524 <span class="keyword">end</span>
2525 <span class="keyword">if</span> strcmp(eventdata.Key,<span class="string">'rightarrow'</span>)
2526     <span class="comment">%disp('rightarrow');</span>
2527     <a href="#_sub5" class="code" title="subfunction pushbutton_Next1_Callback(hObject, eventdata, handles)">pushbutton_Next1_Callback</a>(handles.pushbutton_Next1, [], handles);
2528 <span class="keyword">end</span>
2529 
2530 <span class="keyword">if</span> strcmp(eventdata.Key,<span class="string">'delete'</span>)
2531 
2532     <a href="#_sub13" class="code" title="subfunction pushbutton_Delete_Object_Callback(hObject, eventdata, handles)">pushbutton_Delete_Object_Callback</a>(handles.pushbutton_Delete_Object, [], handles);
2533 <span class="keyword">end</span>
2534 
2535 <span class="comment">%check all registred keys</span>
2536 <span class="keyword">for</span> i=1:size(segmentation.shorcutKeys,1)
2537     <span class="keyword">if</span> ~isempty(segmentation.shorcutKeys{i,1})
2538         <span class="keyword">if</span> isempty(segmentation.shorcutKeys{i,2})
2539             segmentation.shorcutKeys{i,2}=eventdata.Key;
2540         <span class="keyword">else</span>
2541             <span class="keyword">if</span> strcmp(segmentation.shorcutKeys{i,2},eventdata.Key)
2542                 <span class="comment">%togle the value of the function</span>
2543                 set(handles.(segmentation.shorcutKeys{i,1}),<span class="string">'value'</span>,not(get(handles.(segmentation.shorcutKeys{i,1}),<span class="string">'value'</span>)));
2544                 feval(get(handles.(segmentation.shorcutKeys{i,1}),<span class="string">'Callback'</span>),handles.(segmentation.shorcutKeys{i,1}),[]);
2545             <span class="keyword">end</span>
2546         <span class="keyword">end</span>
2547     <span class="keyword">end</span>
2548 <span class="keyword">end</span>
2549 <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'Idle'</span>,handles);
2550 
2551 <span class="comment">% --- Executes on mouse press over figure background, over a disabled or</span>
2552 <span class="comment">% --- inactive control, or over an axes background.</span>
2553 <a name="_sub74" href="#_subfunctions" class="code">function figure1_WindowButtonUpFcn(hObject, eventdata, handles)</a>
2554 set(handles.figure1, <span class="string">'WindowButtonMotionFcn'</span>,<span class="string">''</span>);
2555 
2556 
2557 
2558 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
2559 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%% CONTEXT MENUS CALLBACK %%%%%%%%%%%%%%%%%%%%%%%%%</span>
2560 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
2561 
2562 <span class="comment">%===================== BUTTONS CONTEXT MENU ==============================</span>
2563 
2564 <span class="comment">% --------------------------------------------------------------------</span>
2565 <a name="_sub75" href="#_subfunctions" class="code">function Set_Key_Callback(hObject, eventdata, handles)</a>
2566 <span class="comment">%right click on the button to set the key</span>
2567 
2568 <span class="keyword">global</span> segmentation
2569 
2570 <span class="comment">%verify the tolbar buttons (the key function does not work while buttons are pressed)</span>
2571 <span class="comment">%--------------------------------------------------------------------</span>
2572 str=get(handles.uitoggletool1,<span class="string">'state'</span>);
2573 <span class="keyword">if</span> strcmpi(str,<span class="string">'on'</span>)
2574     <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'set &quot;Zoom in&quot; button off before'</span>,handles);
2575     <span class="keyword">return</span>
2576 <span class="keyword">end</span>
2577 str=get(handles.uitoggletool2,<span class="string">'state'</span>);
2578 <span class="keyword">if</span> strcmpi(str,<span class="string">'on'</span>)
2579     <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'set &quot;Zoom Out&quot; button off before'</span>,handles);
2580     <span class="keyword">return</span>
2581 <span class="keyword">end</span>
2582 str=get(handles.uitoggletool3,<span class="string">'state'</span>);
2583 <span class="keyword">if</span> strcmpi(str,<span class="string">'on'</span>)
2584     <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'set &quot;Pan&quot; button off before'</span>,handles);
2585     <span class="keyword">return</span>
2586 <span class="keyword">end</span>
2587 str=get(handles.uitoggletool4,<span class="string">'state'</span>);
2588 <span class="keyword">if</span> strcmpi(str,<span class="string">'on'</span>)
2589     <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'set &quot;Data Cursor&quot; button off before'</span>,handles);
2590     <span class="keyword">return</span>
2591 <span class="keyword">end</span>
2592 <span class="comment">%------------------------------------------------------------------</span>
2593 
2594 <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>([<span class="string">'Set Key for '</span>,get(gco,<span class="string">'tag'</span>)],handles);
2595 val=false;
2596 <span class="keyword">for</span> i=1:size(segmentation.shorcutKeys,1)
2597     <span class="keyword">if</span> strcmp(segmentation.shorcutKeys{i,1},get(gco,<span class="string">'tag'</span>))
2598         segmentation.shorcutKeys{i,2}={};
2599         val=true;
2600     <span class="keyword">end</span>
2601 <span class="keyword">end</span>
2602 <span class="keyword">if</span> ~val
2603 segmentation.shorcutKeys{end+1,1}=get(gco,<span class="string">'tag'</span>);
2604 <span class="keyword">end</span>
2605 
2606 <span class="comment">%===================== OBJECTS CONTEXT MENU ==============================</span>
2607 
2608 <span class="comment">% --------------------------------------------------------------------</span>
2609 <a name="_sub76" href="#_subfunctions" class="code">function Context_Objects_Edit_Contour_Callback(hObject, eventdata, handles)</a>
2610 <a href="#_sub14" class="code" title="subfunction pushbutton_Edit_Contour_Callback(hObject, eventdata, handles)">pushbutton_Edit_Contour_Callback</a>(handles.pushbutton_Edit_Contour, eventdata, handles)
2611 
2612 <span class="comment">% --------------------------------------------------------------------</span>
2613 <a name="_sub77" href="#_subfunctions" class="code">function Context_Objects_Callback(hObject, eventdata, handles)</a>
2614 
2615 <span class="comment">% --------------------------------------------------------------------</span>
2616 <a name="_sub78" href="#_subfunctions" class="code">function Context_Objects_Set_Number_Callback(hObject, eventdata, handles)</a>
2617 <a href="#_sub12" class="code" title="subfunction pushbutton_Set_Number_Callback(hObject, eventdata, handles)">pushbutton_Set_Number_Callback</a>(handles.pushbutton_Set_Number, [], handles)
2618 
2619 <span class="comment">% --------------------------------------------------------------------</span>
2620 <a name="_sub79" href="#_subfunctions" class="code">function Context_Objects_Delete_Callback(hObject, eventdata, handles)</a>
2621 <a href="#_sub13" class="code" title="subfunction pushbutton_Delete_Object_Callback(hObject, eventdata, handles)">pushbutton_Delete_Object_Callback</a>(handles.pushbutton_Delete_Object, [], handles);
2622 
2623 <span class="comment">% --------------------------------------------------------------------</span>
2624 <a name="_sub80" href="#_subfunctions" class="code">function Context_Objects_Copy_Callback(hObject, eventdata, handles)</a>
2625 <span class="keyword">global</span> segmentation;
2626 selObj=get(gco,<span class="string">'userdata'</span>);
2627 segmentation.copyedObj=selObj;
2628 segmentation.copyedType=segmentation.selectedType;
2629 
2630 <span class="comment">% --------------------------------------------------------------------</span>
2631 <a name="_sub81" href="#_subfunctions" class="code">function Context_Objects_Move_Callback(hObject, eventdata, handles)</a>
2632 selObj=get(gco,<span class="string">'userdata'</span>); <span class="comment">%get object from userdata of graphic object</span>
2633 selObj.move=1;
2634 
2635 <span class="comment">% --------------------------------------------------------------------</span>
2636 <a name="_sub82" href="#_subfunctions" class="code">function Context_Objects_Lock_Callback(hObject, eventdata, handles)</a>
2637 
2638 selObj=get(gco,<span class="string">'userdata'</span>); <span class="comment">%get object from userdata of graphic object</span>
2639 selObj.move=0;
2640 
2641 <span class="comment">% --------------------------------------------------------------------</span>
2642 <a name="_sub83" href="#_subfunctions" class="code">function Context_Objects_Set_Mother_Callback(hObject, eventdata, handles)</a>
2643 <a href="#_sub11" class="code" title="subfunction pushbutton_Set_Mother_Callback(hObject, eventdata, handles)">pushbutton_Set_Mother_Callback</a>(handles.pushbutton_Set_Mother, [], handles)
2644 
2645 <span class="comment">% --------------------------------------------------------------------</span>
2646 <a name="_sub84" href="#_subfunctions" class="code">function Context_Objects_Copy_Next_Frame_Callback(hObject, eventdata, handles)</a>
2647 <span class="keyword">global</span> segmentation;
2648 selObj=get(gco,<span class="string">'userdata'</span>);
2649 segmentation.copyedObj=selObj;
2650 segmentation.copyedType=segmentation.selectedType;
2651 segmentation.frame1=segmentation.frame1+1;
2652 <a href="#_sub85" class="code" title="subfunction Context_Image_Paste_Callback(hObject, eventdata, handles)">Context_Image_Paste_Callback</a>(handles.Context_Image_Paste, [], handles)
2653 segmentation.frameChanged(segmentation.frame1+1)=1;
2654 
2655 
2656 <span class="comment">%===================== IMAGE CONTEXT MENU ==============================</span>
2657 <span class="comment">%(right click on the image)</span>
2658 <span class="comment">% --------------------------------------------------------------------</span>
2659 <a name="_sub85" href="#_subfunctions" class="code">function Context_Image_Paste_Callback(hObject, eventdata, handles)</a>
2660 <span class="comment">%paste the object to the image</span>
2661 <span class="keyword">global</span> segmentation;
2662 <span class="keyword">if</span> ~isempty(segmentation.copyedObj)
2663     obj= segmentation.(segmentation.copyedType);
2664     <span class="keyword">if</span> size(obj,1)&gt;=segmentation.frame1
2665         added=false;
2666         <span class="keyword">for</span> i=1:length(obj(segmentation.frame1,:))
2667             <span class="keyword">if</span> obj(segmentation.frame1,i).ox==0
2668                 
2669                 added=true;
2670                 <span class="keyword">break</span>;
2671             <span class="keyword">end</span>
2672         <span class="keyword">end</span>
2673         <span class="keyword">if</span> ~added
2674             i=length(obj(segmentation.frame1,:))+1;
2675         <span class="keyword">end</span>
2676     <span class="keyword">else</span> i=1;
2677     <span class="keyword">end</span>
2678     obj(segmentation.frame1,i)=<a href="phy_Object.html" class="code" title="">phy_Object</a>;
2679     names = fieldnames(segmentation.copyedObj);
2680     <span class="keyword">for</span> j=1:length(names)
2681         obj(segmentation.frame1,i).(names{j})=segmentation.copyedObj.(names{j});
2682     <span class="keyword">end</span>;
2683     obj(segmentation.frame1,i).move=1;
2684     obj(segmentation.frame1,i).image=segmentation.frame1;
2685     obj(segmentation.frame1,i).selected=0;
2686     segmentation.([segmentation.copyedType,<span class="string">'Segmented'</span>])(segmentation.frame1)=1;
2687     segmentation.frameChanged(segmentation.frame1)=1;
2688     segmentation.(segmentation.copyedType)=obj;
2689     <a href="#_sub64" class="code" title="subfunction Change_Disp1(pos,handles)">Change_Disp1</a>(<span class="string">'refresh'</span>,handles);
2690 
2691 <span class="keyword">end</span>
2692 
2693 <span class="comment">% --------------------------------------------------------------------</span>
2694 <a name="_sub86" href="#_subfunctions" class="code">function Context_Image_Callback(hObject, eventdata, handles)</a>
2695 
2696 <span class="comment">% --------------------------------------------------------------------</span>
2697 <a name="_sub87" href="#_subfunctions" class="code">function Context_Image_Paste_Images_Callback(hObject, eventdata, handles)</a>
2698 <span class="comment">% hObject    handle to Context_Image_Paste_Images (see GCBO)</span>
2699 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2700 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2701   
2702 <span class="keyword">global</span> segmentation
2703 <span class="keyword">global</span> timeLapse
2704 <span class="comment">%---------------------</span>
2705 <span class="comment">%dialog box</span>
2706 prompt = {<span class="string">'Enter first frame:'</span>,<span class="string">'Enter last frame:'</span>};
2707 dlg_title = <span class="string">'Add object to frames'</span>;
2708 num_lines = 1;
2709 def = {num2str(segmentation.frame1),num2str(timeLapse.numberOfFrames)};
2710 <span class="comment">%def = {num2str(bSeg(1)),num2str(bSeg(end))};</span>
2711 answer = inputdlg(prompt,dlg_title,num_lines,def);
2712 <span class="keyword">if</span> isempty(answer)
2713     <span class="keyword">return</span>
2714 <span class="keyword">end</span>
2715 startFrame=str2double(answer(1));
2716 endFrame=str2double(answer(2));
2717 <span class="comment">%-----------------------</span>
2718 <span class="keyword">if</span> ~isempty(segmentation.copyedObj)
2719     obj= segmentation.(segmentation.copyedType);
2720     <span class="keyword">for</span> frame1=startFrame:endFrame
2721         
2722         <span class="keyword">if</span> size(obj,1)&gt;=frame1
2723             added=false;
2724             <span class="keyword">for</span> i=1:length(obj(frame1,:))
2725                 <span class="keyword">if</span> obj(frame1,i).ox==0
2726                     
2727                     added=true;
2728                     <span class="keyword">break</span>;
2729                 <span class="keyword">end</span>
2730             <span class="keyword">end</span>
2731             <span class="keyword">if</span> ~added
2732                 i=length(obj(frame1,:))+1;
2733             <span class="keyword">end</span>
2734         <span class="keyword">else</span> i=1;
2735         <span class="keyword">end</span>
2736         obj(frame1,i)=<a href="phy_Object.html" class="code" title="">phy_Object</a>;
2737         names = fieldnames(segmentation.copyedObj);
2738         <span class="keyword">for</span> j=1:length(names)
2739             obj(frame1,i).(names{j})=segmentation.copyedObj.(names{j});
2740         <span class="keyword">end</span>;
2741         obj(frame1,i).move=1;
2742         obj(frame1,i).image=frame1;
2743         obj(frame1,i).selected=0;
2744         
2745         segmentation.([segmentation.copyedType,<span class="string">'Segmented'</span>])(frame1)=1;
2746         segmentation.frameChanged(frame1)=1;
2747         
2748         
2749     <span class="keyword">end</span>
2750     segmentation.(segmentation.copyedType)=obj;
2751     <a href="#_sub64" class="code" title="subfunction Change_Disp1(pos,handles)">Change_Disp1</a>(<span class="string">'refresh'</span>,handles);
2752 <span class="keyword">end</span>
2753 
2754 
2755 <span class="comment">% --------------------------------------------------------------------</span>
2756 <a name="_sub88" href="#_subfunctions" class="code">function Check_Setings_Callback(hObject, eventdata, handles)</a>
2757 <span class="keyword">global</span> segmentation
2758 
2759 <span class="comment">%check struct saved from previous versions</span>
2760 <span class="keyword">if</span> ~isfield(segmentation,<span class="string">'check'</span>)
2761     segmentation.check.budneckTimeLow=5;
2762     segmentation.check.budneckTimeHigh=20;
2763 <span class="keyword">end</span>
2764 
2765 <span class="comment">%-------------------------------------------------------------------------</span>
2766 <span class="comment">%dialog</span>
2767 prompt = {<span class="string">'Enter lowest budneck allert time:'</span>,<span class="string">'Enter highest budneck allert time:'</span>};
2768 dlg_title = <span class="string">'Check parametres'</span>;
2769 num_lines = 1;
2770 def = {num2str(segmentation.check.budneckTimeLow),num2str(segmentation.check.budneckTimeHigh)};
2771 answer = inputdlg(prompt,dlg_title,num_lines,def);
2772 <span class="keyword">if</span> isempty(answer)
2773     <span class="keyword">return</span>
2774 <span class="keyword">end</span>
2775 <span class="comment">%------------------------------------------------------------------------</span>
2776 
2777 segmentation.check.budneckTimeLow=str2double(answer(1));
2778 segmentation.check.budneckTimeHigh=str2double(answer(2));
2779 
2780 
2781 <span class="comment">% --- Executes on button press in checkbox_Use_Display_Image.</span>
2782 <a name="_sub89" href="#_subfunctions" class="code">function checkbox_Use_Display_Image_Callback(hObject, eventdata, handles)</a>
2783 <a href="#_sub64" class="code" title="subfunction Change_Disp1(pos,handles)">Change_Disp1</a>(<span class="string">'refresh'</span>,handles);
2784 
2785 
2786 <span class="comment">% --- Executes on button press in checkbox_Use_Cropped_Image.</span>
2787 <a name="_sub90" href="#_subfunctions" class="code">function checkbox_Use_Cropped_Image_Callback(hObject, eventdata, handles)</a>
2788 <a href="#_sub64" class="code" title="subfunction Change_Disp1(pos,handles)">Change_Disp1</a>(<span class="string">'refresh'</span>,handles);
2789 
2790 
2791 <span class="comment">% --------------------------------------------------------------------</span>
2792 <a name="_sub91" href="#_subfunctions" class="code">function Analyse_Callback(hObject, eventdata, handles)</a>
2793 <span class="comment">% hObject    handle to Analyse (see GCBO)</span>
2794 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2795 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2796 
2797 
2798 <span class="comment">% --------------------------------------------------------------------</span>
2799 <a name="_sub92" href="#_subfunctions" class="code">function Analyse_Levels_Inside_Contours_Callback(hObject, eventdata, handles)</a>
2800 
2801 <span class="keyword">global</span> segmentation;
2802 
2803 
2804 <span class="comment">%dialog</span>
2805 <span class="comment">%-------------------------------------------------------------------------</span>
2806 prompt = {<span class="string">'Chose the object to be analysed: (cells1/budnecks)'</span>,<span class="string">'Enter analyse channel'</span>};
2807 dlg_title = <span class="string">'Analyse fluorescence inside contours'</span>;
2808 num_lines = 1;
2809 def = {<span class="string">'cells1'</span>,<span class="string">'1'</span>};
2810 answer = inputdlg(prompt,dlg_title,num_lines,def);
2811 <span class="keyword">if</span> isempty(answer)
2812     <span class="keyword">return</span>
2813 <span class="keyword">end</span>
2814 <span class="comment">%------------------------------------------------------------------------</span>
2815 a1=answer{1};
2816 a2=str2double(answer{2});
2817 
2818 segmentedFrames=find(segmentation.([a1,<span class="string">'Segmented'</span>]));<span class="comment">%all segemented frames</span>
2819 obj=segmentation.(a1); <span class="comment">%chosen object</span>
2820 
2821 <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'Analyse Fluorescence'</span>,handles);
2822 
2823 c=0;
2824 <a href="phy_progressbar.html" class="code" title="function [stopBar] =  phy_progressbar(fractiondone, position)">phy_progressbar</a>;
2825 <span class="comment">%for all segmented images do the analyse</span>
2826 <span class="keyword">for</span> i=segmentedFrames
2827     c=c+1;
2828     <a href="phy_progressbar.html" class="code" title="function [stopBar] =  phy_progressbar(fractiondone, position)">phy_progressbar</a>(c/length(segmentedFrames));
2829     
2830     <span class="comment">%read and scale the fluorescence image</span>
2831     img=<a href="phy_loadTimeLapseImage.html" class="code" title="function image=phy_loadTimeLapseImage(pos,frame,ch,option)">phy_loadTimeLapseImage</a>(segmentation.position,i,a2,<span class="string">'non retreat'</span>);
2832     img=imresize(img,segmentation.sizeImageMax);
2833     
2834     <span class="comment">%create masks and mean the pixels</span>
2835     <span class="keyword">for</span> j=1:length(obj(i,:))
2836         <span class="keyword">if</span> obj(i,j).n~=0 &amp;&amp; ~isempty(obj(i,j).x)
2837             mask = poly2mask(obj(i,j).x,obj(i,j).y,segmentation.sizeImageMax(1),segmentation.sizeImageMax(2));
2838             obj(i,j).meanLevelsInside=mean(img(mask));
2839         <span class="keyword">end</span>
2840     <span class="keyword">end</span>
2841 <span class="keyword">end</span>
2842 <a href="#_sub72" class="code" title="subfunction status(str,handles)">status</a>(<span class="string">'Idle'</span>,handles);
2843 
2844 
2845 
2846 <span class="comment">% --------------------------------------------------------------------</span>
2847 <a name="_sub93" href="#_subfunctions" class="code">function Analyse_Plot_Levels_Callback(hObject, eventdata, handles)</a>
2848 
2849 <span class="keyword">global</span> segmentation;
2850 
2851 <span class="comment">%dialog</span>
2852 <span class="comment">%-------------------------------------------------------------------------</span>
2853 prompt = {<span class="string">'Chose the object to be ploted: (cells1/budnecks)'</span>};
2854 dlg_title = <span class="string">'Plot fluorescence inside contours'</span>;
2855 num_lines = 1;
2856 def = {<span class="string">'cells1'</span>};
2857 answer = inputdlg(prompt,dlg_title,num_lines,def);
2858 <span class="keyword">if</span> isempty(answer)
2859     <span class="keyword">return</span>
2860 <span class="keyword">end</span>
2861 <span class="comment">%------------------------------------------------------------------------</span>
2862 a1=answer{1};
2863 tobj=segmentation.([<span class="string">'t'</span>,a1]); <span class="comment">%chosen object</span>
2864 
2865 ploted=[];
2866 h=[];
2867 hf=figure;
2868 ha=axes;
2869 couleurs = hsv(length(tobj));
2870 <span class="keyword">for</span> i=1:length(tobj)
2871     <span class="keyword">if</span> tobj(i).N~=0
2872         ploted=[ploted i];
2873         values=[];
2874         frames=[];
2875         <span class="keyword">for</span> j=1:length(tobj(i).Obj)
2876             values=[values,tobj(i).Obj(j).meanLevelsInside];
2877             frames=[frames,tobj(i).Obj(j).image];
2878         <span class="keyword">end</span>
2879         [frames,IX]=sort(frames);
2880         values(:)=values(IX);
2881         h(i)=line(frames,values,<span class="string">'color'</span>,couleurs(i,:));
2882         set(h(i),<span class="string">'ButtonDownFcn'</span>,{@<a href="#_sub94" class="code" title="subfunction mouseFluoPlot(hObject, eventdata, ha)">mouseFluoPlot</a>,ha});
2883         set(h(i),<span class="string">'DisplayName'</span>,num2str(i),<span class="string">'SelectionHighlight'</span>,<span class="string">'off'</span>);
2884         <span class="comment">%legend('toggle');</span>
2885     <span class="keyword">end</span>
2886     <span class="comment">%legend('show');</span>
2887 <span class="keyword">end</span>
2888         
2889 <a name="_sub94" href="#_subfunctions" class="code">function mouseFluoPlot(hObject, eventdata, ha)</a>
2890 <span class="comment">%deselect</span>
2891 set(get(ha,<span class="string">'Children'</span>),<span class="string">'selected'</span>,<span class="string">'off'</span>,<span class="string">'LineWidth'</span>,0.5,<span class="string">'Marker'</span>,<span class="string">'none'</span>);
2892 <span class="comment">%select mouse click</span>
2893 set(hObject,<span class="string">'LineWidth'</span>,2,<span class="string">'Marker'</span>,<span class="string">'o'</span>,<span class="string">'MarkerEdgeColor'</span>,<span class="string">'c'</span>,<span class="string">'MarkerSize'</span>,3,<span class="string">'Selected'</span>,<span class="string">'on'</span>);
2894 title(ha,[<span class="string">'object '</span>,get(hObject,<span class="string">'DisplayName'</span>)]);</pre></div>
<hr><address>Generated on Wed 27-Oct-2010 20:01:59 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2003</address>
</body>
</html>